\documentclass[lang=cn,10pt,thmcnt=section]{elegantbook}
\usepackage{graphicx}
\usepackage{float}
\usepackage{esint}
\usepackage{mathtools}
\usepackage{tikz}
\usetikzlibrary{arrows.meta, positioning}
\usetikzlibrary{automata, positioning, arrows}
\title{随机过程}



\author{Huang}
\date{\today}




\setcounter{tocdepth}{3}


\cover{cover.jpg}

% 本文档命令
\usepackage{array}
\newcommand{\ccr}[1]{\makecell{{\color{#1}\rule{1cm}{1cm}}}}

% 修改标题页的橙色带
% \definecolor{customcolor}{RGB}{32,178,170}
% \colorlet{coverlinecolor}{customcolor}

\begin{document}
	
	\maketitle
	\frontmatter
	
	\tableofcontents
	
	\mainmatter
	\chapter{离散时间马尔可夫链}
	\section{马氏链及其转移概率}
	有一类随机过程，它具备所谓的“无后效性”（Markov 性），
即要确定过程将来的状态，知道它此刻的情况就足够了，并不需要
对它以往状况的认识，这类过程称为Markov过程.我们将介绍离散
时间的Markov链（简称马氏链）.

本章假定：$T = \{0, 1, \cdots\}$，$S = \{0, 1, 2, \cdots, N\}$（或者 $S := \mathbb{N}$），所有r.v.均定义在同一个概率空间上。用$i, j$表示$S$中元素。
\begin{definition}[离散时间马尔可夫链]
	随机过程$\{X_n, n = 0, 1, 2, \cdots\}$称为\textit{Markov链}，若它只取有限或可列个值（若不另外说明，以非负整数集$\{0, 1, 2, \cdots\}$来表示），并且对任意的$n \geq 0$，及任意状态$i, j, i_0, i_1, \cdots, i_{n-1}$，有
\begin{equation}
P\{X_{n+1} = j | X_0 = i_0, X_1 = i_1, \cdots, X_{n-1} = i_{n-1}, X_n = i\} = P\{X_{n+1} = j | X_n = i\}
\end{equation}
其中$X_n = i$表示过程在时刻$n$处于状态$i$，称为$S$。式(1.1)刻画了\textit{Markov链}的特性，称为\textit{Markov性}，或\textit{马氏性}，或\textit{无记忆性}。
\end{definition}

\begin{definition}[转移概率]
	设 $\{X_n, n = 0, 1, \ldots\}$ 为马氏链，称
\[ P\{X_{n+1} = j | X_n = i\} =: p_{ij}(n) \]
为 $n$ 时刻的一步转移概率。若它与 $n$ 无关，则记作 $p_{ij}$，并称相应的马氏链为齐次的或时齐的。令 $P = (p_{ij})$，称 $P$ 为齐次马氏链的转移概率矩阵，简称为转移矩阵，$p_{ij}$ 为一步转移概率。我们只考虑齐次马氏链。

\end{definition}

\[ P\{X_{n+1} = j | X_0 = i_0, X_1 = i_1, \cdots, X_{n-1} = i_{n-1}, X_n = i\} \]
\[ = P\{X_{n+1} = j | X_n = i\} \text{马尔可夫性} \]
\[ = P\{X_1 = j | X_0 = i\} \text{齐次} \]

设 $\{X_n, n = 0, 1, \ldots\}$ 是齐次马氏链，具有转移矩阵 $P = (p_{ij})$，则有
\[ p_{ij} \geq 0 \quad \forall i, j \in S \text{且} \]
\[ \sum_{j \in S} p_{ij} = \sum_{j \in S} P(X_1 = j | X_0 = i) = P(X_1 \in S | X_0 = i) = 1 \quad \forall i \in S. \]

\begin{definition}[随机矩阵]
	称矩阵 $A = (a_{ij})_{S \times S}$ 为随机矩阵，若 $a_{ij} \geq 0 (\forall i, j \in S)$，且 $\sum_{j \in S} a_{ij} = 1 (\forall i \in S)$。
\end{definition}

由该定义知转移矩阵是随机矩阵。

\begin{example}[赌徒破产问题]
	系统的状态是 \(0 \sim n\)，反映赌博者在赌博期间拥有的钱数，当他输光或拥有钱数为 \(n\) 时，赌博停止，否则他将持续赌博。每次以概率 \(p\) 赢得1，以概率 \(q = 1 - p\) 输掉1。则每个时刻，该赌徒拥有的钱数服从马尔可夫性吗？能否写出对应的转移概率矩阵？
\end{example}
\begin{proof}
	这个系统的转移矩阵为

\[
P = 
\begin{array}{c|ccccccccc}
 & 0 & 1 & 2 & 3 & \cdots & n-2 & n-1 & n \\
\hline
0 & 1 & 0 & 0 & 0 & \cdots & 0 & 0 & 0 \\
1 & q & 0 & p & 0 & \cdots & 0 & 0 & 0 \\
2 & 0 & q & 0 & p & \cdots & 0 & 0 & 0 \\
3 & 0 & 0 & q & 0 & \cdots & 0 & 0 & 0 \\
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots \\
n-2 & 0 & 0 & 0 & 0 & \cdots & 0 & p & 0 \\
n-1 & 0 & 0 & 0 & 0 & \cdots & q & 0 & p \\
n & 0 & 0 & 0 & 0 & \cdots & 0 & 0 & 1 \\
\end{array}
\]
\end{proof}
\begin{example}[简单随机游动]
	质点在直线的整数点上作简单随机游动：质点到达某个状态后，下次向右移动一步的概率是$p$，向左移动一步的概率是$q$，在原地不动的概率为$r$，且$p + q + r = 1$。$X_0$表示初始状态，$X_n$表示质点在时间$n$的状态。假设初始状态与每次移动相互独立。则$\{X_n\}$是马氏链，
\end{example}
\begin{proof}
	\[
\left\{
\begin{aligned}
p_{i, i-1} &= P(X_{n+1} = i - 1 | X_n = i) = q \\
p_{i, i+1} &= P(X_{n+1} = i + 1 | X_n = i) = p \\
p_{i, i} &= P(X_{n+1} = i | X_n = i) = r
\end{aligned}
\right.
\]
\end{proof}
\begin{example}
	设有一蚂蚁在下图爬行，当两个结点相临时，蚂蚁将爬向它临近的一点，并且爬向任何一个邻居的概率是相同的。

\begin{figure}[h]
    \centering
    \begin{tikzpicture}
        \node (1) at (0,0) {1};
        \node (2) at (2,2) {2};
        \node (3) at (2,0) {3};
        \node (4) at (2,-2) {4};
        \node (5) at (4,1) {5};
        \node (6) at (6,0) {6};
        
        \draw (1) -- (2);
        \draw (1) -- (3);
        \draw (2) -- (3);
        \draw (3) -- (4);
        \draw (3) -- (5);
        \draw (5) -- (6);
    \end{tikzpicture}
\end{figure}
\end{example}
\begin{proof}
	此Markov链的转移矩阵为

\[
\mathbf{P} = \begin{pmatrix}
0 & \frac{1}{2} & \frac{1}{2} & 0 & 0 & 0 \\
\frac{1}{2} & 0 & \frac{1}{2} & 0 & 0 & 0 \\
\frac{1}{4} & \frac{1}{4} & 0 & \frac{1}{4} & \frac{1}{4} & 0 \\
0 & 0 & 1 & 0 & 0 & 0 \\
0 & 0 & \frac{1}{2} & 0 & 0 & \frac{1}{2} \\
0 & 0 & 0 & 0 & 1 & 0
\end{pmatrix}
\]
\end{proof}

\begin{theorem}
	设 $A, B, C$ 为三个随机事件，则 $P(BC|A) = P(B|A)P(C|AB)$.
\end{theorem}
\begin{proof}
	\[
P(BC|A) = \frac{P(ABC)}{P(A)} = \frac{P(AB)P(ABC)}{P(A)P(AB)} = P(B|A)P(C|AB).
\]
\end{proof}
\begin{remark}
	令 $P(\cdot|A) := P_A$, 则应用乘法公式 $P(BC|A) = P_A(BC) = P_A(C|B) \cdot P_A(B) = P(C|BA)P(B|A)$.

\end{remark}
\begin{theorem}
	对于事件 $A, B, C$，当 $P(AB) > 0$，条件

\[
P(C|BA) = P(C|B),
\]

和条件

\[
P(AC|B) = P(A|B)P(C|B)
\]

等价。
\end{theorem}
\begin{proof}
	\[
\frac{P(ACB)}{P(B)} = \frac{P(AB)}{P(B)} \frac{P(BC)}{P(AB)} \text{ 可知 } \frac{P(ACB)}{P(AB)} = \frac{P(BC)}{P(B)}. \text{ 即 } P(C|BA) = P(C|B).
\]
\end{proof}
\begin{theorem}
	对于事件 $A, B, C$，当 $P(AB) > 0$，条件
\[ P(C|BA) = P(C|B), \]
和条件
\[ P(AC|B) = P(A|B)P(C|B) \]
等价。


\end{theorem}
马氏性的解释：

过去：$A = (X_0 = i_0, \ldots, X_{n-1} = i_{n-1})$，

现在：$B = (X_n = i_n)$，

将来：$C = (X_{n+1} = i_{n+1})$。

马氏性代表在已知现在的情况下，将来与过去无关。
\begin{theorem}
	设 $S$ 是马氏链 $\{X_n\}$ 的状态空间，则有
\begin{enumerate}
    \item 对任意的 $n, m \geq 1$ 有
    \[
    \begin{aligned}
    & P(X_{n+1} = i_{n+1}, \ldots, X_{n+m} = i_{n+m} | X_0 = i_0, \ldots, X_n = i) \\
    & = P(X_{n+1} = i_{n+1}, X_{n+2} = i_{n+2}, \ldots, X_{n+m} = i_{n+m} | X_n = i)
    \end{aligned}
    \]
    \item 对任意的 $n, m \geq 1$，以及 $C \subset S^m, A \subset S^n$ 有
    \[
    \begin{aligned}
    & P((X_{n+1}, X_{n+2}, \ldots, X_{n+m}) \in C | (X_0 \ldots, X_{n-1}) \in A, X_n = i) \\
    & = P((X_{n+1}, X_{n+2}, \ldots, X_{n+m}) \in C | X_n = i)
    \end{aligned}
    \]
    \item 对任意的 $k, m \geq 1$，以及 $t_0 < t_1 < \ldots < t_k < t_{k+1} < \ldots < t_{k+m}, i \in S, C \subset S^m, A \subset S^k$ 有
    \[
    \begin{aligned}
    & P((X_{t_{k+1}}, X_{t_{k+2}}, \ldots, X_{t_{k+m}}) \in C | (X_{t_0} \ldots, X_{t_{k-1}}) \in A, X_{t_k} = i) \\
    & = P((X_{t_{k+1}}, X_{t_{k+2}}, \ldots, X_{t_{k+m}}) \in C | X_{t_k} = i)
    \end{aligned}
    \]
\end{enumerate}
\end{theorem}
\begin{proof}
	(1)对 \(m\) 进行归纳证明。当 \(m = 1\) 时有马氏性即得。现在设对 \(m = k\) 成立，即已知
	\[
	\begin{aligned}
	& P(X_{n+1} = i_{n+1}, \ldots, X_{n+k} = i_{n+k} | X_0 = i_0, \ldots, X_n = i) \\
	& = P(X_{n+1} = i_{n+1}, X_{n+2} = i_{n+2}, \ldots, X_{n+k} = i_{n+k} | X_n = i)
	\end{aligned}
	\]
	
	\[
	\begin{aligned}
	& P(X_{n+1} = i_{n+1}, \ldots, X_{n+k+1} = i_{n+k+1} | X_0 = i_0, \ldots, X_n = i) \\
	& = P(X_{n+2} = i_{n+2}, \ldots, X_{n+k+1} = i_{n+k+1} | X_0 = i_0, \ldots, X_{n+1} = i_{n+1}) \\
	& \quad \cdot P(X_{n+1} = i_{n+1} | X_0 = i_0, \ldots, X_n = i) \\
	& = P(X_{n+2} = i_{n+2}, \ldots, X_{n+k+1} = i_{n+k+1} | X_{n+1} = i_{n+1}) \\
	& \quad \cdot P(X_{n+1} = i_{n+1} | X_n = i) \\
	& = P(X_{n+1} = i_{n+1}, X_{n+2} = i_{n+2}, \ldots, X_{n+k+1} = i_{n+k+1} | X_n = i)
	\end{aligned}
	\]
	
	\[
	\begin{aligned}
	& P(X_{n+2} = i_{n+2}, \ldots, X_{n+k+1} = i_{n+k+1} | X_n = i, X_{n+1} = i_{n+1}) \\
	& = \sum_{i_{n-1} \in S, \ldots, i_0 \in S} P(X_{n+k+1} = i_{n+k+1}, \ldots, X_{n+2} = i_{n+2}, X_{n+1} = i_{n+1}, \\
	& \quad X_n = i, X_{n-1} = i_{n-1}, \ldots, X_0 = i_0) / P(X_{n+1} = i_{n+1}, X_n = i) \\
	& = \sum_{i_{n-1} \in S, \ldots, i_0 \in S} P(X_{n+2} = i_{n+2}, \ldots, X_{n+k+1} = i_{n+k+1} | X_{n+1} = i_{n+1}, \\
	& \quad X_n = i, X_{n-1} = i_{n-1}, \ldots, X_0 = i_0) P(X_{n+1} = i_{n+1}, \\
	& \quad X_n = i, X_{n-1} = i_{n-1}, \ldots, X_0 = i_0) / P(X_{n+1} = i_{n+1}, X_n = i) \\
	& = \sum_{i_{n-1} \in S, \ldots, i_0 \in S} P(X_{n+2} = i_{n+2}, \ldots, X_{n+k+1} = i_{n+k+1} | X_{n+1} = i_{n+1}) \\
	& \quad P(X_{n+1} = i_{n+1}, X_n = i, X_{n-1} = i_{n-1}, \ldots, X_0 = i_0) \\
	& \quad / P(X_{n+1} = i_{n+1}, X_n = i) \\
	& = P(X_{n+2} = i_{n+2}, \ldots, X_{n+k+1} = i_{n+k+1} | X_{n+1} = i_{n+1})
	\end{aligned}
	\]

	(2)\[
\begin{aligned}
& P((X_{n+1}, \ldots, X_{n+m}) \in C | (X_0 \ldots, X_{n-1}) \in A, X_n = i) \\
& = \frac{P((X_{n+1}, \ldots, X_{n+m}) \in C, X_n = i, (X_{n-1} \ldots, X_0) \in A)}{P((X_0 \ldots, X_{n-1}) \in A, X_n = i)} \\
& = \sum_{(i_{n+1}, i_{n+2}, \ldots, i_{n+m}) \in C} \sum_{(i_{n-1}, \ldots, i_0) \in A} P(X_{n+m} = i_{n+m}, \ldots, X_{n+1} = i_{n+1}, \\
& \quad X_n = i, X_{n-1} = i_{n-1}, \ldots, X_0 = i_0) / P(X_n = i, (X_{n-1} \ldots, X_0) \in A) \\
& = \sum_{(i_{n+1}, i_{n+2}, \ldots, i_{n+m}) \in C} \sum_{(i_{n-1}, \ldots, i_0) \in A} P(X_{n+m} = i_{n+m}, \ldots, X_{n+1} = i_{n+1} | X_n = i, \\
& \quad X_{n-1} = i_{n-1}, \ldots, X_0 = i_0) \cdot P(X_n = i, X_{n-1} = i_{n-1}, \ldots, X_0 = i_0) \\
& \quad / P(X_n = i, (X_{n-1} \ldots, X_0) \in A) \\
& = \sum_{(i_{n+1}, i_{n+2}, \ldots, i_{n+m}) \in C} P(X_{n+m} = i_{n+m}, \ldots, X_{n+1} = i_{n+1} | X_n = i) \\
& \quad \cdot \sum_{(i_{n-1}, \ldots, i_0) \in A} P(X_n = i, X_{n-1} = i_{n-1}, \ldots, X_0 = i_0) \\
& \quad / P(X_n = i, (X_{n-1} \ldots, X_0) \in A) \\
& = P((X_{n+1}, X_{n+2}, \ldots, X_{n+m}) \in C | X_n = i)
\end{aligned}
\]

(3)用增补变量的方法：只举特殊情形证明，其余类似。证明 \(P((X_7, X_5) \in C | X_3 = i, X_1 \in A) = P((X_7, X_5) \in C | X_3 = i)\)

令 \(\tilde{C} := \{(i_7, i_6, i_5, i_4) | (i_7, i_5) \in C, i_6 \in S, i_4 \in S\}\)，\(\tilde{A} := \{(i_2, i_1, i_0) | i_2 \in S, i_1 \in A, i_0 \in S\}\)

\[
\begin{aligned}
P((X_7, X_5) \in C | X_3 = i, X_1 \in A) \\
& = P((X_7, X_6, X_5, X_4) \in \tilde{C} | X_3 = i, (X_2, X_1, X_0) \in \tilde{A}) \\
& = P((X_7, X_6, X_5, X_4) \in \tilde{C} | X_3 = i) \\
& = P((X_7, X_5) \in C | X_3 = i)
\end{aligned}
\]
\end{proof}
\begin{remark}
	设 $S$ 是马氏链 $\{X_n\}$ 的状态空间，对任意的 $k, m \geq 1$，以及 $t_0 < t_1 < \ldots < t_k < t_{k+1} < \ldots < t_{k+m}$，$B \subset S$，$A \subset S^k$，$C \subset S^m$，有
\[
P((X_{t_{k+1}}, X_{t_{k+2}}, \ldots, X_{t_{k+m}}) \in C | X_{t_k} \in B, (X_{t_{k-1}}, \ldots, X_{t_0}) \in A) \neq P((X_{t_{k+1}}, X_{t_{k+2}}, \ldots, X_{t_{k+m}}) \in C | X_{t_k} \in B)
\]
\end{remark}
\begin{remark}
	看不懂也没关系，不影响后面的学习
\end{remark}
\begin{example}
	质点在直线的整数点上作简单随机游动：质点到达某个状态后，下次向右移动一步的概率是 $p$，向左移动一步的概率是 $q = 1 - p$。$X_0$ 表示初始状态，$X_n$ 表示质点在时间 $n$ 的状态。假设初始状态与每次移动相互独立。则 $\{X_n\}$ 是马氏链，
\[
\begin{cases}
p_{i, i-1} = P(X_{n+1} = i - 1 | X_n = i) = q \\
p_{i, i+1} = P(X_{n+1} = i + 1 | X_n = i) = p
\end{cases}
\]
设初始分布 $P(X_0 = 0) = P(X_0 = 2) = \frac{1}{2}$，$D := \{1, 3\}$。证明：当 $p \neq q$ 时，$P(X_2 = 2 | X_0 = 0, X_1 \in D) \neq P(X_2 = 2 | X_1 \in D)$.
\end{example}
\begin{proof}
	\[
\begin{aligned}
P(X_1 = 1) &= P(X_0 = 0)P(X_1 = 1 | X_0 = 0) + P(X_0 = 2)P(X_1 = 1 | X_0 = 2) = \frac{1}{2}p + \frac{1}{2}q = \frac{1}{2}, \\
P(X_1 = 3) &= P(X_1 = 3, X_0 = 2) + P(X_1 = 3, X_0 = 0) = P(X_0 = 2)P(X_1 = 3 | X_0 = 2) = \frac{1}{2}p.
\end{aligned}
\]

故
\[
\begin{aligned}
& P(X_2 = 2 | X_1 \in D) \\
& = \frac{P(X_2 = 2, X_1 \in D)}{P(X_1 \in D)} \\
& = \frac{P(X_2 = 2, X_1 = 1) + P(X_2 = 2, X_1 = 3)}{P(X_1 \in D)} \\
& = \frac{P(X_1 = 1)P(X_2 = 2 | X_1 = 1) + P(X_1 = 3)P(X_2 = 2 | X_1 = 3)}{P(X_1 = 1) + P(X_1 = 3)} \\
& = \frac{\frac{1}{2}p + \frac{1}{2}pq}{\frac{1}{2} + \frac{1}{2}p} = p\frac{1 + q}{1 + p}
\end{aligned}
\]

\[
\begin{aligned}
& P(X_2 = 2 | X_1 \in D, X_0 = 0) \\
& = \frac{P(X_2 = 2, X_1 \in D, X_0 = 0)}{P(X_1 \in D, X_0 = 0)} \\
& = \frac{P(X_2 = 2, X_1 = 1, X_0 = 0)}{P(X_1 \in D, X_0 = 0)} \\
& = \frac{P(X_2 = 2 | X_1 = 1, X_0 = 0)}{P(X_1 \in D, X_0 = 0)} = p
\end{aligned}
\]

$P(X_2 = 2 | X_0 = 0, X_1 \in D) = P(X_2 = 2 | X_0 = 0, X_1 = 1) = p$。当 $p \neq q$ 时，$P(X_2 = 2 | X_0 = 0, X_1 \in D) \neq P(X_2 = 2 | X_1 \in D)$.

\end{proof}
\begin{theorem}
	设随机过程 $\{X_n, n \geq 0\}$ 满足：
\begin{enumerate}
    \item $X_n = f(X_{n-1}, \xi_n) (n \geq 1)$，其中 $f: S \times S \rightarrow S$，且 $\xi_n$ 取值在 $S$ 上，
    \item $\{\xi_n, n \geq 1\}$ 为独立同分布随机变量，且 $X_0$ 与 $\{\xi_n, n \geq 1\}$ 也相互独立，
\end{enumerate}
则 $\{X_n, n \geq 0\}$ 是马尔可夫链，而且其一步转移概率为
\[
p_{ij} = P(f(i, \xi_1) = j).
\]
\end{theorem}
\begin{remark}
	这个定理讲的是如何生成一个马尔可夫链。
\end{remark}
\begin{example}
	质点在直线的整数点上作简单随机游动：质点到达某个状态后，下次向右移动一步的概率是 $p$，向左移动一步的概率是 $q = 1 - p$。$X_0$ 表示初始状态，$X_n$ 表示质点在时间 $n$ 的状态。假设初始状态与每次移动相互独立。证明 $\{X_n\}$ 是马氏链，且
\[
\begin{cases}
p_{i, i-1} = P(X_{n+1} = i - 1 | X_n = i) = q \\
p_{i, i+1} = P(X_{n+1} = i + 1 | X_n = i) = p
\end{cases}
\]

\end{example}
\begin{proof}
	令 $X_n$ 为质点在时刻 $n \geq 0$ 的位置，
\[
\xi_n := 
\begin{cases}
1 & \text{第 } n \text{ 次向右移动} \\
-1 & \text{第 } n \text{ 次向左移动}
\end{cases}
\]
$X_n = X_{n-1} + \xi_n$。

转移概率：
\[
p_{ij} = P(i + \xi_1 = j) = P(\xi_1 = j - i) = 
\begin{cases}
q & j = i - 1 \\
p & j = i + 1
\end{cases}
\]
\end{proof}
\begin{remark}
	这道例题就是讲述如何生成一个马尔可夫链。
\end{remark}

设 $\{X_n, n = 0, 1, \ldots\}$ 是齐次马氏链，具有转移矩阵 $P = (p_{ij})$，则有
\[ p_{ij} \geq 0 \quad \forall i, j \in S \text{且} \sum_{j \in S} p_{ij} = 1 \quad \forall i \in S. \]
\section{转移概率矩阵}
\begin{definition}[随机矩阵]
	称矩阵 $A = (a_{ij})_{S \times S}$ 为随机矩阵，若 $a_{ij} \geq 0 (\forall i, j \in S)$，且 $\sum_{j \in S} a_{ij} = 1 (\forall i \in S)$。
\end{definition}
\begin{remark}
	随机矩阵就是转移矩阵。
\end{remark}
特别地，记 $P^0 = I(S$ 上的单位矩阵),
\[
p_{ij}^{(0)} = \delta_{ij} = 
\begin{cases} 
1 & j = i \\
0 & j \neq i 
\end{cases}
\]
且
\[
p_{ij}^{(n)} := P(X_n = j | X_0 = i) = P(X_{n+m} = j | X_m = i) \quad \text{与 } m \text{ 无关! }
\]
表示从 $i$ 出发经 $n$ 步到达 $j$ 的概率。称 $P^{(n)} := (p_{ij}^{(n)})_{i,j \in S}$ 为 $\{X_n\}$ 的 $n$ 步转移概率矩阵。显然 $P^{(n)}$ 为随机矩阵。

\begin{theorem}[Chapman-Kolmogorov 方程]
	设 $\{X_n\}$ 是齐次马氏链，具有转移矩阵 $P$，则对任意的 $m, n \geq 0$，有
\[
p_{ij}^{(n+m)} = \sum_{k \in S} p_{ik}^{(n)} p_{kj}^{(m)} \quad \forall i, j \in S, m, n \geq 0.
\]

\[
P^{(n+m)} = P^{(m)} P^{(n)} = P^{n+m}, \text{其中 } P^{n+m} \text{表示矩阵 } P \text{的} n+m \text{次乘积}
\]
\end{theorem}
\begin{proof}
	\[
\begin{aligned}
p_{ij}^{(n+m)} &= P(X_{n+m} = j | X_0 = i) = P(X_{n+m} = j, X_n \in S | X_0 = i) \\
&= \sum_{k \in S} P(X_n = k, X_{n+m} = j | X_0 = i) \\
&= \sum_{k \in S} P(X_n = k | X_0 = i) P(X_{n+m} = j | X_0 = i, X_n = k) \\
&= \sum_{k \in S} p_{ik}^{(n)} p_{kj}^{(m)}.
\end{aligned}
\]

从状态 $i$ 出发经 $n+m$ 步到达 $j$ 的概率可以由转移矩阵 $P$ 及归纳法证明。
\end{proof}
\begin{theorem}
	\[
p_{ij}^{(n+m)} = \sum_{k \in S} p_{ik}^{(n)} p_{kj}^{(m)} \quad \forall i, j \in S, m, n \geq 0.
\]

\[
P^{(n+m)} = P^{(m)} P^{(n)} = P^{n+m}, \text{其中 } P^{n+m} \text{表示矩阵} P \text{的} n+m \text{次乘积}
\]
\end{theorem}
\begin{corollary}
	对任意的正整数 $n, m, k, n_1, n_2, \cdots, n_k$ 和状态 $i, j, l$, 有
\begin{enumerate}
    \item $p_{ij}^{(n+m)} \geq p_{il}^{(n)} p_{lj}^{(m)}$;
    \item $p_{ii}^{(n+m+k)} \geq p_{ij}^{(n)} p_{jl}^{(k)} p_{li}^{(m)}$;
    \item $p_{ii}^{(n_1+n_2+\cdots+n_k)} \geq p_{ii}^{(n_1)} p_{ii}^{(n_2)} \cdots p_{ii}^{(n_k)}$;
    \item $p_{ii}^{(nk)} \geq (p_{ii}^{(n)})^k$.
\end{enumerate}

\end{corollary}
\begin{proof}
	\[
P^{(n)} = P^{(n-1)}P = P^{(n-2)}P \cdot P = \cdots = P^n.
\]
\end{proof}
\begin{example}
	已知马氏链的一步转移概率矩阵为
\[
\mathbf{P} = \begin{pmatrix}
0.7 & 0.3 \\
0.4 & 0.6
\end{pmatrix}
\]
求 $P^{(2)}$, $P^{(4)}$。
\end{example}
\begin{proof}
	\[
\mathbf{P}^{(2)} = \mathbf{P} \cdot \mathbf{P} = \begin{pmatrix}
0.61 & 0.39 \\
0.52 & 0.48
\end{pmatrix}
\]
\[
\mathbf{P}^{(4)} = \mathbf{P}^{(2)} \cdot \mathbf{P}^{(2)} = \begin{pmatrix}
0.5749 & 0.4251 \\
0.5668 & 0.4332
\end{pmatrix}
\]
\end{proof}
\begin{example}
	系统的状态是 $0 \sim n$，反映赌博者在赌博期间拥有的钱数，当他输光或拥有钱数为 $n$ 时，赌博停止，否则他将持续赌博。每次以概率 $p$ 赢得 1，以概率 $q = 1 - p$ 输掉 1。这个系统的转移矩阵为
\[
\mathbf{P} = \begin{pmatrix}
1 & 0 & 0 & 0 & \cdots & 0 & 0 & 0 \\
q & 0 & p & 0 & \cdots & 0 & 0 & 0 \\
0 & q & 0 & p & \cdots & 0 & 0 & 0 \\
\vdots & \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots \\
0 & 0 & 0 & 0 & \cdots & q & 0 & p \\
0 & 0 & 0 & 0 & \cdots & 0 & 0 & 1
\end{pmatrix}_{(n+1) \times (n+1)}
\]
$n = 3$, $p = q = \frac{1}{2}$。赌博者从 2 元赌金开始赌博，求解他经过 4 次赌博之后输光的概率。
\end{example}
\begin{proof}
	这个概率为 $p_{20}^{(4)} = P\{X_4 = 0 | X_0 = 2\}$，一步转移矩阵为
\[
\mathbf{P} = \begin{pmatrix}
1 & 0 & 0 & 0 \\
\frac{1}{2} & 0 & \frac{1}{2} & 0 \\
0 & \frac{1}{2} & 0 & \frac{1}{2} \\
0 & 0 & 0 & 1
\end{pmatrix}
\]
利用矩阵乘法得
\[
\mathbf{P}^{(4)} = \mathbf{P}^4 = \begin{pmatrix}
1 & 0 & 0 & 0 \\
\frac{5}{16} & \frac{1}{16} & 0 & \frac{5}{16} \\
\frac{5}{16} & 0 & \frac{1}{16} & \frac{5}{8} \\
0 & 0 & 0 & 1
\end{pmatrix}
\]
故 $p_{20}^{(4)} = \frac{5}{16}$ ($\mathbf{P}^{(4)}$ 中第 3 行第 1 列)。

\end{proof}
\begin{example}
	甲乙两人进行某种比赛，设每局甲胜的概率是 $p$，乙胜的概率是 $q$，和局的概率是 $r$，$p + q + r = 1$。设每局比赛后，胜者记 “+1” 分，负者记 “-1” 分，和局不记分，且当两人中有一人获得 2 分时结束比赛。以 $X_n$ 表示比赛至第 $n$ 局时甲获得的分数，则 $\{X_n, n = 0, 1,2,\cdots\}$ 为时齐 Markov 链，求在甲获得 1分的情况下，不超过两局可结束比赛的概率。


\end{example}
\begin{proof}
	$\{X_n, n = 0, 1, 2,\cdots\}$ 的一步转移概率矩阵为
\[
\mathbf{P} = 
\begin{pmatrix}
-2 & 1 & 0 & 0 & 0 & 0 & 0 \\
-1 & q & r & p & 0 & 0 & 0 \\
0 & 0 & q & r & p & 0 & 0 \\
1 & 0 & 0 & 0 & q & r & p \\
2 & 0 & 0 & 0 & 0 & 0 & 1
\end{pmatrix}
\]

两步转移概率矩阵为
\[
\mathbf{P}^{(2)} = \mathbf{P} \cdot \mathbf{P} = 
\begin{pmatrix}
1 & 0 & 0 & 0 & 0 & 0 \\
q + rq & r^2 + pq & 2pr & p^2 & 0 & 0 \\
q^2 & 2rq & r^2 + 2pq & 2pr & p^2 & 0 \\
0 & q^2 & 2qr & r^2 + pq & p + pr & 0 \\
0 & 0 & 0 & 0 & 0 & 1
\end{pmatrix}
\]

故在甲获得 1分的情况下，不超过两局可结束比赛的概率为
\[
p_{1,2}^{(2)} + p_{1,-2}^{(2)} = p + pr
\]
\end{proof}

\begin{example}
	质点在直线的整数点上作简单随机游动：质点到达某个状态后，下次向右移动一步的概率是 $p$，向左移动一步的概率是 $q = 1 - p$。$X_0$ 表示初始状态，$X_n$ 表示质点在时间 $n$ 的状态。假设初始状态与每次移动相互独立。则 $\{X_n\}$ 是马氏链，求 $P^{(n)}$。

\[
\begin{cases}
p_{i, i-1} = P(X_{n+1} = i - 1 | X_n = i) = q \\
p_{i, i+1} = P(X_{n+1} = i + 1 | X_n = i) = p
\end{cases}
\]


\end{example}
\begin{proof}
从 $i$ 经过 $n$ 步到 $j$，其中向左走了 $x$ 步，向右走了 $y$ 步。则有
\[
\begin{cases}
x + y = n \\
i - x + y = j
\end{cases}
\]
故 $x = \frac{n - (j - i)}{2}$ 且 $y = \frac{n + j - i}{2}$，其中 $n + j - i$ 必须是偶数 $(n + j - i) + [n - (j - i)] = 2n$。

\[
p_{ij}^{(n)} = 
\begin{cases} 
C_n^{(n+j-i)/2} p^{(n+j-i)/2} q^{(n-j+i)/2} & n + j - i \text{为偶数} \\
0 & n + j - i \text{为奇数}
\end{cases}
\]
\end{proof}

回顾 $p_{ij}^{(n)} = P(X_n = j | X_0 = i)$ 与 $P(X_n = j)$

\[
\pi_i(n) = P(X_n = i), i \in \mathcal{S},
\]
\[
\pi(n) = (\pi_i(n), i \in \mathcal{S}).
\]
即 $\pi(n)$ 表示 $n$ 时刻 $X_n$ 的概率分布，称 $\pi(0) := (\pi_i(0), i \in \mathcal{S})$ 为马氏链 $\{X_n, n = 0, 1, \ldots\}$ 的初始分布。

对任意的 $n \geq 0$，
\[
\sum_{i \in \mathcal{S}} \pi_i(n) = P(X_n \in \mathcal{S}) = 1.
\]
\begin{theorem}
	\[
\pi(n + 1) = \pi(n) \mathbf{P}, \quad \pi(n) = \pi(0) \mathbf{P}^n,
\]
其中 $\mathbf{P}^n$ 是 $\mathbf{P}$ 的 $n$ 次幂，特别有 $\pi(n) = \pi(k) \mathbf{P}^{n-k}$, $0 \leq k \leq n$.

\end{theorem}
\begin{proof}
	\[
\begin{aligned}
\pi_j(n + 1) &= P(X_{n+1} = j) = P(X_n \in \mathcal{S}, X_{n+1} = j) \\
&= \sum_{i \in \mathcal{S}} P(X_n = i, X_{n+1} = j) \\
&= \sum_{i \in \mathcal{S}} P(X_n = i) P(X_{n+1} = j | X_n = i) = \sum_{i \in \mathcal{S}} \pi_i(n) p_{ij}.
\end{aligned}
\]

令 $P_{:,j} := (p_{ij}, i \in \mathcal{S})'$ 为一步转移概率矩阵的第 $j$ 列。

则 $\pi_j(n + 1) = \pi(n) P_{:j}$。写成向量形式，即为 $\pi(n + 1) = \pi(n) \mathbf{P}$.
\end{proof}

由马氏性可得：对任意 $i_0, i_1, \ldots, i_m \in \mathcal{S}$，
和 $n_0 < n_1 < \cdots < n_m$ 有
\[
\begin{aligned}
& P(X_{n_0} = i_0, X_{n_1} = i_1, \ldots, X_{n_{m-1}} = i_{m-1}, X_{n_m} = i_m) \\
&= P(X_{n_0} = i_0, X_{n_1} = i_1, \ldots, X_{n_{m-1}} = i_{m-1}) \cdot P(X_{n_m} = i_m | X_{n_0} = i_0, X_{n_1} = i_1, \ldots, X_{n_{m-1}} = i_{m-1}) \\
&= P(X_{n_0} = i_0, X_{n_1} = i_1, \ldots, X_{n_{m-1}} = i_{m-1}) P(X_{n_m} = i_m | X_{n_{m-1}} = i_{m-1}) \\
&= P(X_{n_0} = i_0, \ldots, X_{n_{m-2}} = i_{m-2}) \cdot P(X_{n_{m-1}} = i_{m-1} | X_{n_{m-2}} = i_{m-2}, \ldots, X_{n_1} = i_1, X_{n_0} = i_0) p_{i_{m-1} i_m}^{(n_m - n_{m-1})} \\
&= \cdots \\
&= \pi_{i_0}(n_0) p_{i_0 i_1}^{(n_1 - n_0)} p_{i_1 i_2}^{(n_2 - n_1)} \cdots p_{i_{m-1} i_m}^{(n_m - n_{m-1})}.
\end{aligned}
\]
从而知，马氏链 $\{X_n, n = 0, 1, \cdots\}$ 的任何有限维联合分布由转移矩阵 $\mathbf{P}$ 及其初始分布完全确定。
\begin{example}
	\[
\begin{aligned}
& P(X_2 = 1, X_5 = 3, X_7 = 2) \\
&= P(X_5 = 3, X_2 = 1) P(X_7 = 2 | X_5 = 3, X_2 = 1) \\
&= P(X_2 = 1) P(X_5 = 3 | X_2 = 1) P(X_7 = 2 | X_5 = 3) \\
&= \pi_1(2) p_{13}^{(3)} p_{32}^{(2)}
\end{aligned}
\]
\end{example}

上面讨论可知，给定齐次马氏链，可得一随机矩阵 $\mathbf{P}$，而且该马氏链的若干转移概率均可由 $\mathbf{P}$ 确定。反之，若给定一随机矩阵 $\mathbf{P}$，我们可否确定一齐次马氏链，使其转移概率为给定的 $\mathbf{P}$ 相同？答案是肯定的！

\begin{theorem}[马氏链的存在性]
	 对任给的随机矩阵 $\mathbf{P} = (p_{ij})_{S \times S}$，$S$ 上的概率分布为 $\mu = \{\mu_i, i \in \mathcal{S}\}$，存在唯一的概率空间 $(\Omega, \mathcal{F}, \tilde P)$ 及其上的随机过程 $\{X_n, n = 0, 1, \cdots\}$ 使得：
\begin{enumerate}
    \item $\mu$ 为该过程的初始分布，即 $\tilde P(X_0 = i) = \mu_i, i \in \mathcal{S}$;
    \item $\{X_n, n = 0, 1, \cdots\}$ 是以 $\mathbf{P}$ 为转移矩阵的齐次马氏链，即
    \[
    \tilde P(X_{n+1} = j | X_n = i) = p_{ij} \quad \forall i, j \in \in \mathcal{S}, n \geq 0.
    \]
\end{enumerate}
\end{theorem}
\section{状态的分类及性质}
\begin{definition}
	设 $S$ 是 Markov Chain $\{X_n\}$ 的状态空间
\begin{enumerate}
    \item 如果 $p_{ii} = 1$，则称 $i$ 是吸收状态（即可知 $p_{ii}^{(n)} \equiv 1, n \geq 1$）;
    \item 称状态 $i$ 可达状态 $j$，如果存在状态 $i_1, \ldots, i_n \in S$，使得 $p_{i_1 i_2} p_{i_2 i_3} \cdots p_{i_n j} > 0$。或等价地，存在 $n \geq 0$，使得 $p_{ij}^{(n)} > 0$，则称 $i$ 通 $j$，记为 $i \rightarrow j$.
    \item 如果 $i \rightarrow j$ 且 $j \rightarrow i$，则称 $i$ 与 $j$ 是互通的，记为 $i \leftrightarrow j$. 若对一切 $i, j \in S$，均有 $i \leftrightarrow j$ 成立，则称转移矩阵（或马氏链）是不可约.
\end{enumerate}
\end{definition}
\begin{remark}
	$\rightarrow$ 具有传递性。即若 $i \rightarrow j$ 且 $j \rightarrow k$，则 $i \rightarrow k$. 理由：存在 $n, m, s.t. p_{ij}^{(n)} > 0$ 且 $p_{jk}^{(m)} > 0$，则由 $C-K$ 方程 $p_{ik}^{(n+m)} \geq p_{ij}^{(n)} p_{jk}^{(m)} > 0$.
\end{remark}
\begin{proposition}
	互通有下列关系
\begin{enumerate}
    \item 对称性 $i \leftrightarrow j$, 则 $j \leftrightarrow i$;
    \item 传递性 $i \leftrightarrow j, j \leftrightarrow k$, 则 $i \leftrightarrow k$;
\end{enumerate}
\end{proposition}
\begin{example}
	记某设备的状态为 $1, 2, 3$，其中 $1$ 表示设备运行良好，$2$ 表示运行正常，$3$ 表示设备失效。以 $X_n$ 表示设备在时刻 $n$ 的状态，且假设 $\{X_n, n = 0, 1, \ldots\}$ 是齐次马氏链。在有维修及更换条件下，其转移矩阵为
\[
\mathbf{P} = 
\begin{pmatrix}
\frac{2}{3} & \frac{3}{12} & \frac{1}{12} \\
0 & \frac{4}{5} & \frac{1}{5} \\
0 & 0 & 1
\end{pmatrix}
\]

试说明: $1 \rightarrow 2$, $2 \rightarrow 3$, $3$ 是吸收的。
\end{example}



% 在文档末尾添加如下TikZ图
\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        % 定义节点
        \node[circle, draw] (1) at (0,0) {1};
        \node[circle, draw] (2) at (3,0) {2};
        \node[circle, draw] (3) at (6,0) {3};
        
        % 绘制转移概率 - 准确匹配图片
        \draw[->, thick] (1) to[bend left=20] node[above] {$\frac{1}{2}$} (2);
        \draw[->, thick] (2) to[bend left=20] node[above] {$\frac{2}{3}$} (3);
        \draw[->, thick] (1) to[bend left=40] node[above] {$\frac{4}{5}$} (3);
		\draw[->, thick] (3) edge [loop right] node {$1$} (3);
		\draw[->, thick] (2) edge [loop right] node {$\frac{4}{5}$} (2);
		\draw[->, thick] (1) edge [loop right] node {$\frac{2}{3}$} (1);
    \end{tikzpicture}
\end{figure}
\begin{proof}
	如图
\end{proof}

\begin{example}
	记马氏链 $\{X_n, n \geq 0\}$ 的状态空间 $S = \{1, 2, 3\}$。对应的一步转移概率矩阵为

\[
\mathbf{P} = 
\begin{pmatrix}
\frac{1}{3} & 0 & \frac{2}{3} \\
0 & 1 & 0 \\
0 & \frac{1}{3} & \frac{2}{3}
\end{pmatrix}
\]

则状态1是否可达状态2？
\end{example}
\begin{proof}
	\begin{figure}[H]
		\centering
		\begin{tikzpicture}[node distance=1.5cm, on grid, auto]
		\tikzset{
			state/.style={circle, draw=black, thick, minimum width=1em},
			arrow/.style={thick, ->, >={Latex[width=1mm, length=1mm]}}
		}
	
		% 定义节点
		\node[state] (1) {1};
		\node[state] (2) [right=of 1] {2};
		\node[state] (3) [right=of 2] {3};
	
		% 绘制箭头并添加概率值
		\path [arrow] (1) edge [loop left] node {$\frac{1}{3}$} (1);
		\path [arrow] (1) edge [bend left] node[above] {$\frac{2}{3}$} (3);
		\path [arrow] (2) edge [loop left] node {$1$} (2);
		\path [arrow] (3)edge[bend left] node[above] {$\frac{2}{3}$} (2);
		\path [arrow] (3) edge [loop right] node {$\frac{2}{3}$} (3);
	\end{tikzpicture}
\end{figure}

虽然 \(p_{12} = 0\)，但 \(p_{12}^{(2)} \geq p_{13} p_{32} = \frac{2}{9} > 0\)。故仍然有 \(1 \rightarrow 2\)。

\end{proof}
\begin{definition}[周期]\label{3.4}
	集合 $\{n, p_{ii}^{(n)} > 0\}$ 非空，$d(i)$ 为 $\{n, p_{ii}^{(n)} > 0\}$ 的最大公约数，则称 $d(i)$ 为 $i$ 的周期。特别地，当 $d(i) = 1$ 时，称 $i$ 为非周期的。若集合 $\{n, p_{ii}^{(n)} > 0\} = \emptyset$，则称 $i$ 的周期为 $\infty$。
\end{definition}

假设 $i$ 状态为 $d$，能不能推出对所有的 $n$，$p_{ii}^{(nd)} > 0$？

\begin{remark}

	由定义\ref{3.4} 知道，虽然有周期 $d$，但并不是对所有的 $n$，$p_{ii}^{(nd)}$ 都大于 0。

但是可以证明，当 $n$ 充分大之后一定有 $p_{ii}^{(dn)} > 0$。

\end{remark}
\begin{example}
	考察如下图
	
	\begin{tikzpicture}[node distance=2cm, on grid, auto]
		\tikzset{
			state/.style={circle, draw=black, thick, minimum width=1em},
			arrow/.style={thick, ->, >={Latex[width=1mm, length=1mm]}}
		}
	
		% 定义节点
		\node[state] (1) {1};
		\node[state] (2) [above right=of 1] {2};
		\node[state] (3) [right=of 2] {3};
		\node[state] (4) [below right=of 3] {4};
		\node[state] (5) [below left=of 1] {5};
		\node[state] (6) [left=of 5] {6};
		\node[state] (7) [above left=of 6] {7};
		\node[state] (8) [above=of 7] {8};
		\node[state] (9) [above right=of 8] {9};
	
		% 绘制边并添加权重
		\path [arrow] (7) edge node {$1$} (8);
		\path [arrow] (8) edge node {$1$} (9);
		\path [arrow] (9) edge node {$1$} (1);
		\path [arrow] (6) edge node {$1$} (7);
		\path [arrow] (1) edge node {$\frac{2}{3}$} (5);
		\path [arrow] (5) edge node {$1$} (6);
		\path [arrow] (6) edge node {$1$} (5);
		\path [arrow] (1) edge node {$\frac{1}{3}$} (2);
		\path [arrow] (2) edge node {$1$} (3);
		\path [arrow] (3) edge node {$1$} (4);
		\path [arrow] (4) edge node {$1$} (1);
	\end{tikzpicture}

	由状态 1 出发再回到状态 1 的可能步长为 $T = \{4, 6, 8, 10, \cdots\}$，它的最大公约数是 2，虽然从状态 1 出发 2 步并不能回到状态 1，我们仍然称 2 是状态 1 的周期。
	
\end{example}
\begin{example}
	如果质点每次向前、向后移动一步的概率是 $\frac{1}{3}$，向后移动两步概率为 $\frac{1}{3}$，则每个状态均为非周期的。
\end{example}
\begin{proof}
	对任意的 $i$，$p_{i,i+1} = p_{i,i-1} = p_{i,i-2} = \frac{1}{3}$.

$p_{ii}^{(2)} \geq p_{i,i+1} p_{i+1,i} = \frac{1}{3} \cdot \frac{1}{3} > 0$.

$p_{ii}^{(3)} \geq p_{i,i-2} p_{i-2,i-1} p_{i-1,i} = \left(\frac{1}{3}\right)^3 > 0$.

由于 $2, 3$ 互素，可知 $i$ 非周期。
\end{proof}
\begin{example}
	在直线上，如果质点每次向前移动一步的概率为 $p$，向后移动5步概率是 $q = 1 - p$，$pq > 0$，则每个状态周期均为6。

\end{example}
\begin{proof}
	任取 $n$ 满足 $p_{ii}^{(n)} > 0$，则记向前移动次数为 $x$，向后移动的次数记为 $y$。

\begin{equation*}
\begin{cases}
x + y = n \\
x = 5y
\end{cases}
\end{equation*}

故可知 $n = 6y$。同时 $p_{ii}^{(6)} \geq p_{i,i+1} p_{i+1,i+2} p_{i+2,i+3} p_{i+3,i+4} p_{i+4,i+5} p_{i+5,i} > 0$。故周期为6。

\end{proof}
\begin{theorem}
	设 $i \leftrightarrow j$，则 $d(i) = d(j)$。

证明 $d(i) | d(j)$ 且 $d(j) | d(i)$。证明 $d(i)$ 为 $\{k | p_{jj}^{(k)} > 0\}$ 的公约数。
\end{theorem}
\begin{proof}
	令 $p_{ii}^{(r)} > 0$, $p_{ij}^{(s)} > 0 (r, s \geq 1)$。任取 $n \in \{k | p_{jj}^{(k)} > 0\}$。则有
\[
p_{ii}^{(r+n+s)} \geq p_{ij}^{(s)} p_{jj}^{(n)} p_{ji}^{(r)} > 0, \quad p_{ii}^{(r+s)} \geq p_{ij}^{(s)} p_{ji}^{(r)} > 0.
\]
从而由周期的定义知 $d(i) | (r+n+s)$, $d(i) | (r+s)$，故有 $d(i) | n$。于是 $d(i)$ 为 $\{k | p_{jj}^{(k)} > 0\}$ 的公约数。因此，$d(i) | d(j)$。同理可得 $d(j) | d(i)$。
\end{proof}
\begin{lemma}
	设 $m \geq 2$，正整数 $s_1, s_2, \ldots, s_m$ 的最大公因数为 $d$，则存在正整数 $N$，使得 $n > N$ 时，必有非负整数 $c_1, c_2, \ldots, c_m$ 使得 $nd = \sum_{i=1}^{m} c_i s_i$。
\end{lemma}

\begin{theorem}\label{3.7}
	设 $i \in S$, $d(i) \geq 1$，则存在 $N \geq 1$ 使得 $p_{ii}^{(nd(i))} > 0$ 对一切 $n \geq N$ 成立。
\end{theorem}
\begin{proof}
	将集合 $\{n \geq 1 : p_{ii}^{(n)} > 0\}$ 按其中元素递增的顺序重新排列成 $\{n_1, \ldots, n_k, \ldots\}$。令 $\hat{d}_k$ 为 $\{n_1, n_2, \ldots, n_k\}$ 的最大公约数，则有
\[
\hat{d}_1 \geq \hat{d}_2 \geq \ldots \geq \hat{d}_k \geq \hat{d}_{k+1} \geq \ldots \geq d(i)。
\]
因 $\hat{d}_i$ 和 $d(i)$ 均有限，故存在 $n_0$ 使得：$\hat{d}_k = d(i)$ 对一切 $k > n_0$。则由初等数论知：$\exists N \geq 1$，当 $n \geq N$ 时，有非负整数 $s_1 \geq 0, \ldots, s_{n_0} \geq 0$ 使得 $nd(i) = s_1 n_1 + \ldots + s_{n_0} n_{n_0}$。故
\[
p_{ii}^{(nd(i))} \geq (p_{ii}^{(n_1)})^{s_1} \ldots (p_{ii}^{(n_{n_0})})^{s_{n_0}} > 0。
\]
\end{proof}
\section{常返性}
\begin{definition}[首达时间]
	设对 $j \in S$，令
\[
T_{ij} := 
\begin{cases} 
\min\{n:, n \geq 1, X_n = j, X_0 = i\} & \text{若} \{n \geq 1 | X_n = j, X_0 = i\} \neq \emptyset \\
+\infty & \text{若} \{n \geq 1 | X_n = j, X_0 = i\} = \emptyset.
\end{cases}
\]
若 $X_0 = i$，则称 $T_{ij}$ 为从 $i$ 出发首次到达 $j$ 的时间，而 $T_{ii}$ 则表示从 $i$ 出发首次回到 $i$ 的时间。
\end{definition}
\begin{definition}[首达概率]
	对 $i, j \in S$，令
\[
f_{ij}^{(n)} = P(T_{ij} = n | X_0 = i), \quad n \geq 1.
\]
称 $f_{ij}^{(n)}$ 为从 $i$ 出发经过 $n$ 步首次到达 $j$ 的概率。$f_{ii}^{(n)}$ 为从 $i$ 出发经过 $n$ 步首次回到 $i$ 的概率。
\end{definition}
由定义易知：
\begin{align*}
f_{ij}^{(n)} &= P(X_k \neq j, 1 \leq k \leq n-1, X_n = j | X_0 = i) \\
&= \sum_{i_k \neq j, 1 \leq k \leq n-1} P(X_k = i_k, 1 \leq k \leq n-1, X_n = j | X_0 = i) \\
&= \sum_{i_k \neq j, 1 \leq k \leq n-1} p_{ii_1} p_{i_1 i_2} \cdots p_{i_{n-1} j} \\
&= \sum_{i_{n-1} \neq j} \sum_{i_{n-2} \neq j} \cdots \sum_{i_1 \neq j} p_{ii_1} p_{i_1 i_2} \cdots p_{i_{n-1} j}
\end{align*}

\begin{example}
	记某设备的状态为 $1, 2, 3$，其中 $1$ 表示设备运行良好，$2$ 表示运行正常，$3$ 表示设备失效。以 $X_n$ 表示设备在时刻 $n$ 的状态，且假设 $\{X_n, n = 0, 1, \ldots\}$ 是齐次马氏链。在有维修及更换条件下，其转移矩阵为
\[
\mathbf{P} = \begin{pmatrix}
\frac{2}{3} & \frac{3}{12} & \frac{1}{12} \\
0 & \frac{4}{5} & \frac{1}{5} \\
0 & 0 & 1
\end{pmatrix}
\]
求 $f_{13}^{(1)}$，$f_{13}^{(2)}$，$f_{13}^{(3)}$。
\end{example}
\begin{proof}
	\begin{figure}[H]
		\centering
		\begin{tikzpicture}
			% 定义节点
			\node[circle, draw] (1) at (0,0) {1};
			\node[circle, draw] (2) at (3,0) {2};
			\node[circle, draw] (3) at (6,0) {3};
			
			% 绘制转移概率 - 准确匹配图片
			\draw[->, thick] (1) to[bend left=20] node[above] {$\frac{1}{2}$} (2);
			\draw[->, thick] (2) to[bend left=20] node[above] {$\frac{2}{3}$} (3);
			\draw[->, thick] (1) to[bend left=40] node[above] {$\frac{4}{5}$} (3);
			\draw[->, thick] (3) edge [loop right] node {$1$} (3);
			\draw[->, thick] (2) edge [loop right] node {$\frac{4}{5}$} (2);
			\draw[->, thick] (1) edge [loop right] node {$\frac{2}{3}$} (1);
		\end{tikzpicture}
	\end{figure}

	\begin{enumerate}
		\item $f_{13}^{(1)} = P(T_{13} = 1 | X_0 = 1) = p_{13} = \frac{1}{12}$;
		\item $f_{13}^{(2)} = p_{11} p_{13} + p_{12} p_{23} = \frac{19}{180}$;
		\item $P(T_{13} \geq 3 | X_0 = 1) = 1 - f_{13}^{(1)} - f_{13}^{(2)} = \frac{73}{90}$. 表示设备在 $[0,3]$ 内运行的可靠性。
	\end{enumerate}
	\begin{align*}
		f_{13}^{(3)} &= P(T_{13} = 3 | X_0 = 1) \\
		&= P(X_3 = 3, X_2 \neq 3, X_1 \neq 3 | X_0 = 1) \\
		&= P(X_3 = 3, X_2 = 1, X_1 = 1 | X_0 = 1) \\
		&\quad + P(X_3 = 3, X_2 = 1, X_1 = 2 | X_0 = 1) \\
		&\quad + P(X_3 = 3, X_2 = 2, X_1 = 1 | X_0 = 1) \\
		&\quad + P(X_3 = 3, X_2 = 2, X_1 = 2 | X_0 = 1) \\
		&= \frac{1}{27} + 0 + \frac{1}{30} + \frac{1}{25} = \frac{149}{1350}
		\end{align*}
\end{proof}
\begin{align*}
	f_{ij} & := \sum_{n=1}^{\infty} f_{ij}^{(n)} \\
	& = \sum_{n=1}^{\infty} P(X_k \neq j, 1 \leq k \leq n-1, X_n = j | X_0 = i) \\
	& = \sum_{n=1}^{\infty} P(T_{ij} = n | X_0 = i) = P(T_{ij} < \infty | X_0 = i)
\end{align*}
	
	$f_{ij} := \sum_{n=1}^{\infty} f_{ij}^{(n)}$ 表示从 $i$ 出发经有限步首次到达 $j$ 的概率。同理可解释 $f_{ii}$

\begin{definition}[常返状态]
	若 $f_{ii} = 1$，则称 $i$ 为常返。否则，称 $i$ 为非常返（或暂留，瞬时的）。

\end{definition}
\begin{remark}

	吸收状态 $i$ 满足 $f_{ii} = f_{ii}^{(1)} = 1$
\end{remark}

下面分析各状态的性质，以及如何根据转移矩阵 $P$ 来判断其常返性，不可约性等。
\begin{theorem}
	对任意 $i, j \in S$, $n \geq 1$，有：
\begin{enumerate}\label{4.4}
    \item[(a)] $p_{ij}^{(n)} = \sum_{m=1}^{n} f_{ij}^{(m)} p_{ij}^{(n-m)}$（注意，$p_{ij}^{(0)} \equiv 1$）；
    \item[(b)] $f_{ij}^{(n)} = \sum_{k \neq j} p_{ik} f_{kj}^{(n-1)} I_{\{n > 1\}} + p_{ij} I_{\{n=1\}}$；
    \item[(c)] $i \rightarrow j \Longleftrightarrow f_{ij} > 0$; $i \leftrightarrow j \Longleftrightarrow f_{ij} f_{ji} > 0$。
\end{enumerate}

\end{theorem}
\begin{remark}
	由 (a) 可知 $p_{ij}^{(n)} \geq f_{ij}^{(n)}$
\end{remark}
\begin{proof}
	\begin{enumerate}
		\item[(a)] 证明用的是首次进入方法。即依照首次进入状态 $j$ 的时刻进行分解（即下面的第二个等式）：
		\begin{align*}
		p_{ij}^{(n)} &= P(X_n = j | X_0 = i) = P(X_n = j, T_{ij} \leq n | X_0 = i) \\
		&= \sum_{m=1}^{n} P(T_{ij} = m, X_n = j | X_0 = i) \\
		&= \sum_{m=1}^{n} P(T_{ij} = m | X_0 = i) P(X_n = j | X_0 = i, T_{ij} = m) \\
		&= \sum_{m=1}^{n} f_{ij}^{(m)} P(X_n = j | X_0 = i, X_1 \neq j, \ldots, X_{m-1} \neq j, X_m = j) \\
		&= \sum_{m=1}^{n} f_{ij}^{(m)} p_{ij}^{(n-m)}.
		\end{align*}
		\item[(b)] 当 $n = 1$ 时，由 $f_{ij}^{(1)} = p_{ij}$，结论显然成立。对 $n \geq 2$，因为
		\[
		\{T_{ij} = n\} = \{X_1 \neq j, \ldots, X_{n-1} \neq j, X_n = j\}
		\]
		\[
		= \bigcup_{k \neq j} \{X_1 = k, X_2 \neq j, \ldots, X_{n-1} \neq j, X_n = j\}.
		\]
		\begin{align*}
		f_{ij}^{(n)} &= P(T_{ij} = n | X_0 = i) \\
		&= \sum_{k \neq j} P(X_1 = k, X_2 \neq j, \ldots, X_{n-1} \neq j, X_n = j | X_0 = i) \\
		&= \sum_{k \neq j} p_{ik} \cdot P(X_2 \neq j, \ldots, X_{n-1} \neq j, X_n = j | X_0 = i, X_1 = k) \\
		&= \sum_{k \neq j} p_{ik} f_{kj}^{(n-1)}.
		\end{align*}
		（马氏性与齐次性）
		\item[(c)] 由 (a) 知 $p_{ij}^{(n)} \geq f_{ij}^{(n)} (\forall i \in S, n \geq 1)$。当 $f_{ij} > 0$ 时，有 $i \rightarrow j$。另一方面，若 $i \rightarrow j$，则有 $n \geq 1$ 使得 $p_{ij}^{(n)} > 0$。当 $n = 1$ 时，知 $f_{ij}^{(1)} = p_{ij}^{(1)} > 0$，从而 $f_{ij} > 0$。当 $n \geq 2$ 时，由 (a) 知，
		\[
		p_{ij}^{(n)} = \sum_{m=1}^{n} f_{ij}^{(m)} p_{ij}^{(n-m)} > 0.
		\]
		故有 $1 \leq m \leq n$ 使得 $f_{ij}^{(m)} > 0$，从而 $f_{ij} > 0$。
	\end{enumerate}
\end{proof}

下面有一个有意思的结论，务必要记下来
\begin{proposition}
	\begin{align*}
	f_{ij}^{(k)} &= P(X_k \neq j, 1 \leq k \leq n-1, X_n = j | X_0 = i) \\
	&= \sum_{i_k \neq j, 1 \leq k \leq n-1} p_{ii_1} p_{i_1 i_2} \cdots p_{i_{n-1} j} \\
	&= \sum_{i_{n-1} \neq j} \sum_{i_{n-2} \neq j} \cdots \sum_{i_1 \neq j} p_{ii_1} p_{i_1 i_2} \cdots p_{i_{n-1} j} \\
	&= \sum_{i_{n-1} \neq j} \left( \sum_{i_{n-2} \neq j} \cdots \left( \sum_{i_2 \neq j} \left( \sum_{i_1 \neq j} p_{ii_1} p_{i_1 i_2} \right) p_{i_2 i_3} \right) \cdots p_{i_{n-2} i_{n-1}} \right) p_{i_{n-1} j} \\
	&= \sum_{i_1 \neq j} p_{i_1 i_1} \left( \sum_{i_2 \neq j} \cdots \sum_{i_{n-3} \neq j} \left( \sum_{i_{n-2} \neq j} \left( \sum_{i_{n-1} \neq j} p_{i_{n-2} i_{n-1}} p_{i_{n-1} j} \right) \right) \right).
	\end{align*}
	
	
	
	\end{proposition}
	用矩阵表示：对任意的 $k \geq 2$，
	\[
f_{ij}^{(k)} = 
\begin{pmatrix}
p_{i1} & p_{i2} & \cdots & p_{i,j-1} & p_{i,j+1} & \cdots & p_{in}
\end{pmatrix}
\begin{pmatrix}
p_{11} & p_{12} & \cdots & p_{1,j-1} & p_{1,j+1} & \cdots & p_{1n} \\
p_{21} & p_{22} & \cdots & p_{2,j-1} & p_{2,j+1} & \cdots & p_{2n} \\
\vdots & \vdots & \ddots & \vdots & \vdots & \ddots & \vdots \\
p_{j-1,1} & p_{j-1,2} & \cdots & p_{j-1,j-1} & p_{j-1,j+1} & \cdots & p_{j-1,n} \\
p_{j+1,1} & p_{j+1,2} & \cdots & p_{j+1,j-1} & p_{j+1,j+1} & \cdots & p_{j+1,n} \\
\vdots & \vdots & \ddots & \vdots & \vdots & \ddots & \vdots \\
p_{n1} & p_{n2} & \cdots & p_{n,j-1} & p_{n,j+1} & \cdots & p_{nn}
\end{pmatrix}
^{k-2}
\begin{pmatrix}
p_{1j} \\
p_{2j} \\
\vdots \\
p_{j-1,j} \\
p_{j+1,j} \\
\vdots \\
p_{nj}
\end{pmatrix}
\]
\begin{remark}
	左边行向量是转移矩阵的第 $i$ 行去掉第 $j$ 个元素，右边列向量是转移矩阵的第 $j$ 列去掉第 $i$ 个元素，中间的矩阵是转移矩阵去掉第 $j$ 行和第 $j$ 列。
\end{remark}


\begin{example}
	\[
\mathbf{P} = \begin{pmatrix}
\frac{2}{3} & \frac{3}{12} & \frac{1}{12} \\
0 & \frac{4}{5} & \frac{1}{5} \\
0 & 0 & 1
\end{pmatrix}
\]

求 $f_{13}^{(3)}$。
\end{example}
\begin{proof}
	\begin{align*}
		f_{13}^{(3)} &= \left( \begin{array}{cc}
		\frac{2}{3} & \frac{3}{12}
		\end{array} \right)
		\left( \begin{array}{ccc}
		\frac{2}{3} & \frac{3}{12}  \\
		0 & \frac{4}{5} 
		\end{array} \right)
		\left( \begin{array}{c}
		\frac{1}{12} \\
		\frac{1}{5}
		\end{array} \right) \\
		&= \frac{149}{1350}
		\end{align*}
\end{proof}
\begin{theorem}
	\begin{enumerate}
		\item[(1)] $\sum_{n=0}^{\infty} p_{ii}^{(n)} = \frac{1}{1 - f_{ii}}$
		\item[(2)] $i$ 常返 $\Longleftrightarrow \sum_{n=0}^{\infty} p_{ii}^{(n)} = +\infty$
		\item[(3)] $i$ 非常返 $\Longleftrightarrow \sum_{n=0}^{\infty} p_{ii}^{(n)} = \frac{1}{1 - f_{ii}} < \infty$
	\end{enumerate}
\end{theorem}\label{4.5}
\begin{proof}
	(1,2,3) 引进母函数：
\[
P_{ij}(s) \triangleq \sum_{n=0}^{\infty} s^n p_{ij}^{(n)}, \quad F_{ij}(s) \triangleq \sum_{n=1}^{\infty} s^n f_{ij}^{(n)}, \quad s \in (0, 1).
\]
于是有：
\begin{align*}
\sum_{n=1}^{\infty} p_{ij}^{(n)} s^n &= \sum_{n=1}^{\infty} \left[ \sum_{m=1}^{n} f_{ij}^{(m)} p_{ij}^{(n-m)} \right] s^n = \sum_{m=1}^{\infty} \left[ f_{ij}^{(m)} s^m \sum_{n=m}^{\infty} p_{ij}^{(n-m)} s^{n-m} \right], \\
P_{ij}(s) - \delta_{ij} &= P_{ij}(s) F_{ij}(s).
\end{align*}
这样有：$F_{ii}(s) = 1 - \frac{1}{P_{ii}(s)}$。任取 $N > 1$，则有
\[
\sum_{n=0}^{N} p_{ii}^{(n)} s^n < P_{ii}(s) < \sum_{n=0}^{\infty} p_{ii}^{(n)},
\]
令 $s \uparrow 1$，在令 $N \rightarrow \infty$ 由单调收敛定理可知 $P_{ii}(s) \rightarrow \sum_{n=0}^{\infty} p_{ii}^{(n)}$，令 $f_{ii} = \lim_{s \uparrow 1} F_{ii}(s)$，及 $\sum_{n=0}^{\infty} p_{ii}^{(n)} = \lim_{s \uparrow 1} P_{ii}(s)$ 可得：若 $f_{ii} = 1$，则有 $\sum_{n=1}^{\infty} p_{ii}^{(n)} = \infty$。故 (1)(2)(3) 得证。

\end{proof}
\begin{corollary}
	若 $j$ 为非常返状态，则对任意的 $i \in S$，
\[
\sum_{n=1}^{\infty} p_{ij}^{(n)} < \infty, \quad \lim_{n \to \infty} p_{ij}^{(n)} = 0.
\]
\end{corollary}
\begin{proof}
	对给定的 $N$，
\begin{align*}
\sum_{n=1}^{N} p_{ij}^{(n)} &= \sum_{n=1}^{N} \sum_{l=1}^{n} f_{ij}^{(l)} p_{ij}^{(n-l)} \\
&= \sum_{l=1}^{N} \sum_{n=l}^{N} f_{ij}^{(l)} p_{ij}^{(n-l)} \\
&= \sum_{l=1}^{N} f_{ij}^{(l)} \sum_{m=0}^{N-l} p_{ij}^{(m)} \\
&\leq \sum_{l=1}^{N} f_{ij}^{(l)} \sum_{n=0}^{N} p_{ij}^{(n)}.
\end{align*}

令 $N \to \infty$，
\[
\sum_{n=1}^{\infty} p_{ij}^{(n)} \leq \sum_{l=1}^{\infty} f_{ij}^{(l)} \left( 1 + \sum_{n=1}^{\infty} p_{ij}^{(n)} \right) \leq 1 + \sum_{n=1}^{\infty} p_{ij}^{(n)} < \infty.
\]
由于 $p_{ij}^{(n)} \geq 0$，故 $\lim_{n \to \infty} p_{ij}^{(n)} = 0$。

\end{proof}
\begin{corollary}
	若 $j$ 为常返状态，则当 $i \rightarrow j$ 时，
	\[
	\sum_{n=1}^{\infty} p_{ij}^{(n)} = \infty.
	\]
\end{corollary}
\begin{proof}
	由于 $i \rightarrow j$，故存在 $m > 0$ 使得 $p_{ij}^{(m)} > 0$，故
\[
p_{ij}^{(m+n)} = \sum_{k \in S} p_{ik}^{(m)} p_{kj}^{(n)} \geq p_{ij}^{(m)} p_{jj}^{(n)}
\]
故 $\sum_{n=1}^{\infty} p_{ij}^{(m+n)} \geq p_{ij}^{(m)} \sum_{n=1}^{\infty} p_{jj}^{(n)} = \infty$。
\end{proof}

\[
I_n(i) := 
\begin{cases} 
1 & X_n = i \\
0 & X_n \neq i 
\end{cases}
\]

\[
S(i) := \sum_{n=0}^{\infty} I_n(i)
\]

则可证明
\begin{align*}
E(S(i) | X_0 = i) &= E\left[\sum_{n=0}^{\infty} I_n(i) | X_0 = i\right] \\
&= \sum_{n=0}^{\infty} E[I_n(i) | X_0 = i] \\
&= \sum_{n=0}^{\infty} p_{ii}^{(n)}.
\end{align*}

即由 $i$ 出发回到 $i$ 的平均次数。

\[
g_{ij} := P(\text{有无穷多个} n \geq 1 \text{使得} X_n = j | X_0 = i)
\]

\begin{theorem}
	对一切的 $i, j$
\begin{enumerate}
    \item[(i)] $g_{ii} = \lim_{n \to \infty} (f_{ii})^n$, $g_{ij} = f_{ij} g_{jj}$.
    \item[(ii)] 设 $i$ 为常返态，$i \rightarrow j$，则 $g_{ij} = f_{ij} = 1$.
\end{enumerate}
\end{theorem}
\begin{proof}
	记 $g_{ij}(m) = P(\text{至少有 } m \text{ 个 } n \geq 1 \text{ 使得 } X_n = j | X_0 = i)$。显然 $g_{ij}(1) = f_{ij}$，且
\[
\{\{ \text{有无穷多个 } n \ge 1 \text{ 使得 } X_n = j \} = \bigcap_{m=1}^{\infty} {\{ \text{至少有 } m \text{ 个 } n \ge 1 \text{ 使得 } X_n = j \}}.
\]
故 $g_{ij}(m) \downarrow g_{ij}$

\[
g_{ij}(m+1) = P(\text{至少有 } m+1 \text{ 个 } n \ge 1 \text{ 使得 } X_n = j | X_0 = i)
\]
\[
= \sum_{k=1}^{\infty} P(T_{ij} = k, \text{至少有 } m+1 \text{ 个 } n \ge 1 \text{ 使得 } X_n = j | X_0 = i)
\]
\[
= \sum_{k=1}^{\infty} P(X_k = j, X_v \neq j, 0 < v < k, \text{至少有 } m \text{ 个 } n \ge k+1 \text{ 使得 } X_n = j | X_0 = i)
\]
\[
= \sum_{k=1}^{\infty} P(X_k = j, X_v \neq j, 0 < v < k | X_0 = i) \cdot P(\text{至少有 } m \text{ 个 } n \ge k+1 \text{ 使得 } X_n = j | X_k = j, X_v \neq j, 0 < v < k, X_k = j)
\]
\[
= \sum_{k=1}^{\infty} f_{ij}^{(k)} P(\text{至少有 } m \text{ 个 } n \ge 1 \text{ 使得 } X_n = j | X_0 = i)
\]
\[
= \sum_{k=1}^{\infty} f_{ij}^{(k)} g_{ij}(m) = f_{ij} g_{ij}(m)
\]

令 $m \to \infty$，则有 $g_{ij} = f_{ij} g_{ij}$

由 $g_{ij}(m+1) = f_{ij} g_{ij}(m)$ 可知有
\[
g_{ij}(m+1) = f_{ij} g_{ij}(m) = \cdots (f_{ij})^{m+1}.
\]
故(i) $g_{ii} = \lim_{n \to \infty} g_{ii}(n) = \lim_{n \to \infty} (f_{ii})^n$，$g_{ij} = f_{ij} g_{ij}$.
\end{proof}
\begin{theorem}
	设 $i$ 为常返态，$i \rightarrow j$，则 $g_{ij} = f_{ij} g_{ii} = 1$.

\end{theorem}
\begin{proof}
	对任意的 $m \geq 1$ 以及 $l \in S$
\begin{align*}
g_{il} &= P(\text{有无穷多个} n \geq 1 \text{使得} X_n = l | X_0 = i) \\
&= P(X_m \in S, \text{有无穷多个} n \geq 1 \text{使得} X_n = l | X_0 = i) \\
&= \sum_k P(X_m = k; \text{有无穷多个} n \geq 1 \text{使得} X_n = l | X_0 = i) \\
&= \sum_k P(X_m = k; \text{有无穷多个} n \geq m+1 \text{使得} X_n = l | X_0 = i) \\
&= \sum_k P(X_m = k) P(\text{有无穷多个} n \geq m+1 \text{使得} X_n = l | X_m = k, X_0 = i) \\
&= \sum_k p_{ik}^{(m)} P(\text{有无穷多个} n \geq m+1 \text{使得} X_n = l | X_m = k, X_0 = i) \\
&= \sum_k p_{ik}^{(m)} g_{kl}
\end{align*}

由于 $i$ 常返，
\[
0 = 1 - g_{ii} = \sum_k p_{ik}^{(m)} (1 - g_{kl}).
\]
从而对一切 $m \geq 1$ 以及 $k \in S$, $p_{ik}^{(m)} (1 - g_{kl}) = 0$.
若 $i \rightarrow j$，则存在 $m \geq 1$ 使得 $p_{ij}^{(m)} > 0$，此时有 $g_{ij} = 1$，但 $f_{ij} \geq g_{ij}$.

\end{proof}
\begin{theorem}
	设 $i$ 常返，若 $i \rightarrow j$，则 $g_{ij} = f_{ij} = f_{ii} = 1$，$j \leftrightarrow i$，并且 $j$ 也是常返的。
\end{theorem}
\begin{proof}
	设 $n, m$ 使得 $p_{ij}^{(m)} p_{ji}^{(n)} > 0$。对任意的 $s \geq 1$，
\[
p_{ij}^{(m+s+n)} \geq p_{ij}^{(n)} p_{ii}^{(s)} p_{ij}^{(m)}.
\]
两边对 $s$ 求和得
\[
\sum_{s=1}^{\infty} p_{ij}^{(m+s+n)} \geq p_{ij}^{(n)} p_{ij}^{(m)} \sum_{s=1}^{\infty} p_{ii}^{(s)} = \infty.
\]
故由 (2) 可知状态 $j$ 常返。
\end{proof}
\begin{example}
	考虑直线上无限制的随机游动，状态空间为 $\mathcal{S} = \{0, \pm 1, \pm 2, \cdots\}$，转移概率为 $p_{i,i+1} = 1 - p, p_{i,i-1} = p, i \in \mathcal{S} (0 < p < 1)$。对于状态 $0$，可知 $p_{00}^{(2n+1)} = 0, n = 1, 2, \cdots$，即从 $0$ 出发奇数次不可能返回到 $0$。而
\[
p_{00}^{(2n)} = \binom{2n}{n} p^n (1-p)^n = \frac{(2n)!}{n! n!} [p(1-p)]^n
\]
即经过偶数次回到 $0$ 当且仅当它向左、右移动距离相同。

由 Stirling 公式知，当 $n$ 充分大时，$n! \sim n^{n+\frac{1}{2}} e^{-n} \sqrt{2\pi}$，则 $p_{00}^{(2n)} \sim \frac{[4p(1-p)]^n}{\sqrt{\pi n}}$。而 $p(1-p) \leq \frac{1}{4}$ 且 $p(1-p) = \frac{1}{4} \iff p = \frac{1}{2}$。于是 $p = \frac{1}{2}$ 时，$\sum_{n=0}^{\infty} p_{ii}^{(n)} = \infty$，否则 $\sum_{n=0}^{\infty} p_{ii}^{(n)} < \infty$，即当 $p \neq \frac{1}{2}$ 时状态 $0$ 是非常返状态，$p = \frac{1}{2}$ 时是常返状态。显然，过程的各个状态都是相通的，故以此可得其他状态的常返性。（请读者自己考虑它们的周期是什么？）
\end{example}
\begin{definition}[正常返状态]
设 $i$ 常返，若
\[
\mu_i := \sum_{n=1}^{\infty} n f_{ii}^{(n)} = \sum_{n=1}^{\infty} n P(T_{ii} = n | X_0 = i) < \infty,
\]
则称 $i$ 为正常返的；否则称之为零常返的
\end{definition}

\textit{明显：} $E[T_{ii} | X_0 = i] = \mu_i$ 为从 $i$ 出发回到 $i$ 的平均时间。
\begin{definition}[遍历性]
	若状态 $i$ 是正常返且非周期的，则称它是遍历的。
\end{definition}
\begin{example}
	记 $\mathcal{S} = \{1, 2, 3, 4\}$.

\[
\mathbf{P} = \left(
\begin{array}{cccc}
\frac{1}{2} & \frac{1}{2} & 0 & 0  \\
1 & 0 & 0 & 0 \\
0 & \frac{1}{3} & \frac{2}{3} & 0 \\
\frac{1}{2} & 0 & \frac{1}{2} & 0
\end{array}
\right)
\]

判断状态 1, 2, 3, 4 是常返性还是非常性。若是常返，进一步判断是正常返还是零常返？
\end{example}
\begin{proof}
	$f_{444}^{(n)} = 0, f_{444} = 0 \ \ \ \forall n \geq 1$；

	 $f_{33}^{(1)} = \frac{2}{3}, f_{33}^{(n)} = 0, f_{33} = f_{33}^{(1)} = \frac{2}{3} \forall n \geq 2$；

	因此：
	3 和 4 非常返。


	$f_{11}^{(1)} = \frac{1}{2}, f_{11}^{(2)} = p_{12} p_{21} = \frac{1}{2}, f_{11}^{(n)} = 0, \forall n \geq 3;$
	$f_{11} = \sum_{n=1}^{\infty} f_{11}^{(n)} = 1.$
	
	 $f_{222}^{(1)} = 0, f_{222}^{(2)} = p_{21} p_{12} = \frac{1}{2}, f_{22}^{(3)} = p_{21} p_{11} p_{12} = \frac{1}{2} \cdot \frac{1}{2}, \cdots, f_{22}^{(n+1)} = \frac{1}{2^n}, \forall n \geq 1; f_{22} = \sum_{n=1}^{\infty} f_{22}^{(n)} = 1.$
	
	因此：$\mu_1 = 1 \cdot \frac{1}{2} + 2 \cdot \frac{1}{2} = \frac{3}{2}; \mu_2 = \sum_{n=1}^{\infty} n f_{22}^{(n)} = \sum_{n=2}^{\infty} n \cdot \frac{1}{2^{n-1}} = 3.$
	
	于是：1 和 2 均正常返，3 和 4 非常返。
\end{proof}
\begin{theorem}
	设 $P$ 不可约，周期 $d > 1$，则有
\begin{enumerate}
    \item[(a)] 对任给定的 $i, j \in S$，若 $p_{ij}^{(m)} > 0, p_{ij}^{(n)} > 0$，则有 $d|(n-m)$。同时存在唯一的 $r$，使得只要 $p_{ij}^{(n)} > 0$ 就有 $n = kd + r$。
    \item[(b)] 状态空间 $S$ 可分成 $d$ 个不相交的集合的并：
    \[
    S = G_1 \cup G_2 \cup \cdots \cup G_d,
    \]
    其中，从任一 $G_m$ 中的状态出发，下一步到达 $G_{m+1(\mod d)}$ 中某状态的概率大于 $0$；
    \item[(c)] 链 $P^d$ 是非周期的，且 $\sum_{k \in G_m} p_{ik}^{(d)} = 1 \ \ \ \forall i \in G_m$。且将 $P^d$ 限制在 $G_m$ 上时，构成一个不可约非周期的子链。
\end{enumerate}

\end{theorem}
\begin{proof}
	(a) 由 $j \rightarrow i$，存在 $k \geq 1$ 使得 $p_{ij}^{(k)} > 0$，于是有
	\[
	p_{ii}^{(n+k)} \geq p_{ij}^{(n)} p_{ji}^{(k)} > 0, \quad p_{ii}^{(m+k)} \geq p_{ij}^{(m)} p_{ji}^{(k)} > 0
	\]
	故 $d\mid(n+k)$ 且 $d\mid(m+k)$，于是有 $d\mid(n-m)$。因此存在唯一的 $r$，使得 $n = k_1 d + r$，$m = k_2 d + r$。
	
	(b) 先固定 $i \in S$，令
	\begin{align*}
	G_1 &\triangleq \{k : \exists n,\ p_{ik}^{(nd+1)} > 0\}, \\
	G_2 &\triangleq \{k_2 : \exists k_1 \in G_1 \text{ 使得 } p_{k_1 k_2} > 0\}, \\
	&\quad \vdots \\
	G_m &\triangleq \{k_m : \exists k_{m-1} \in G_{m-1} \text{ 使得 } p_{k_{m-1} k_m} > 0\} \quad (m = 2, \ldots, d).
	\end{align*}
	对任意的 $k_1 \in G_1$，由 $\sum_{j \in S} p_{k_1,j} = 1$ 知存在 $k_2 \in S$ 使得 $p_{k_1 k_2} > 0$，故 $G_2 \neq \emptyset$。依次类推，$G_m \neq \emptyset$ ($m = 2, \ldots, d$)。
	
	由 (a) 知 $G_1, \ldots, G_d$ 互不相交。若存在 $j \in G_{d_1} \cap G_{d_2}$，则有
	\[
	p_{ij}^{(nd+d_1)} > 0, \quad p_{ij}^{(md+d_2)} > 0
	\]
	因此 $d\mid(d_2 - d_1)$，故 $G_{d_1} = G_{d_2}$。
	
	由 $P$ 不可约知 $G_1 \cup \cdots \cup G_d = S$（即 $i \rightarrow i_1 \rightarrow \cdots \rightarrow i_n \rightarrow j$）。事实上，任取 $j \in S$，存在 $m$ 使得 $p_{ij}^{(m)} > 0$。设 $m = kd + r$，则 $j \in G_r$。
	
	(c) 由定理 \ref{3.7}知 $P^d$ 是非周期的。令 $\widetilde{P} := P^d$ 为一步转移矩阵。对任意 $j \in S$，存在 $N$ 使得当 $n \geq N$ 时 $p_{ij}^{(nd)} > 0$。取
	\[
	\widetilde{p}_{ij}^{(N)} := p_{ij}^{(Nd)} > 0, \quad \widetilde{p}_{ij}^{(N+1)} := p_{ij}^{((N+1)d)} > 0
	\]
	其中 $\widetilde{p}_{ik} := p_{ik}^{(d)}$。由于 $(N, N+1) = 1$，故 $\widetilde{P}$ 非周期。
	
	由 (b) 知 $\sum_{k \in G_m} p_{jk}^{(d)} = 1$（$\forall j \in G_m$, $G_m \in \{G_1, \ldots, G_d\}$）。因此
	\[
	P^d|_{G_m} := \left(p_{ij}^{(d)}\right)_{i,j \in G_m}
	\]
	为随机矩阵。对任意 $j, k \in G_m$，由不可约性存在 $l \in \mathbb{N}$ 使得 $p_{jk}^{(l d)} > 0$，即在 $P^d|_{G_m}$ 中 $l$ 步可达，故 $P^d|_{G_m}$ 不可约。
	\end{proof}
	\begin{remark}
		(c)将周期矩阵 $P^d$ 限制在 $G_m$ 上时，构成一个不可约非周期的子链。
	\end{remark}

	\begin{example}
		记 $\mathcal{S} = \{1, 2, 3, 4, 5, 6\}$.

\[
\mathbf{P} = \begin{pmatrix}
0 & 0 & \frac{1}{2} & 0 & \frac{1}{2} & 0 \\
\frac{1}{3} & 0 & 0 & \frac{1}{3} & 0 & \frac{1}{3} \\
0 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & 1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & \frac{3}{4} & 0 & \frac{1}{4} & 0
\end{pmatrix}
\]
	\end{example}
	\begin{proof}
		取初始状态1, 则有
\[
G_1 := \{3, 5\}.
\]
\[
G_2 := \{2\}.
\]
\[
G_3 := \{1, 4, 6\}.
\]


	\end{proof}


\begin{example}
	\[
\mathbf{P}^{(3)} = \begin{pmatrix}
\frac{1}{3} & 0 & 0 & \frac{1}{3} & 0 & \frac{1}{3} \\
0 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & \frac{7}{12} & 0 & \frac{5}{12} & 0 \\
\frac{1}{3} & 0 & 0 & \frac{1}{3} & 0 & \frac{1}{3} \\
0 & 0 & \frac{7}{12} & 0 & \frac{5}{12} & 0 \\
\frac{1}{3} & 0 & 0 & \frac{1}{3} & 0 & \frac{1}{3}
\end{pmatrix}
\]
\end{example}

\begin{proof}
	\[
P^{(3)}|_{G_1} = \begin{pmatrix}
\frac{7}{12} & \frac{5}{12} \\
\frac{7}{12} & \frac{5}{12}
\end{pmatrix}
\]
\[
P^{(3)}|_{G_2} = \begin{pmatrix}
1
\end{pmatrix}
\]
\[
P^{(3)}|_{G_3} = \begin{pmatrix}
\frac{1}{3} & \frac{1}{3} & \frac{1}{3} \\
\frac{1}{3} & \frac{1}{3} & \frac{1}{3} \\
\frac{1}{3} & \frac{1}{3} & \frac{1}{3}
\end{pmatrix}
\]
\end{proof}


\section{不变分布}
若知极限 $\lim_{n \to \infty} p_{ij}^{(n)} = \pi_j$ 存在且不依赖于 $i$，则由
\[
P^{n+1} = P^n P \quad (p_{ij}^{(n+1)} = \sum_{l \in S} p_{il}^{(n)} p_{lj})
\]
及 Fatou 引理知：
\[
\pi_j \geq \sum_i \pi_i p_{ij} \quad \forall j \in S \text{且} \sum_j \pi_j \leq 1.
\]

从而设存在一状态 $k \in S$ 使得 $\pi_k > \sum_i \pi_i p_{ik}$。
\[
\sum_j \pi_j > \sum_j \sum_i \pi_i p_{ij} = \sum_i \pi_i \sum_j p_{ij} = \sum_i \pi_i,
\]
矛盾。

故
\[
\pi_j = \sum_i \pi_i p_{ij} \quad \forall j \in S.
\]

记 $\pi := (\pi_i, i \in S)$，则有 $\pi = \pi P$.

\begin{definition}
	称 $v = \{v_i, i \in \mathcal{S}\}$ 为 $P$ 的不变测度，如果 $0 \leq v_i < \infty (i \in \mathcal{S})$ 且 $v = vP, v \neq 0$.
\[
v_j = \sum_i v_i p_{ij} \quad \forall j \in \mathcal{S}.
\]
\end{definition}
\begin{definition}[不变分布]
	若 $\{\pi_i, i \in \mathcal{S}\}$ 为 $\mathcal{S}$ 上的概率分布，且它满足对任意的 $j \in \mathcal{S}$ 有 $\pi_j = \sum_i \pi_i p_{ij}$，则称 $\{\pi_i, i \in \mathcal{S}\}$ 为 $P$ (或该马氏链) 的不变分布或平稳分布.
\end{definition}

回顾 $p_{ij}^{(n)} = P(X_n = j | X_0 = i)$ 与 $P(X_n = j)$
\[
\pi_i(n) = P(X_n = i), i \in \mathcal{S},
\]
\[
\pi(n) = (\pi_i(n), i \in \mathcal{S}).
\]
即 $\pi(n)$ 表示 $n$ 时刻 $X_n$ 的概率分布，称 $\pi(0) := (\pi_i(0), i \in \mathcal{S})$ 为马氏链 $\{X_n, n = 0, 1, \ldots\}$ 的初始分布.
\[
\pi(n+1) = \pi(n)P,
\]
\[
\pi(n) = \pi(0)P^n,
\]

设 $\pi := (\pi_i, i \in \mathcal{S})$ 为不变分布，即 $\pi = \pi P$。

若令马氏链的初始分布 $\pi(0) := \pi$。会怎样？则有递归关系：
\[
\pi = \pi P = \pi P \cdot P = \pi \cdot P^2 = \ldots = \pi P^n.
\]
即 $\pi(0) = \pi(0) P^n = \pi(n)$。即马氏链任意时刻的分布都为初始分布。

现在考虑
\begin{equation*}
	e_{ji}^{(n)} = P(X_n = i, X_m \neq j, 0 < m < n | X_0 = j) \tag{5.2}
\end{equation*}
	
	\[
	e_{ji} := \sum_{n=1}^{\infty} e_{ji}^{(n)}.
	\]
\begin{theorem}
	若 $j$ 常返，则有：$V := (v_i := e_{ji}, i \in \mathcal{S})$ 为不变测度，且
\[
e_{jj} = \sum_{n=1}^{\infty} f_{jj}^{(n)} = 1.
\]
\end{theorem}
\begin{remark}
	\[
e_{jj}^{(n)} = f_{jj}^{(n)}.
\]
\end{remark}
\begin{proof}
	由定义知
	\[
	e_{ji}^{(n)} = P(X_n = i, X_m \neq j, 0 < m < n | X_0 = j) \quad e_{ji}^{(1)} = p_{ji}. \tag{5.3}
	\]
		
		\begin{align*}
		e_{ji}^{(n+1)} &= P(X_{n+1} = i, X_v \neq j, 0 < v < n + 1 | X_0 = j) \\
		&= \sum_{k \neq j} P(X_{n+1} = i, X_n = k, X_v \neq j, 0 < v < n | X_0 = j) \\
		&= \sum_{k \neq j} P(X_n = k, X_v \neq j, 0 < v < n | X_0 = j) p_{ki} \\
		&= \sum_{k \neq j} e_{jk}^{(n)} p_{ki}.
		\end{align*}
		
		\begin{align*}
		e_{ji} &= \sum_{n=1}^{\infty} e_{ji}^{(n)} \\
		&= \sum_{n=2}^{\infty} \sum_{k \neq j} e_{jk}^{(n-1)} p_{ki} + p_{ji} \\
		&= \sum_{k \neq j} \sum_{n=1}^{\infty} e_{jk}^{(n)} p_{ki} + p_{ji} \\
		&= \sum_{k \neq j} e_{jk} p_{ki} + p_{ji}
		\end{align*}
		
		由于 $e_{jj}^{(n)} = f_{jj}^{(n)}$，故 $e_{jj} = \sum_{n=1}^{\infty} f_{jj}^{(n)} = f_{jj} = 1 > 0$。
		
		令 $v := (v_i := e_{ji}, i \in \mathcal{S})$。下证 $v$ 为不变测度。由上式可知 $e_{ji} := \sum_k e_{jk} p_{ki}$ 即 $v_i := \sum_k v_k p_{ki}$。同时迭代可知
		\[
		e_{ji} = \sum_{k \in \mathcal{S}} e_{jk} p_{ki} = \sum_{k \in \mathcal{S}} \left( \sum_{s \in \mathcal{S}} e_{js} p_{sk} \right) p_{ki} = \sum_{s \in \mathcal{S}} e_{js} \sum_{k \in \mathcal{S}} p_{sk} p_{ki} = \sum_{s \in \mathcal{S}} e_{js} p_{si}^{(2)}.
		\]
		且由 $e_{ii} = 1 > 0$ 可知 $\{e_{ii}, i \in \mathcal{S}\}$ 非负且不全为 0。
		
		\begin{align*}
		e_{ji} &= \sum_{k \in \mathcal{S}} e_{jk} p_{ki} = \sum_{k \in \mathcal{S}} \left( \sum_{s \in \mathcal{S}} e_{js} p_{sk} \right) p_{ki} = \sum_{s \in \mathcal{S}} e_{js} \sum_{k \in \mathcal{S}} p_{sk} p_{ki} = \sum_{s \in \mathcal{S}} e_{js} p_{si}^{(2)} \\
		&= \sum_{s \in \mathcal{S}} e_{js} p_{si}^{(n)}
		\end{align*}
		
		且由 $e_{ii} > 0$ 可知 $\{e_{ii}, i \in \mathcal{S}\}$ 非负且不全为 0。下证 $v_i = e_{ji} < \infty$。
		
		若 $j$ 不可达状态 $i$，则有 $v_i := e_{ji} = 0$。
		
		若 $j \rightarrow i$，则由常返可知，$i \leftrightarrow j$。故存在 $n \geq 1$ 使得 $p_{ij}^{(n)} > 0$。
		
		故 $1 = v_i = e_{ji} = \sum_{k \in \mathcal{S}} e_{jk} p_{ki}^{(n)} \geq e_{ji} p_{ij}^{(n)}$。
		
		因此，$e_{ji} \leq \frac{1}{p_{ij}^{(n)}} < \infty$。
		
\end{proof}
\begin{lemma}
	设马氏链有不变测度 $V = (v_i, i \in \mathcal{S})$。若 $v_i > 0$，$i \rightarrow j$，则 $v_j > 0$。特别地，若链不可约，则 $v_j > 0$, $j \in \mathcal{S}$。

\end{lemma}
\begin{proof}
	由于 $v_i > 0$，$i \rightarrow j$，则存在 $n \geq 1$ 使得 $p_{ij}^{(n)} > 0$。

由 $v_j = \sum_k v_k p_{kj}^{(n)} \geq v_i p_{ij}^{(n)} > 0$.

由于不变测度不恒为 0，至少存在 $v_i > 0$。由于该链不可约，则对任意的 $j \in \mathcal{S}$ 有 $i \rightarrow j$。故 $v_j > 0$。

\end{proof}
\begin{lemma}
	设链常返不可约，则不计一个常数因子，不变测度唯一。
\end{lemma}
\begin{proof}

	证明可见何声武《随机过程引论》定理5.3.

	即证明任取 $\mu := (\mu_i, i \in \mathcal{S})$ 为另一不变测度。则有对任意的 $i \in \mathcal{S}$ 有 $\mu_i = \mu_j e_{ji}$.

即 $(\mu_i, i \in \mathcal{S})$ 与 $(e_{ji}, i \in \mathcal{S})$ 只差一个常数。
\end{proof}
\begin{lemma}
	设 $V = (v_i, i \in \mathcal{S})$ 为马氏链 $\{X_n\}$ 的平稳分布，$v_j > 0$ 则 $j$ 为常返态。
\end{lemma}
\begin{proof}
	反证法：设 $j$ 为非常返态。由推论4.6可知对任意的 $i \in \mathcal{S}$ 有 $\lim_{n \to \infty} p_{ij}^{(n)} = 0$。

由于 $v_j = \sum_{i \in \mathcal{S}} v_i p_{ij}^{(n)}$，令 $n \to \infty$，由控制收敛定理可知 $v_j = 0$。矛盾。
\end{proof}
\begin{lemma}
	\[
\sum_{i \in \mathcal{S}} e_{ji} = 
\begin{cases} 
\mu_j := E[T_{ij} | X_0 = j] & \text{若 } j \text{为常返态} \\
\infty & \text{若 } j \text{为非常返态}
\end{cases}
\]

\end{lemma}
\begin{proof}
	对任意的 $n \geq 1$ 以及 $i, j \in \mathcal{S}$。

\begin{align*}
\sum_{i \in \mathcal{S}} e_{ji}^{(n)} &= \sum_{i \in \mathcal{S}} P(X_n = i, X_v \neq j, 0 < v < n | X_0 = j) \\
&= P(X_v \neq j, 0 < v < n | X_0 = j) \\
&= P(T_{ij} \geq n | X_0 = j) \\
&= P(T_{ij} = \infty | X_0 = j) + \sum_{v=n}^{\infty} P(T_{ij} = v | X_0 = j) \\
&= (1 - f_{jj}) + \sum_{v=n}^{\infty} f_{jj}^{(v)}.
\end{align*}
\end{proof}
\begin{lemma}
	\[
\sum_{i \in \mathcal{S}} e_{ji} = 
\begin{cases} 
\mu_j := E[T_{ij} | X_0 = j] & \text{若 } j \text{为常返态} \\
\infty & \text{若 } j \text{为非常返态}
\end{cases}
\]
\end{lemma}
\begin{proof}
	\begin{align*}
		\sum_{i \in \mathcal{S}} e_{ji} &= \sum_{i \in \mathcal{S}} \sum_{n=1}^{\infty} e_{ji}^{(n)} = \sum_{n=1}^{\infty} \left[ (1 - f_{jj}) + \sum_{v=n}^{\infty} f_{jj}^{(v)} \right].
		\end{align*}
		
		故若 $j$ 为非常返态，$f_{jj} < 1$，则 $\sum_{i \in \mathcal{S}} e_{ji} = \infty$。
		
		若 $j$ 为常返态，$f_{jj} = 1$，
		
		则 $\sum_{i \in \mathcal{S}} e_{ji} = \sum_{n=1}^{\infty} \sum_{v=n}^{\infty} f_{jj}^{(v)} = \sum_{v=1}^{\infty} v f_{jj}^{(v)} = \mu_j$.
		
		从上述结论可知若 $j$ 是正常返的，则若令 $\nu_i := \frac{e_{ji}}{\mu_j}$。则有
		\[
		\sum_{i \in \mathcal{S}} \nu_i = \sum_{i \in \mathcal{S}} \frac{e_{ji}}{\mu_j} = 1,
		\]
		且由 $e_{ji} = \sum_{k \in \mathcal{S}} e_{jk} p_{ki}$，可知 $\nu_i = \sum_{k \in \mathcal{S}} \nu_k p_{ki}$。即 $\nu := (\nu_i, i \in \mathcal{S})$ 为平稳分布。
\end{proof}

设 $P = (P_1, P_2, \ldots, P_m)$ 是马氏链的一步转移概率矩阵，$P_j$ 是 $P$ 的第 $j$ 列，设 $\pi := (\pi_1, \pi_2, \ldots, \pi_m)$ 为平稳分布。则方程组
\[
\pi = \pi P, \quad \sum_{j=1}^{m} \pi_j = 1 \tag{5.1}
\]
和
\[
(\pi_1, \pi_2, \ldots, \pi_{m-1}) = \pi(P_1, P_2, \ldots, P_{m-1}), \quad \sum_{j=1}^{m} \pi_j = 1 \tag{5.2}
\]
等价。实际上，
\[
\pi = \pi P \text{ 即为 } (\pi_1, \pi_2, \ldots, \pi_{m-1}, \pi_m) = \pi(P_1, P_2, \ldots, P_{m-1}, P_m).
\]


\begin{example}
	记 $\mathcal{S} = \{1, 2, 3\}$.

\[
\mathbf{P} = \begin{pmatrix}
0 & \frac{1}{2} & \frac{1}{2} \\
0 & \frac{1}{4} & \frac{3}{4} \\
1 & 0 & 0
\end{pmatrix}
\]

求平稳分布。
\end{example}
\begin{proof}
	\begin{align*}
		&\begin{cases}
		(\pi_1, \pi_2, \pi_3) \mathbf{P} = (\pi_1, \pi_2, \pi_3) \\
		\pi_1 + \pi_2 + \pi_3 = 1 \\
		\pi_i \geq 0. \quad (i = 1, 2, 3)
		\end{cases} \\
		&\begin{cases}
		\pi_3 = \pi_1, \\
		\frac{1}{4} \pi_2 + \frac{1}{2} \pi_1 = \pi_2 \\
		\pi_1 + \pi_2 + \pi_3 = 1 \\
		\pi_i \geq 0.
		\end{cases}
		\end{align*}
		
		解得 $\pi_1 = \frac{3}{8}$, $\pi_2 = \frac{1}{4}$, $\pi_3 = \frac{3}{8}$.
\end{proof}
\begin{example}
	记 $\mathcal{S} = \{0, 1, 2, 3, 4\}$.

\[
\mathbf{P} = \begin{pmatrix}
\frac{1}{2} & \frac{1}{2} & 0 & 0 & 0 \\
\frac{1}{2} & \frac{1}{2} & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 0 & 0 & 1 \\
0 & 0 & \frac{1}{2} & 0 & \frac{1}{2}
\end{pmatrix}
\]

求平稳分布。
\end{example}
\begin{proof}
	\[
\mathbf{P} = \begin{pmatrix}
\frac{1}{2} & \frac{1}{2} & 0 & 0 & 0 \\
\frac{1}{2} & \frac{1}{2} & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 0 & 0 & 1 \\
0 & 0 & \frac{1}{2} & 0 & \frac{1}{2}
\end{pmatrix}
\]
\[
\begin{cases}
\pi_0 = \frac{1}{2} \pi_0 + \frac{1}{2} \pi_1 \\
\pi_2 = \frac{1}{2} \pi_4 \\
\pi_3 = \pi_2 \\
\pi_4 = \pi_3 + \frac{1}{2} \pi_4 \\
\pi_0 + \pi_1 + \pi_2 + \pi_3 + \pi_4 = 1 \\
\pi_i \geq 0, \, i = 0, 1, 2, 3, 4
\end{cases}
\]

解得 $\pi = (\pi_0, \pi_0, \frac{1}{4} - \frac{1}{2} \pi_0, \frac{1}{4} - \frac{1}{2} \pi_0, \frac{1}{2} - \pi_0)$

\begin{align*}
	&\begin{cases}
	0 \leq \pi_0 \leq 1 \\
	0 \leq \frac{1}{4} - \frac{1}{2} \pi_0 \leq 1,
	\end{cases} \\
	\text{其中} \quad & 0 \leq \pi_0 \leq \frac{1}{2}.
	\end{align*}
\end{proof}
\section{状态空间的分解}
\subsection{质点在常返等价类中的转移}
\begin{theorem}
	设 $i$ 为常返状态，则
\[
\lim_{n \to \infty} p_{ii}^{(nd(i))} = \frac{d(i)}{\mu_i}
\]
\end{theorem}
\begin{theorem}
	设 $i$ 是常返状态，则
	\begin{enumerate}
		\item $i$ 是零常返的充分必要条件是 $\lim_{n \to \infty} p_{ii}^{(n)} = 0$;
		\item 当 $i$ 是零常返，$i \rightarrow j$ 时，$j$ 也是零常返的；
		\item 若 $i$ 是正常返，$i \rightarrow j$ 时，$j$ 也是正常返的。
	\end{enumerate}
\end{theorem}
\begin{proof}
	(1) 设 $i$ 为零常返态，则 $\lim_{n \to \infty} p_{ii}^{(nd(i))} = 0$。由周期的定义可知，当 $n$ 不能被 $d(i)$ 整除时，$p_{ii}^{(n)} = 0$。故有 $\lim_{n \to \infty} p_{ii}^{(n)} = 0$。

反之，若 $\lim_{n \to \infty} p_{ii}^{(n)} = 0$。下用反证法证明。假设 $i$ 是正常返态，由此可知 $\lim_{n \to \infty} p_{ii}^{(nd(i))} > 0$，故 $i$ 是零常返态。

(2) 设 $i \leftrightarrow j$，取 $m_0, n_0$ 使得 $p_{ij}^{(n_0)} > 0, p_{ji}^{(m_0)} > 0$。则有：
\[
p_{ii}^{(n + m_0 + n_0)} \geq p_{ij}^{(n_0)} p_{ji}^{(n)} p_{ii}^{(m_0)}, \quad n \geq 1.
\]
由 $p_{ii}^{(n)} \to 0$，可知 $p_{ii}^{(n)} \leq \frac{1}{p_{ij}^{(n_0)} p_{ji}^{(m_0)}} p_{ii}^{(n + m_0 + n_0)} \to 0$

由此及(1)：若 $i$ 零常返，则有 $j$ 亦零常返。由(2)和定理\ref{4.5}知(3)成立。

\end{proof}

\begin{theorem}[Lebesgue 控制收敛定理]
	若 $\{f_n, n \geq 1\}$ 为可测函数序列，$|f_n| \leq Y$，$Y$ 可积，且对任意的 $x$ $\lim_n f_n(x) = f(x)$ 存在，则
\[
\lim_n \mu(f_n) = \mu(f).
\]
\end{theorem}
\begin{example}
	如果 $j$ 不是正常返，则对任意状态 $i$，$p_{ij}^{(n)} \to 0, \, n \to \infty$。

\end{example}
\begin{proof}
	若 $j$ 非常返，由定理\ref{4.5}(2) 可知 $p_{ij}^{(n)} \to 0$。对零常返 $j$，由定理\ref{4.5}(2) 可知 $p_{ij}^{(n)} \to 0$。对任意的 $i$，
\begin{align*}
p_{ij}^{(n)} &= \sum_{k=1}^{n} f_{ij}^{(k)} p_{ij}^{(n-k)} \\
&= \sum_{k=1}^{\infty} f_{ij}^{(k)} p_{ij}^{(n-k)} I_{\{k \leq n\}}.
\end{align*}
由 $\sum_{k=1}^{\infty} f_{ij}^{(k)} \leq 1$。由控制收敛定理可知，令 $n \to \infty$ 可知结论成立。（令 $g_n(k) := p_{ij}^{(n-k)} I_{\{k \leq n\}}$。则对任意的 $k \in \mathcal{S}$ 有，$\lim_{n \to \infty} g_n(k) = 0$。且 $|g_n(k)| \leq 1$）
\end{proof}


\begin{definition}[闭集]
	设 $\mathcal{S}$ 是马氏链 $\{X_n\}$ 的状态空间，$i \in \mathcal{S}$。和 $j$ 互通的状态记为
\begin{enumerate}
    \item[(a)]
    \[
    C(i) := \{i\} \cup \{j \in \mathcal{S}, j \leftrightarrow i\}.
    \]
    若 $i$ 不与别的状态互通，则 $C(i) = \{i\}$。称 $C(i)$ 是一个等价类；
    \item[(b)]  集合 $C \subseteq \mathcal{S}$ 称为闭的，如果
    \[
    p_{ij} = 0 \quad \forall i \in C, j \notin C.
    \]
    即 $\sum_{k \in C} p_{ik} = 1 \quad \forall i \in C$。闭集 $C$ 称为不可约的，若 $C$ 中的任意两个状态均是互通的。闭集 $A$ 称为极小的，若 $A$ 的任意真子集不是闭集。
\end{enumerate}
\end{definition}
\begin{theorem}
	集合 $C \subseteq \mathcal{S}$ 为闭的充要条件是对任意的 $i \in C$ 及 $j \notin C$，$n \geq 1$，都有 $p_{ij}^{(n)} = 0$。
\end{theorem}
\begin{proof}
	下证必要性。若 $C$ 为闭集，当 $n = 1$ 时成立。

设当 $n = l$ 时成立。即对任意 $i \in C, j \notin C$，有 $p_{ij}^{(l)} = 0$。

则对任意 $i \in C, j \notin C$
\begin{align*}
p_{ij}^{(l+1)} &= \sum_{k \in C} p_{ik}^{(l)} p_{kj} + \sum_{k \notin C} p_{ik}^{(l)} p_{kj} \\
&= \sum_{k \in C} p_{ik}^{(l)} \cdot 0 + \sum_{k \notin C} 0 \cdot p_{kj} = 0.
\end{align*}
\end{proof}
\begin{theorem}
	集合 $C \subseteq \mathcal{S}$ 为闭的充要条件是对任意的 $i \in C$ 及 $j \notin C, n \geq 1$，都有 $p_{ij}^{(n)} = 0$.
\end{theorem}
\begin{remark}
	集合 $C \subseteq \mathcal{S}$ 为闭充要条件是对任意的 $i \in C$ 有，$\sum_{j \in C} p_{ij}^{(n)} = 1$。整个马氏链也是一个闭集。
\end{remark}
\begin{lemma}
	设 $C$ 为闭集，只考虑 $C$ 上的 $m$ 步转移子矩阵 $P_C^{(m)} := (p_{ij}^{(m)}), i, j \in C$。则它为随机矩阵。
\end{lemma}
\begin{example}
	\[
\mathbf{P} = \begin{pmatrix}
\frac{1}{2} & 0 & \frac{1}{2} & 0 & 0 & 0 \\
0 & \frac{1}{4} & 0 & \frac{3}{4} & 0 & 0 \\
0 & 0 & \frac{1}{3} & 0 & \frac{2}{3} & 0 \\
\frac{1}{4} & \frac{1}{4} & 0 & \frac{1}{4} & 0 & 0 \\
\frac{1}{3} & 0 & \frac{1}{3} & 0 & \frac{1}{3} & 0
\end{pmatrix}
\]

求极小闭集。
\end{example}
\begin{proof}
	\(\{1, 3, 5\} \text{是极小闭集。}\)
\end{proof}

\begin{theorem}
	设 \( C \) 是一个等价类，则
\begin{enumerate}
    \item 不同等价类互不相交。
    \item \( C \) 中的状态有相同的类型：或都是正常返的，或都是零常返的，或都是非常返的。在任何情况下，\( C \) 中的状态有相同的周期。
    \item 所有常返状态构成一个闭集。同时常返等价类是闭集：质点不能走出常返等价类。
    \item 零常返等价类含有无穷个状态。
    \item 非常返等价类如果是闭集，则含有无穷个状态。
    \item 设 \( T \) 非常返状态全体。若 \( T \) 为闭集，则必含有无穷个状态。
\end{enumerate}
\end{theorem}

\begin{proof}
	设 \( C \) 和 \( C_1 \) 都是等价类，如果有 \( i \in C \cap C_1 \)，由互通的传递性可知 \( i \) 和 \( C \cup C_1 \) 中的所有状态互通，于是 \( C \) 和 \( C_1 \) 中的任意状态互通。故 \( C = C_1 \)。

(2) 显然。

(3) 假设 \( C \) 为常返等价类或者所有常返态构成的集合。如果存在 \( i \in C, j \notin C \) 且 \( i \rightarrow j \) 则可知 \( j \longleftrightarrow i \) 与 \( j \notin C \) 矛盾。

(4,5) 同时证明：假设 \( C \) 为非常返的或零常返等价类。反证法，由 \( C \) 为闭集可知 \( \sum_{j \in C} p_{ij}^{(n)} = 1 \)。则对 \( \forall i, j \in C \) 有 \( \lim_{n \to \infty} p_{ij}^{(n)} = 0 \)。不妨假设 \( C \) 中有有限个点 \( (N 个) \)。故令 \( n \to \infty \)，
\[
1 = \lim_{n \to \infty} \sum_{j=1}^N p_{ij}^{(n)} = \sum_{j=1}^N \lim_{n \to \infty} p_{ij}^{(n)} = 0,
\]
矛盾。
\end{proof}
\begin{theorem}
	设 \( C \neq \emptyset \)，则它可以分成若干个互不相交的闭集 \(\{C_n\}\)，使得 \( C = C_1 \cup C_2 \cup \cdots \)，且有
\begin{enumerate}
    \item \( C_n \) 中任意两个状态互通；
    \item \( C_h \cap C_l = \emptyset \) (\( h \neq l \))。
\end{enumerate}
\end{theorem}
\begin{proof}
	因 \( C \neq \emptyset \)，任取 \( i_1 \in C \)，令 \( C_1 = \{i : i \longleftrightarrow i_1 \in C\} \)。

若 \( C - C_1 \neq \emptyset \)，再任取 \( i_2 \in C - C_1 \)，令 \( C_2 = \{i : i \longleftrightarrow i_2 \in C - C_1\} \)，\ldots

若 \( C - \bigcup_{l=1}^n C_l \neq \emptyset \)，取 \( i_{n+1} \in C - \bigcup_{l=1}^n C_l \)，令 \( C_{n+1} = \{i : i \longleftrightarrow i_{n+1} \in C - \bigcup_{l=1}^n C_l\} \)，\ldots
\end{proof}
利用等价关系可将 \( S \) 分解：
\[
S = \bigcup_{j=1}^{m} C_j \cup T, \quad m \leq \infty,
\]
其中 \( C_j \) 为常返状态构成的不可约闭集，\( T \) 为非常返状态集。

\begin{remark}
	对任意的 \( k \in T \)，
\begin{enumerate}
    \item \( k \) 可能转移到 \( C_l \) 中，然后永远在 \( C_l \) 中。
    \item \( T \) 若为有限集，\( T \) 一定非闭集，并且 \( T \) 中的任意质点一定走出 \( T \) 进入某闭集 \( C_l \)。
\end{enumerate}
\end{remark}
\begin{example}
	记 \( S = \{1,2,3,4,5\} \)。

\[
\mathbf{P} = \left(
\begin{array}{ccccc}
\frac{1}{2} & \frac{1}{2} & 0 & 0 & 0 \\
\frac{1}{4} & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 \\
0 & 0 & \frac{1}{2} & 0 & \frac{1}{2} \\
0 & 0 & 0 & 1 & 0 \\
\end{array}
\right)
\]
\end{example}
\begin{proof}
	\{1,2\} 和 \{3,4,5\} 均为等价类。

故 \{1,2\} 和 \{3,4,5\} 均为正常返等价类。如果不是则由这两个闭，可推出有无穷多个状态
\end{proof}
\begin{example}
	记 \( S = \{1,2,3,4,5\} \)。

\[
\mathbf{P} = \left(
\begin{array}{ccccc}
0.6 & 0.1 & 0 & 0.3 & 0 \\
0.2 & 0.5 & 0.1 & 0.2 & 0 \\
0.2 & 0.2 & 0.4 & 0.1 & 0.1 \\
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 0 & 0 & 1 \\
\end{array}
\right)
\]
\end{example}
\begin{proof}
	故 \{1,2,3\}、\{4\}、\{5\} 均为等价类。

故 \{1,2,3\} 为非常返等价类、\{4\}、\{5\} 为正常返等价类。
\end{proof}

\begin{remark}
	因为常返等价类 \( C \) 是一个不可约闭集，故令 \( P_C := (p_{ij})_{i,j \in C} \) 时，\( C \) 在 \( P_C \) 下为一个子马氏链。
\end{remark}

\begin{theorem}
	设常返等价类 \( C \) 有周期 \( d > 1 \)。取定 \( C \) 中的状态 \( i \)，对于 \( j \in C \)，
\begin{enumerate}
    \item 有唯一的 \( r \in \{1,2,\cdots,d\} \)，使得只要 \( p_{ij}^{(n)} > 0 \)，则有 \( n = kd + r \)；
    \item 对于 (1) 中的 \( r \)，存在 \( N_j \) 使得 \( n > N_j \) 时，\( p_{ij}^{(nd+r)} > 0 \)；
    \item \( f_{ij} = \sum_{n=0}^{\infty} f_{ij}^{(nd+r)} = 1 \)。
\end{enumerate}
\end{theorem}
\begin{proof}
	(1) 由 \( i \longleftrightarrow j \)，可知必存在 \( n \) 使得 \( p_{ij}^{(n)} > 0 \)。显然存在 \( k \) 及 \( r \) 使得 \( n = kd + r \)。下证对于满足 \( p_{ij}^{(n)} > 0 \) 的 \( r \) 是唯一的。现假设 \( n, m \) 使得 \( p_{ij}^{(n)} p_{ij}^{(m)} > 0 \)，及 \( l \) 使得 \( p_{jl}^{(l)} > 0 \)。则
\[
p_{il}^{(n+l)} \geq p_{ij}^{(n)} p_{jl}^{(l)} > 0,
\]
\[
p_{il}^{(m+l)} \geq p_{ij}^{(m)} p_{jl}^{(l)} > 0,
\]
由于 \( d \mid n+l \)，\( d \mid m+l \)，故 \( d \mid (m+l) - (n+l) \)，即 \( d \mid (m-n) \)。故 \( n, m \) 跟 \( d \) 相除有相同的余数。

(2)任取 \( N \) 使得 \( p_{ij}^{(Nd+r)} > 0 \)。由定理 \ref{3.7} 可知，存在 \( M_j \) 使得 \( \forall m > M_j \) 时，\( p_{ij}^{(md)} > 0 \)。当 \( n > N + M_j \) 时，\( n - N > M_j \)，故
\[
p_{ij}^{(nd+r)} \geq p_{ij}^{(Nd+r)} p_{ij}^{(nd-Nd)} = p_{ij}^{(Nd+r)} p_{ij}^{(md)} > 0.
\]
即 \( N_j := N + M_j \)。

(3)由于 \( f_{ij}^{(n)} \) 是质点 \( i \) 出发第 \( n \) 步首次到达 \( j \) 的概率，故 \( f_{ij}^{(n)} \leq p_{ij}^{(n)} \)。于是只要 \( n \) 使得 \( f_{ij}^{(n)} > 0 \) 就有 \( p_{ij}^{(n)} > 0 \)，从而 \( n = kd + r \)。由定理 \ref{4.5}(4) 可知
\[
f_{ij} = \sum_{n=1}^{\infty} f_{ij}^{(n)} = \sum_{n=0}^{\infty} f_{ij}^{(nd+r)} = 1.
\]
\end{proof}
\begin{theorem}
	设常返等价类 \( C \) 有周期 \( d > 1 \)。
\begin{enumerate}
    \item[(a)] \( C \) 可分成 \( d \) 个不相交的集合的并：
    \[
    C = G_1 \bigcup G_2 \bigcup \cdots \bigcup G_d,
    \]
    其中，从任一 \( G_m \) 中的状态出发，下一步到达 \( G_{m+1(\bmod d)} \) 中某状态的概率大于 0；
    \item[(b)] \( P^d \) 限制在 \( C \) 是非周期的，且 \( \sum_{k \in G_m} p_{ik}^{(d)} = 1 \ \forall i \in G_m \)。且将 \( P^d \) 限制在 \( G_m \) 上时，构成一个不可约非周期的子链。
\end{enumerate}
\end{theorem}
\begin{theorem}
	常返等价类是极小闭集。
\end{theorem}
\subsection{不可约马氏链的极限定理}
\begin{example}
	设Markov链 \(\{X_n, n = 0, 1, \ldots\}\) 状态空间为 \( S := \{1, 2\} \)，其转移矩阵为

\[
\mathbf{P} = \left(
\begin{array}{cc}
1-p & p \\
q & 1-q
\end{array}
\right), \quad 0 < p, q < 1
\]

现在考虑 \(\mathbf{P}^{(n)}\) 当 \(n \to \infty\) 时的情况。

\end{example}
\begin{proof}
	由 \(\mathbf{P}^{(n)} = \mathbf{P}^n\) 知，只需计算 \(\mathbf{P}\) 的 \(n\) 重乘积的极限。求 \(\mathbf{P}\) 所对应的特征根：\(|\lambda \mathbf{I} - \mathbf{P}| = 0\) 可得 \(\lambda_1 = 1\) 以及 \(\lambda_2 = 1 - p - q\)。解得 \(\lambda_1 = 1\) 是特征向量为 \((1, 1)^T\)，\(\lambda_2 = 1 - p - q\) 时特征向量为 \((-p, q)^T\)。故令

\[
\mathbf{Q} = \left(
\begin{array}{cc}
1 & -p \\
1 & q
\end{array}
\right), \quad
\mathbf{D} = \left(
\begin{array}{cc}
1 & 0 \\
0 & 1 - p - q
\end{array}
\right)
\]

则

\[
\mathbf{Q}^{-1} = \left(
\begin{array}{cc}
\frac{q}{p+q} & \frac{p}{p+q} \\
-\frac{1}{p+q} & \frac{1}{p+q}
\end{array}
\right), \quad
\mathbf{P} = \mathbf{Q} \mathbf{D} \mathbf{Q}^{-1}
\]

从而

\[
\mathbf{P}^n = (\mathbf{Q} \mathbf{D} \mathbf{Q}^{-1})^n = \mathbf{Q} \left(
\begin{array}{cc}
1 & 0 \\
0 & 1 - p - q
\end{array}
\right)^n \mathbf{Q}^{-1}
\]

\[
= \left(
\begin{array}{cc}
\frac{q + p(1-p-q)^n}{p+q} & \frac{p - p(1-p-q)^n}{p+q} \\
\frac{q - q(1-p-q)^n}{p+q} & \frac{p + q(1-p-q)^n}{p+q}
\end{array}
\right)
\]

由于 \(|1 - p - q| < 1\)，(6.1)式的极限为

\[
\lim_{n \to \infty} \mathbf{P}^n = \left(
\begin{array}{cc}
\frac{q}{p+q} & \frac{p}{p+q} \\
\frac{q}{p+q} & \frac{p}{p+q}
\end{array}
\right)
\]

可见此Markov链的\(n\)步转移概率有一个稳定的极限。
\end{proof}
\begin{theorem}[不可约马氏链的极限定理]	\label{6.25}
	设 \( P \) 不可约，则下述断言等价：
\begin{enumerate}
    \item \( P \) 是正常返（不可约假设下，一个状态正常返则所有状态正常返!）；
    \item \( P \) 有平稳分布，进而平稳分布唯一：对一切 \( j \)，\( \pi_j = \frac{1}{\mu_j} \)（此处，\( \mu_j = E[T_{jj} | X_0 = j] \)）；
    \item 若 \( P \) 还是非周期的，则 (1) 和 (2) 又都分别等价于 \( \lim_{n \to \infty} p_{ij}^{(n)} = \frac{1}{\mu_j} > 0 \)（不依于 \( i \)）
\end{enumerate}
\end{theorem}

我们回到之前那一题
\begin{example}
	设Markov链 \(\{X_n, n = 0, 1, \ldots\}\) 状态空间为 \( S := \{1, 2\} \)，其转移矩阵为

\[
\mathbf{P} = \left(
\begin{array}{cc}
1-p & p \\
q & 1-q
\end{array}
\right), \quad 0 < p, q < 1
\]

现在考虑 \(\mathbf{P}^{(n)}\) 当 \(n \to \infty\) 时的情况。

\end{example}
\begin{proof}
	\begin{equation}
		\begin{cases}
		(\pi_1, \pi_2) \mathbf{P} = (\pi_1, \pi_2) \\
		\pi_1 + \pi_2 = 1 \\
		\pi_i \geq 0. \ (i = 1, 2)
		\end{cases}
		\end{equation}
		
		解得 \(\pi_1 = \frac{q}{q+p}\), \(\pi_2 = \frac{p}{q+p}\)。
		
		故该马氏链平稳分布存在，且马氏链不可约非周期。由不可约马氏链极限定理\ref{6.25}可知
		
		\[
		\lim_{n \to \infty} \mathbf{P}^n = \left(
		\begin{array}{cc}
		\pi_1 & \pi_2 \\
		\pi_1 & \pi_2
		\end{array}
		\right) = \left(
		\begin{array}{cc}
		\frac{q}{p+q} & \frac{p}{p+q} \\
		\frac{q}{p+q} & \frac{p}{p+q}
		\end{array}
		\right)
		\]
	
\end{proof}
\begin{example}
	设马氏链的状态是 \( S = \{1, 2\} \)，转移矩阵是

\[
\mathbf{P} = \left(
\begin{array}{cc}
\frac{3}{4} & \frac{1}{4} \\
\frac{5}{8} & \frac{3}{8}
\end{array}
\right)
\]

(1) 计算不变分布 \(\pi\) 和极限 \(\lim_{n \to \infty} \mathbf{P}^n\)；
(2) 计算状态 1, 2 的期望返回时间 \(\mu_1, \mu_2\)。

\end{example}
\begin{proof}
	\[
\begin{cases}
(\pi_1, \pi_2) \mathbf{P} = (\pi_1, \pi_2) \\
\pi_1 + \pi_2 = 1 \\
\pi_i \geq 0. \ (i = 1, 2)
\end{cases}
\]

\(\pi_1 = \frac{5}{7}\) 以及 \(\pi_2 = \frac{2}{7}\)。

(2) 由于该马氏链为不可约非周期马氏链，且平稳分布存在唯一。故该马氏链为正常返链。由不可约马氏链极限定理\ref{6.25}可知
\[
\lim_{n \to \infty} p_{11}^{(n)} = \lim_{n \to \infty} p_{21}^{(n)} = \frac{5}{7},
\]
\[
\lim_{n \to \infty} p_{12}^{(n)} = \lim_{n \to \infty} p_{22}^{(n)} = \frac{2}{7}.
\]

(3) 由(2)分析以及不可约马氏链极限定理\ref{6.25}可知 \(\mu_1 = \frac{1}{\pi_1} = \frac{7}{5}\), \(\mu_2 = \frac{1}{\pi_2} = \frac{7}{2}\).
\end{proof}
\subsection{一般情况下马氏链的极限定理}
\begin{definition}[本质状态]
	称状态 \( i \) 为本质的，若 \( i \to j \) 时必有 \( j \to i \)。否则称为非本质。
\end{definition}
\begin{theorem}
	常返状态是本质状态。
\end{theorem}
\begin{example}
	\begin{equation*}
		S = \{0, 1, 2, 3, 4\}
		\end{equation*}
		
		\[
		\mathbf{P} = \left(
		\begin{array}{ccccc}
		\frac{1}{3} & \frac{2}{3} & 0 & 0 & 0 \\
		0 & \frac{1}{2} & \frac{1}{2} & 0 & 0 \\
		\frac{3}{4} & \frac{1}{4} & 0 & 0 & 0 \\
		\frac{1}{3} & 0 & 0 & \frac{1}{3} & \frac{1}{3} \\
		0 & 0 & 0 & 0 & 1
		\end{array}
		\right)
		\]
		
	
\end{example}
\begin{proof}
	0, 1, 2 是常返态，4 是常返态，3 非常返态。0, 1, 2 是本质态，4 是本质态；3 非本质态。
\end{proof}
\begin{lemma}
	设 \( C \) 为某个常返等价类。

记 \(\widetilde{\mathbf{P}} = (\widetilde{p}_{ij})_{i,j \in C} := \mathbf{P}_C\)，其中 \(i,j \in C\) 时 \(\widetilde{p}_{ij} = p_{ij}\)。\(i, j \in C\) 时，记 \(\widetilde{f}_{ij}^{(n)} = \widetilde{\mathbf{P}}(T_{ij} = n | X_0 = i)\)，其中 \(T_{ij} = n\) 为在 \(\widetilde{\mathbf{P}}\) 下状态 \(i\) 到达状态 \(j\) 的首达时间，即说明 \(\widetilde{f}_{ij}^{(n)}\) 为在子马氏链 \(C\) 中状态 \(i\) 经过 \(n\) 步首次到达状态 \(j\) 的概率。则 \(\widetilde{f}_{ij}^{(n)} = f_{ij}^{(n)}\)，平均返回时间 \(\widetilde{\mu}_i = \mu_i\)。
\end{lemma}
\begin{proof}
	用数学归纳法：当 \(n = 1\) 时，
\[
\widetilde{f}_{ij}^{(1)} = \widetilde{p}_{ij} = p_{ij} = f_{ij}^{(1)}.
\]
假设当 \(n = k\) 时，有 \(\widetilde{f}_{ij}^{(k)} = f_{ij}^{(k)}\)。则当 \(n = k + 1\) 时，
\begin{align*}
\widetilde{f}_{ij}^{(k+1)} &= \sum_{x \in C, x \neq j} \widetilde{p}_{ix} \widetilde{f}_{xj}^{(k)} \\
&= \sum_{x \in C, x \neq j} p_{ix} f_{xj}^{(k)} + \sum_{x \notin C, x \neq j} p_{ix} f_{xj}^{(k)} \\
&= f_{ij}^{(k+1)}.
\end{align*}

\end{proof}
\begin{lemma}
	设 \(\{a_n, n \geq 0\}\) 为一个不全为零的非负数列，且满足条件
\[
\lim_{n \to \infty} \frac{a_n}{\sum_{m=0}^n a_m} = 0,
\]
\(\{b_n, n \geq 0\}\) 为一个收敛数列，则
\[
\lim_{n \to \infty} \frac{\sum_{m=0}^n a_m b_{n-m}}{\sum_{m=0}^n a_m} = \lim_{n \to \infty} b_n.
\]
\end{lemma}

约定 \(\mu_j = \begin{cases} 
	\mu_j & \text{常返} \\
	\infty & \text{非常返}
	\end{cases}\)

\begin{theorem}\label{6.30}



		\begin{enumerate}
			\item 如果 \(j\) 非常返，则对一切 \(i \in S\)，有 \(\lim_{n \to \infty} p_{ij}^{(n)} = 0\)。
			\item 如果 \(j\) 常返，其周期为 \(d(j)\)，则对一切 \(i \in S\) 和 \(1 \leq r \leq d(j)\)，有
			\[
			\lim_{n \to \infty} p_{ij}^{(nd(j)+r)} = \frac{d(j)}{\mu_j} \sum_{m=0}^{\infty} f_{ij}^{(md(j)+r)}.
			\]
		\end{enumerate}
		
		特别地，
		
		\begin{enumerate}
			\item[a] \(j\) 为零常返时 \(\lim_{n \to \infty} p_{ij}^{(n)} = 0\)。
			\item[b]	 \(j\) 为本质状态（或 \(i\) 为常返态），若 \(i \notin C(j)\)，则对任意的 \(n\) 有 \(p_{ij}^{(n)} = 0\)，则 \(\lim_{n \to \infty} p_{ij}^{(n)} = 0\)。
			\item[c] 若 \(i \in C(j)\) 且 \(j\) 属于 \(C(i)\) 周期性分解中第 \(r\) 个子集（即若 \(p_{ij}^{(m)} > 0\) 有 \(m = nd(j) + r\)），则
		\[
		\lim_{n \to \infty} p_{ij}^{(nd(j)+r)} = \frac{d(j)}{\mu_j}.
		\]
		否则 \(p_{ij}^{(n)} = 0\)，当 \(n \neq md + r\)。
		\end{enumerate}
\end{theorem}
\begin{corollary}
	设 \( j \) 为非周期状态。对任意的 \( i \in S \),

\[
\lim_{n \to \infty} p_{ij}^{(n)} = \frac{f_{ij}}{\mu_j},
\]

其中当 \( j \) 为非常返时，\( \mu_j := \infty \)。
\end{corollary}
\begin{example}
	设有6个车站, 车站中间的公路连接情况如图所示.

\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        station/.style={circle, draw, minimum size=1cm},
        >=stealth
    ]
    
    % 定义车站位置
    \node[station] (A) at (0,0) {1};
    \node[station] (B) at (3,0) {2};
    \node[station] (C) at (4.5,2) {3};
    \node[station] (D) at (3,4) {4};
    \node[station] (E) at (0,4) {5};
    \node[station] (F) at (-1.5,2) {6};
    
    % 连接公路
    \draw (A) -- (B);
    \draw (B) -- (C);
    \draw (C) -- (D);
    \draw (A) -- (F);
	\draw (F) -- (E);
	\draw (B) -- (F);
	\draw (C) -- (D);
	\draw (D) -- (E);
	\draw (E) -- (F);
	\draw (F) -- (D);
    \end{tikzpicture}
\end{figure}

汽车每天可以从一个站驶向与之直接相临的车站，并在夜晚到达车站留宿，次日凌晨重复相同的活动。设每天凌晨汽车开往临近的任何一个车站都是等可能的，试说明很长时间后，各站每晚留宿的汽车比例趋于稳定。求出这个比例以便正确地设置各站的服务规模。


\end{example}
\begin{proof}
	以 $\{X_n, n = 0, 1, \ldots\}$ 记第 $n$ 天某辆汽车留宿的车站号，这是一个 Markov 链，转移概率矩阵为

\[
P = \begin{pmatrix}
0 & \frac{1}{2} & 0 & 0 & 0 & \frac{1}{2} \\
\frac{1}{3} & 0 & \frac{1}{3} & 0 & 0 & \frac{1}{3} \\
0 & \frac{1}{2} & 0 & \frac{1}{2} & 0 & 0 \\
0 & 0 & \frac{1}{3} & 0 & \frac{1}{3} & \frac{1}{3} \\
0 & 0 & 0 & \frac{1}{2} & 0 & \frac{1}{2} \\
\frac{1}{4} & \frac{1}{4} & 0 & \frac{1}{4} & \frac{1}{4} & 0
\end{pmatrix}
\]

解方程
\[
\begin{cases}
\pi P = \pi \\
\sum_{i=1}^{6} \pi_i = 1
\end{cases}
\]

其中 $\pi = (\pi_1, \pi_2, \pi_3, \pi_4, \pi_5, \pi_6)$，可得 $\pi = \left(\frac{1}{8}, \frac{3}{16}, \frac{1}{8}, \frac{3}{16}, \frac{1}{8}, \frac{1}{4}\right)$。故无论开始汽车从哪一个车站出发在很长时间后他在任一个车站留宿的概率都是固定的，所有的汽车也将以一个稳定的比例在各车站留宿。
\end{proof}
\begin{example}
	设甲袋中有 $k$ 个白球和 1 个黑球，乙袋中有 $k+1$ 个白球，每次从两袋中各任取一球，交换后放入对方的袋中。证明经过 $n$ 次交换后，黑球仍在甲袋中的概率 $p_n$ 满足 $\lim_{n \to \infty} p_n = \frac{1}{2}$。
\end{example}
\begin{proof}
	以 $X_n$ 表示第 $n$ 次取球后甲袋中的黑球数，则 $\{X_n, n = 0, 1, 2, \cdots\}$ 是状态空间为 $S = \{0, 1\}$ 的时齐 Markov 链，一步转移概率矩阵为

\[
P = \begin{pmatrix}
\frac{k}{k+1} & \frac{1}{k+1} \\
\frac{1}{k+1} & \frac{k}{k+1}
\end{pmatrix}
\]

则它的平稳分布满足
\[
\begin{cases}
\pi_0 = \frac{k}{k+1} \pi_0 + \frac{1}{k+1} \pi_1 \\
\pi_1 = \frac{1}{k+1} \pi_0 + \frac{k}{k+1} \pi_1
\end{cases}
\]
且有 $\pi_0 + \pi_1 = 1$，

求解得 $\pi = (\pi_0, \pi_1) = \left(\frac{1}{2}, \frac{1}{2}\right)$。故
\[
\lim_{n \to \infty} P^n = \begin{pmatrix}
\frac{1}{2} & \frac{1}{2} \\
\frac{1}{2} & \frac{1}{2}
\end{pmatrix}
\]
由于初始分布 $\pi(0) = (0, 1)$，
\[
\lim_{n \to \infty} \pi(0) P^n = \pi(0) \begin{pmatrix}
\frac{1}{2} & \frac{1}{2} \\
\frac{1}{2} & \frac{1}{2}
\end{pmatrix} = \left(\frac{1}{2}, \frac{1}{2}\right)
\]
故经过 $n$ 次交换后，黑球仍在甲袋中的概率 $p_n$ 满足
\[
\lim_{n \to \infty} p_n = \lim_{n \to \infty} P\{X_n = 1\} = \pi_1 = \frac{1}{2}
\]

\end{proof}
如果把关于 $n$ 的逐点极限改为平均极限，则结果十分简洁，并有下列结果：
\begin{theorem}
	对一切 $i, j \in S$，有
\[
\lim_{n \to \infty} \frac{1}{n} \sum_{m=1}^{n} p_{ij}^{(m)} = \frac{f_j}{\mu_j}.
\]
其中当 $j$ 非常返时 $\mu_j := \infty$。

\end{theorem}
\begin{proof}
	当 $j$ 为非常返时，由 $\lim_{n \to \infty} p_{ij}^{(n)} = 0$，

故 $\lim_{n \to \infty} \frac{1}{n} \sum_{m=1}^{n} p_{ij}^{(m)} = \lim_{n \to \infty} p_{ij}^{(n)} = 0$ 且 $\mu_j = \infty$ (约定)，则上述结论明显成立。

\end{proof}

下面考虑 $j$ 为常返的情形。为此，需一个数学分析中的结论。
\begin{lemma}
	设有正整数 $d$ 和数列 $\{a_n : n \geq 1\}$ 满足
\[
\lim_{n \to \infty} a_{nd+r} = b_r \quad 1 \leq r \leq d.
\]
则有：
\[
\lim_{n \to \infty} \frac{1}{n} \sum_{m=1}^{n} a_m = \frac{1}{d} \sum_{m=1}^{d} b_m.
\] 
\end{lemma}

当 $j$ 为常返时，令 $d = d(j)$，由定理 \ref{6.30} (b) 得：
\[
\lim_{n \to \infty} p_{ij}^{(nd+r)} = \frac{d}{\mu_j} \sum_{m=0}^{\infty} f_{ij}^{(md+r)} \quad 1 \leq r \leq d.
\]

现再由引理 得：
\[
\lim_{n \to \infty} \frac{1}{n} \sum_{m=1}^{n} p_{ij}^{(m)} = \frac{1}{d} \sum_{r=1}^{d} \left[ \lim_{n \to \infty} p_{ij}^{(nd+r)} \right]
\]
\[
= \frac{1}{d} \sum_{r=1}^{d} \left[ \frac{d}{\mu_j} \sum_{m=0}^{\infty} f_{ij}^{(md+r)} \right]
\]
\[
= \frac{1}{\mu_j} \sum_{r=1}^{d} \sum_{m=0}^{\infty} f_{ij}^{(md+r)}
\]
\[
= \frac{1}{\mu_j} f_{ij}.
\]
\begin{theorem}
	对任意的 $j \in S$，$\{f_{ij}, i \in S\}$ 是线性方程组
\[
z_i = \sum_{k \neq j} p_{ik} z_k + p_{ij}, \quad i \in S,
\]
即
\[
f_{ij} = \sum_{k \neq j} p_{ik} f_{kj} + p_{ij}, \quad i \in S,
\]
的解.（见《随机过程引论》何声武 49 页）

\end{theorem}
\begin{theorem}
	设 $j, k \in S$ 属于同一常返类，则对任意的 $i \in T$ ($T$ 表示非常返状态全体) 有 $f_{ij} = f_{ik}$.（见《随机过程引论》何声武 50 页）

\end{theorem}
\begin{example}
	记 $S = \{0, 1, 2, 3, 4, 5\}$.

\[
\mathbf{P} = \begin{pmatrix}
1/6 & 1/6 & 1/6 & 1/6 & 1/6 & 1/6 \\
0 & 1/4 & 1/4 & 1/2 & 0 & 0 \\
0 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & 1 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 1 \\
0 & 0 & 0 & 0 & 1/3 & 2/3
\end{pmatrix}
\]

求 $f_{ij}$ 以及 $\lim_{n \to \infty} \frac{1}{n} \sum_{\nu=1}^{n} p_{ij}^{(\nu)}$.

\end{example}

\begin{proof}
	\[
\mathbf{P}|_{G_1} = \begin{pmatrix}
1/4 & 1/4 & 1/2 \\
1 & 0 & 0 \\
0 & 1 & 0
\end{pmatrix}
\]

\[
\mathbf{P}|_{G_2} = \begin{pmatrix}
0 & 1 \\
1/3 & 2/3
\end{pmatrix}
\]

$G_1 := \{1, 2, 3\}$, $G_2 := \{4, 5\}$ 为正常返等价类. $\{0\}$ 为非常返等价类. 记 $(\pi'_1, \pi'_2, \pi'_3)$ 以及 $(\pi'_4, \pi'_5)$ 为在 $\mathbf{P}|_{G_1}$ 和 $\mathbf{P}|_{G_2}$ 上得到平稳分布. 则
\[
\begin{cases}
(\pi'_1, \pi'_2, \pi'_3) \mathbf{P}|_{G_1} = (\pi'_1, \pi'_2, \pi'_3) \\
\pi'_1 + \pi'_2 + \pi'_3 = 1 \\
\pi'_i \geq 0. \quad (i = 1, 2, 3)
\end{cases}
\]
解得 $\pi'_1 = \frac{4}{9}, \pi'_2 = \frac{1}{3}, \pi'_3 = \frac{2}{9}$.

记 $(\pi'_1, \pi'_2, \pi'_3)$ 以及 $(\pi'_4, \pi'_5)$ 为在 $\mathbf{P}|_{G_1}$ 和 $\mathbf{P}|_{G_2}$ 上得到平稳分布. 则
\[
\begin{cases}
(\pi'_4, \pi'_5) \mathbf{P}|_{G_2} = (\pi'_4, \pi'_5) \\
\pi'_4 + \pi'_5 = 1 \\
\pi'_i \geq 0. \quad (i = 4, 5)
\end{cases}
\]
解得 $\pi'_4 = \frac{1}{4}, \pi'_5 = \frac{3}{4}$. 猜猜 $f_{ij}$ 取多少???

\[
(\mathbf{f}_{ij})_{i,j \in S} = \begin{pmatrix}
* & * & * & * & * & * \\
0 & 1 & 1 & 1 & 0 & 0 \\
0 & 1 & 1 & 1 & 0 & 0 \\
0 & 1 & 1 & 1 & 0 & 0 \\
0 & 0 & 0 & 0 & 1 & 1 \\
0 & 0 & 0 & 0 & 1 & 1
\end{pmatrix}
\]

\[
f_{00} = \frac{1}{6}.
\]
\[
f_{01} = p_{00} f_{01} + p_{02} f_{21} + p_{03} f_{31} + p_{04} f_{41} + p_{05} f_{51} + p_{01} = \frac{1}{6} f_{01} + \frac{1}{2}. \text{ 解得 } f_{01} = \frac{3}{5}.
\]
\[
f_{04} = p_{00} f_{04} + p_{01} f_{14} + p_{02} f_{24} + p_{03} f_{34} + p_{05} f_{54} + p_{04} = \frac{1}{6} f_{04} + \frac{1}{3}. \text{ 解得 } f_{04} = \frac{2}{5}.
\]
则
\[
(\mathbf{f}_{ij})_{i,j \in S} = \begin{pmatrix}
1/6 & 3/5 & 3/5 & 3/5 & 2/5 & 2/5 \\
0 & 1 & 1 & 1 & 0 & 0 \\
0 & 1 & 1 & 1 & 0 & 0 \\
0 & 1 & 1 & 1 & 0 & 0 \\
0 & 0 & 0 & 0 & 1 & 1 \\
0 & 0 & 0 & 0 & 1 & 1
\end{pmatrix}
\]

\[
f_{01} = \frac{3}{5}, \frac{1}{\mu_1} = \pi'_1 = \frac{4}{9}. \text{ 由 } \lim_{n \to \infty} \frac{1}{n} \sum_{\nu=1}^{n} p_{ij}^{(\nu)} = \frac{f_{ij}}{\mu_j} \text{ 则}
\]
\[
\left( \lim_{n \to \infty} \frac{1}{n} \sum_{\nu=1}^{n} \mathbf{p}_{ij}^{(\nu)} \right)_{i,j \in S} = \begin{pmatrix}
0 & 4/15 & 1/5 & 2/15 & 1/10 & 3/10 \\
0 & 4/9 & 1/3 & 2/9 & 0 & 0 \\
0 & 4/9 & 1/3 & 2/9 & 0 & 0 \\
0 & 4/9 & 1/3 & 2/9 & 0 & 0 \\
0 & 0 & 0 & 0 & 1/4 & 3/4 \\
0 & 0 & 0 & 0 & 1/4 & 3/4
\end{pmatrix}
\]

\end{proof}

\begin{remark}
	\begin{itemize}
		\item 有限不可约马氏链的状态都是常返状态。
		\item 有限状态马氏链没有零常返态。
		\item 不可约的有限马氏链的状态都是正常返状态。
		\item 有限马氏链必存在正常返态。
	\end{itemize}
\end{remark}
\begin{theorem}
	存在平稳分布的充要条件是存在正常返类。若正常返类记为 $D_1, D_2, \ldots$，则平稳分布具有下列形式：
\[
\pi_i = 
\begin{cases} 
\lambda_n \frac{1}{\mu_i} & i \in D_n \\
0 & i \notin \bigcup_n D_n 
\end{cases}
\]
其中 $\sum_n \lambda_n = 1$，且对任意的 $n$，$\lambda_n \geq 0$

\end{theorem}
\begin{theorem}
	设 $C_+$ 是马氏链 $\{X_n\}$ 的所有正常返状态。

\begin{enumerate}
    \item $\{X_n\}$ 平稳(不变)分布存在的充分必要条件是 $C_+$ 非空；
    \item $\{X_n\}$ 有唯一的平稳(不变)分布的充分必要条件是 $C_+$ 是等价类；
    \item 状态有限的马氏链必有平稳(不变)分布。
\end{enumerate}
\end{theorem}
\chapter{鞅论}
\section{离散时间鞅}
\begin{example}
	在赌局中，某人根据前面各次赌博结果决定下次赌博的金额。设本金为 $X_0$，记第 $n$ 次赌博后本金记为 $X_n$。设 $\{Y_n, n \geq 1\}$ 为独立同分布的随机变量序列，
\[
P(Y_n = 1) = P(Y_n = -1) = \frac{1}{2},
\]
表示每次赌博的结果。

\end{example}
\begin{proof}
	令 $\{Y_n, n = 1, 2, \cdots\}$，是一列独立同分布的随机变量，表示每次赌博的结果
	\[
	P\{Y_n = 1\} = P\{Y_n = -1\} = \frac{1}{2}
	\]
	这里 $\{Y_n = 1\}$ ($\{Y_n = -1\}$) 表示赌博者在第 $n$ 次赌博时的赢(输)。如果赌博者采用的赌博策略(即所下赌注)依赖于前面的赌博结果，那么他的赌博可以用下面的随机变量序列
	\[
	b_n = b_n(Y_1, \cdots, Y_{n-1}), \quad n = 2, 3, \cdots
	\]
	描述，其中 $b_n < \infty$ 是第 $n$ 次的赌注，若赌赢则获利 $b_n$，否则输掉 $b_n$。
	
	设 $X_0$ 是该赌博者的初始赌资，则
	\[
	X_n = X_0 + \sum_{i=1}^{n} b_i Y_i 
	\]
	是他在第 $n$ 次赌博后的赌资。可以断言
	\[
	E[X_{n+1} | Y_1, \cdots, Y_n] = X_n.
	\]
	事实上，由上式我们可以得到
	\[
	X_{n+1} = X_n + b_{n+1} Y_{n+1},
	\]
	因此
	\begin{align*}
	E[X_{n+1} | Y_1, \cdots, Y_n] &= E[X_n | Y_1, \cdots, Y_n] + E[b_{n+1} Y_{n+1} | Y_1, \cdots, Y_n] \\
	&= X_n + b_{n+1} E[Y_{n+1} | Y_1, \cdots, Y_n] \quad (\text{因为 } X_n \text{ 与 } b_{n+1} \text{ 由 } Y_1, \cdots, Y_n \text{ 确定}) \\
	&= X_n + b_{n+1} E[Y_{n+1}] \quad (\text{因为} \{Y_n\} \text{ 是独立随机变量序列}) \\
	&= X_n \quad (\text{因为 } E[Y_{n+1}] = 0, \ \forall n \geq 0).
	\end{align*}
	
	这证明了，如果每次赌博的输赢机会是均等的，并且赌博策略是依赖于前面的赌博结果，则赌博是“公平的”。因此任何赌博者都不可能将公平的赌博通过改变赌博策略使得赌博变成有利于自己的赌博。
	

	
\end{proof}
\begin{definition}[鞅]
	称 $(X_n)_{n \geq 0}$ 关于 $(Y_n)_{n \geq 0}$ 为鞅, 若 $\forall n \in \mathbb{N}$,
\begin{itemize}
    \item $X_n$ 可积;
    \item $E(X_{n+1} | Y_0, Y_1, \cdots, Y_n) = X_n \ a.s.$
\end{itemize}
\end{definition}

\begin{remark}
	由 $E(X_{n+1} | Y_0, Y_1, \cdots, Y_n) = X_n$ 可知，$X_n$ 为 $Y_0, Y_1, \cdots, Y_n$ 的函数。
\end{remark}
\begin{definition}[上鞅]
	称 $(X_n)_{n \geq 0}$ 关于 $(Y_n)_{n \geq 0}$ 上鞅, 若 $\forall n \in \mathbb{N}$,
\begin{itemize}
    \item $E(X_n^-) < \infty$; 其中 $x^- := -\min\{x, 0\}$
    \item $E(X_{n+1} | Y_0, Y_1, \cdots, Y_n) \leq X_n \ a.s.$
    \item $X_n$ 为 $Y_0, Y_1, \cdots, Y_n$ 的函数
\end{itemize}
\end{definition}
\begin{definition}[下鞅]
	称 $(X_n)_{n \geq 0}$ 关于 $(Y_n)_{n \geq 0}$ 下鞅, 若 $\forall n \in \mathbb{N}$,
\begin{itemize}
    \item $E(X_n^+) < \infty$; 其中 $x^+ := \max\{x, 0\}$
    \item $E(X_{n+1} | Y_0, Y_1, \cdots, Y_n) \geq X_n \ a.s.$
    \item $X_n$ 为 $Y_0, Y_1, \cdots, Y_n$ 的函数
\end{itemize}
\end{definition}
\subsection{条件期望的性质}
\begin{theorem}\label{1.5}
	\begin{enumerate}
		\item 若 $X, Y$ 均可积，$\alpha, \beta$ 为常数，则
		\[
		E[\alpha X + \beta Y|\mathscr{F}_0] = \alpha E[X|\mathscr{F}_0] + \beta E[Y|\mathscr{F}_0]; \text{ a.e.}
		\]
		\item $E[1|\mathscr{F}_0] = 1; \text{ a.e.}$
		\item 当 $X \geq 0$ 时，则 $E[X|\mathscr{F}_0] \geq 0$ a.e. \\
		$(X \geq Y \implies E[X|\mathscr{F}_0] \geq E[Y|\mathscr{F}_0] \text{ a.e.});$
		\item $|E[X|\mathscr{F}_0]| \leq E[|X||\mathscr{F}_0]. \text{ a.e.}$
		\item $E[E[X|\mathscr{F}_0]] = E[X]. \text{ a.e.}$
	\end{enumerate}
\end{theorem}
\begin{theorem}\label{1.6}
	\begin{enumerate}
		\item 若 $Y$ 为 $\mathscr{F}_0$ 可测，且 $X, XY$ 可积，则
		\[
		E[XY|\mathscr{F}_0] = Y E[X|\mathscr{F}_0] \text{ a.e.};
		\]
		\item 若 $\mathscr{F}_1 \subset \mathscr{F}_2 \subset \mathscr{F}$，则有
		\[
		E[E[X|\mathscr{F}_2]|\mathscr{F}_1] = E[X|\mathscr{F}_1] = E[E[X|\mathscr{F}_1]|\mathscr{F}_2] \text{ a.e.}
		\]
		\item 若 $X$ 可积，$\sigma(X)$ 与 $\mathscr{F}_0$ 独立，则 $E[X|\mathscr{F}_0] = E[X]$ a.e.; \\
		特别，当 $X, Y$ 相互独立时，$E[X|Y] = E[X]$ a.e..
	\end{enumerate}
\end{theorem}

本节假定所有 r.v. 均定义在同一个概率空间 $(\Omega, \mathcal{F}, P)$ 上. 
$\mathbb{N} :=$ 非负整数全体

\begin{definition}[$\sigma$-代数流]
	称 $\mathcal{F}$ 的子 $\sigma$-域序列 $(\mathcal{F}_n, n \in \mathbb{N})$ 为一个流，若 $\mathcal{F}_n \subseteq \mathcal{F}_{n+1}$. \\
记 $\mathcal{F}_\infty = \bigvee_{n \geq 0} \mathcal{F}_n = \sigma(\bigcup_n \mathcal{F}_n)$
\end{definition}
\begin{definition}
	随机过程 $X = (X_n)_{n \geq 0}$ 为 $(\mathcal{F}_n, n \in \mathbb{N})$ 适应的，若 $\forall n$，$X_n$ 为 $\mathcal{F}_n$ 可测的。（回忆可测的定义？$\forall$ 实数 $a$，$\{\omega | X_n(\omega) \leq a\} \in \mathcal{F}_n$）
\end{definition}
\begin{definition}
	一个 $(\mathcal{F}_n, n \in \mathbb{N})$-适应的随机序列 $X = (X_n)_{n \geq 0}$ 称为 $(\mathcal{F}_n)_{n \in \mathbb{N}}$-鞅，若 $\forall n \in \mathbb{N}$，
\begin{itemize}
    \item $E[|X_n|] < \infty;$
    \item $E(X_{n+1}|\mathcal{F}_n) = X_n \text{ a.s.}$
\end{itemize}
\end{definition}
\begin{definition}
	一个 $(\mathcal{F}_n, n \in \mathbb{N})$-适应的随机序列 $X = (X_n)_{n \geq 0}$ 称为 $(\mathcal{F}_n)_{n \in \mathbb{N}}$-上鞅（下鞅），若 $\forall n \in \mathbb{N}$，
\begin{itemize}
    \item $E[X_n] < \infty; (E[X_n^+] < \infty)$
    \item $E(X_{n+1}|\mathcal{F}_n) \leq X_n, (\geq X_n) \text{ a.s.}$
\end{itemize}

\end{definition}
\begin{remark}
	当 $\{X_n\}$ 分别为 $(\mathcal{F}_n)_{n \in \mathbb{N}}$-鞅、上鞅、下鞅时，$\forall m > n$ 有
\begin{itemize}
    \item $E(X_m|\mathcal{F}_n) = X_n (\leq X_m, \geq X_n) \text{ a.s.}$
    \item $E(X_m) = E(X_n) (\leq E(X_n), \geq E(X_n))$
\end{itemize}
\end{remark}
\begin{remark}
	若 $X = \{X_n, n \geq 0\}$ 为 $(\mathcal{F}_n)_{n \in \mathbb{N}}$-上鞅（下鞅），则 $-X := \{-X_n, n \geq 0\}$ 为 $(\mathcal{F}_n)_{n \in \mathbb{N}}$-下鞅（上鞅）
\end{remark}

\begin{example}
	设 $X_1, X_2, \ldots$ 是一族零均值独立随机变量序列，且 $E[|X_i|] < \infty$，令 $S_0 = 0$，$S_n = \sum_{k=1}^n X_k$，则 $\{S_n\}$ 是关于 $\sigma$-代数流 $\{\mathcal{F}_n\}$ 的鞅，其中 $\mathcal{F}_n := \sigma(X_1, X_2, \cdots, X_n)$. 另外，若 $X_n (n = 1, 2, \cdots)$ 均值为 $\mu \neq 0$，则 $\{M_n = S_n - n\mu\}$ 是 $(\text{关于} \{\mathcal{F}_n\})$ 的鞅。

\end{example}
\begin{proof}
	当 $E[X_n] = 0, (n = 1, 2, \cdots)$ 时，
\begin{itemize}
    \item $S_n$ 是 $X_1, \ldots, X_n$ 的函数，故 $S_n$ 关于 $\mathcal{F}_n$ 可测的，故 $\{S_n\}$ 关于 $\{\mathcal{F}_n\}$ 适应
    \item $E[|S_n|] \leq \sum_{i=1}^n E[|X_i|] < \infty$,
\end{itemize}

\[
E[S_{n+1}|\mathcal{F}_n] = E[X_1 + X_2 + \cdots + X_n + X_{n+1}|\mathcal{F}_n]
\]
\[
= E[X_1 + \cdots + X_n|\mathcal{F}_n] + E[X_{n+1}|\mathcal{F}_n]
\]
\[
= S_n + E[X_{n+1}] = S_n
\]

从而 $\{S_n\}$ 是一个关于 $\{\mathcal{F}_n\}$ 的鞅。
\end{proof}
\begin{example}
	在例 1.3 中设 $E[X_k] = \mu \neq 0, E[|X_k|] < \infty, (k = 1, 2, \cdots)$，则有 $E[|S_n|] < \infty$，
\[
E[S_{n+1}|\mathcal{F}_n] = E\left[\sum_{i=1}^n X_i + X_{n+1}|\mathcal{F}_n\right] = S_n + \mu
\]
显然，若 $\mu > 0 (\mu < 0)$，则 $\{S_n\}$ 是一关于 $\{\mathcal{F}_n\}$ 的下鞅（上鞅）。
\end{example}
\begin{example}[Polya 坛子抽样模型]
	 考虑一个装有红、黄两色球的坛子. 假设最初坛子中装有红、黄两色球各一个，每次都按如下规则有放回地随机抽取：如果拿出的是红色的球，则放回的同时再加入一个同色的球；如果拿出是黄色的球也采取同样的方法. 以 $X_n$ 表示第 $n$ 次抽取后坛子中的红球数，则 $X_0 = 1$，且 $\{X_n\}$ 是一个非时齐的 Markov 链，转移概率为
\[
P\{X_{n+1} = k+1 | X_n = k\} = \frac{k}{n+2}
\]
\[
P\{X_{n+1} = k | X_n = k\} = \frac{n+2-k}{n+2}
\]

\end{example}
\begin{proof}
	显然，若 $\mu > 0 (\mu < 0)$，则 $\{S_n\}$ 是一关于 $\{\mathcal{F}_n\}$ 的下鞅（上鞅）.

令 $M_n$ 表示第 $n$ 次抽取后红球所占的比例，则 $M_n = \frac{X_n}{n+2}$，并且 $\{M_n\}$ 是一个关于 $\{\mathcal{F}_n\}$ 的鞅，其中 $\mathcal{F}_n = \sigma(X_1, \cdots, X_n)$. 这是因为
\[
E[X_{n+1}|X_n = k] = \frac{(k+1)k}{n+2} + \frac{k(n+2-k)}{n+2} = k + \frac{k}{n+2}
\]
\[
E[X_{n+1}|X_n] = X_n + \frac{X_n}{n+2} \text{ a.e.}
\]

\begin{itemize}
    \item 对任意的 $n$，$X_n$ 关于 $\mathcal{F}_n$ 可测，故 $M_n$ 关于 $\mathcal{F}_n$ 可测. 因此 $\{M_n\}$ 关于 $\{\mathcal{F}_n\}$ 适应.
    \item $E[|M_n|] \leq 1$.
    \item 由于 $\{X_n\}$ 是一个 Markov 链，所以
    \[
    E[M_{n+1}|\mathcal{F}_n] = E[M_{n+1}|X_n] = E\left[\frac{X_{n+1}}{n+1+2}|X_n\right] = \frac{1}{n+3}E[X_{n+1}|X_n] = \frac{1}{n+3}(X_n + \frac{X_n}{n+2}) = \frac{X_n}{n+2} = M_n. \text{ a.e.}
    \]
\end{itemize}

本例研究的模型是 Polya 首次引入的，它适用于描述群体增值和传染病的传播等现象.
\end{proof}
\begin{example}
	设 $\xi$ 为一个可积随机变量，令 $X_n := E[\xi|\mathcal{F}_n]$，则 $\{X_n\}$ 为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-鞅.
\end{example}
\begin{proof}
	\begin{itemize}
		\item 显然由条件期望的性质可知，$X_n = E[\xi|\mathcal{F}_n]$ 关于 $\mathcal{F}_n$ 可测. 故 $\{X_n\}$ 关于 $\{\mathcal{F}_n\}$ 适应.
		\item $E[|X_n|] = E[|E[\xi|\mathcal{F}_n]|] \leq E[E[|\xi||\mathcal{F}_n]] = E[|\xi|] < \infty$.
		\item $E[X_{n+1}|\mathcal{F}_n] = E[E[\xi|\mathcal{F}_{n+1}]|\mathcal{F}_n] = E[\xi|\mathcal{F}_n] = X_n.$ a.e.
	\end{itemize}
\end{proof}
\begin{example}
	设 $(\xi_n)$ 为 $\mathcal{F}_n$-适应可积随机变量序列，若对任意的 $n \geq 0$，$\xi_{n+1}$ 与 $\mathcal{F}_n$ 独立。若对任意的 $n \geq 1$，$E(\xi_n) = 0 (< 0, \geq 0)$，令 $X_n := \sum_{i=0}^n \xi_i$，则 $\{X_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}$ 鞅（上，下鞅）.
\end{example}
\begin{proof}
	证鞅的情形
\begin{itemize}
    \item 对给定的 $n$，由于每个 $\xi_i$ 关于 $\mathcal{F}_i$ 可测，且当 $i \leq n$ 时，$\mathcal{F}_i \subset \mathcal{F}_n$. 故 $X_n := \sum_{i=0}^n \xi_i$ 关于 $\mathcal{F}_n$ 可测.
    \item $E[|X_n|] = E[\left|\sum_{i=0}^n \xi_i\right|] \leq \sum_{i=1}^n E[|\xi_i|] < \infty$.
    \item $E[X_{n+1}|\mathcal{F}_n] = E[X_n + \xi_{n+1}|\mathcal{F}_n] = X_n + E[\xi_{n+1}|\mathcal{F}_n] = X_n.$ a.e.
\end{itemize}
\end{proof}


设 $\{Y_n, n \geq 0\}$ 是马尔可夫链，具有转移概率矩阵 $P = (p_{ij})$，$f$ 满足 $f(i) \geq 0$，且 $f(i) = \sum_{j \in S} p_{ij} f(j)$，$|f(i)| < M, i \in S$。令 $X_n = f(Y_n)$，则 $\{X_n, n \geq 0\}$ 关于 $\{Y_n, n \geq 0\}$ 是鞅。

$\mathcal{F}_n := \sigma(Y_i, 0 \leq i \leq n)$。$X_n$ 是 $Y_n$ 的函数，故 $X_n$ 关于 $\mathcal{F}_n$ 可测的，故 $\{X_n\}$ 关于 $\{\mathcal{F}_n\}$ 适应
\[
E[|X_n|] < \infty,
\]

\begin{align*}
E[X_{n+1}|Y_0, Y_1, \ldots, Y_n] &= E[f(Y_{n+1})|Y_0, Y_1, \ldots, Y_n] \\
&= E(f(Y_{n+1})|Y_n) \\
&= \sum_{j \in S} f(j) P(Y_{n+1} = j|Y_n) \\
&= \sum_{j \in S} f(j) P_{Y_n j} = f(Y_n) = X_n.
\end{align*}

\subsection{鞅的性质}
\begin{definition}
	对随机过程 $(X_n)_{n \geq 0}$，令
\[
\mathbb{F}^0(X) = (\mathcal{F}^0_n(X), n \geq 0), \mathcal{F}^0_n(X) = \sigma(X_0, X_1, \cdots, X_n), n \geq 0.
\]
$\mathbb{F}^0(X)$ 为 $X$ 的自然流，即使得 $X$ 适应的最小流。
\end{definition}
\begin{definition}
	简称随机过程 $(X_n)_{n \geq 0}$ 为鞅（上鞅，下鞅），若 $(X_n)_{n \geq 0}$ 为 $(\mathcal{F}^0_n)_{n \in \mathbb{N}}$-鞅（上鞅，下鞅）。
\end{definition}
\begin{theorem}
	设 $X = \{X_n, n \geq 0\}, Y = \{Y_n, n \geq 0\}$ 为两个 $\{\mathcal{F}_n\}$ 鞅（上鞅），则 $X + Y = \{X_n + Y_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}$ 鞅（上鞅），$X \wedge Y = \{X_n \wedge Y_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}$ 上鞅。
\end{theorem}
\begin{proof}
	假设 $X = \{X_n, n \geq 0\}, Y = \{Y_n, n \geq 0\}$ 为两个 $\{\mathcal{F}_n\}$ 上鞅，只证 $X \wedge Y = \{X_n \wedge Y_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}$ 上鞅. 对任意的 $n$，
\begin{itemize}
    \item $(X_n \wedge Y_n)^- := \max\{-(X_n \wedge Y_n), 0\} = \max\{(-X_n) \vee (-Y_n), 0\}$
    \item $\leq \max\{(-X_n), 0\} + \max\{(-Y_n), 0\} = X_n^- + Y_n^-$
\end{itemize}
故 $E[(X_n \wedge Y_n)^-] \leq E[X_n^-] + E[Y_n^-] < \infty$，

对任意的 $n$，
\begin{itemize}
    \item $X_n \wedge Y_n = \frac{X_n + Y_n - |X_n - Y_n|}{2}$，故 $X_n \wedge Y_n$ 关于 $\mathcal{F}_n$ 可测，即 $X \wedge Y$ 关于 $\{\mathcal{F}_n\}$ 适应.
    \item $E[X_{n+1} \wedge Y_{n+1}|\mathcal{F}_n] \leq E[X_{n+1}|\mathcal{F}_n] \wedge E[Y_{n+1}|\mathcal{F}_n] \leq X_n \wedge Y_n$ a.e.
\end{itemize}
\end{proof}
\begin{theorem}
	设 $X = \{X_n, n \geq 0\}, Y = \{Y_n, n \geq 0\}$ 为两个 $\{\mathcal{F}_n\}$ 上鞅，$a, b$ 为两个正数，则 $\{aX_n + bY_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}$ 上鞅。
\end{theorem}
\begin{theorem}
	设 $f$ 为 $(a, b) \subset (-\infty, +\infty)$ 上的连续有限凸函数，$X$ 为取值 $(a, b)$ 的可积随机变量，则有
\[
f(E[X]) \leq E[f(X)]. 
\]
\end{theorem}
\begin{theorem}
	若 $X$ 及 $f(X)$ 为可积随机变量，$f(x)$ 为 $\mathbb{R}$ 上的有限连续凸函数，则
	\[
	f(E[X|\mathscr{F}_0]) \leq E[f(X)|\mathscr{F}_0] 
	\]
	\[
	(E[X])^2 \leq E[X^2]. (E[X|\mathscr{F}_0])^2 \leq E[X^2|\mathscr{F}_0].
	\]
\end{theorem}
\begin{definition}
	设 $f$ 为定义在区间 $I$ 上的函数，若对 $I$ 上的任意两点 $x_1, x_2$ 和任意的实数 $\lambda \in (0, 1)$，总有 $f(\lambda x_1 + (1-\lambda)x_2) \leq \lambda f(x_1) + (1-\lambda)f(x_2)$ 则称为 $I$ 上的凸函数。


\end{definition}
判定方法可利用定义法以及函数的二阶导数 

对于实数集上的凸函数，一般的判别方法是求它的二阶导数，如果其二阶导数在区间上非负，就为凸函数。
\begin{theorem}
	若 $X = \{X_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-鞅（下鞅），$f$ 为 $\mathbb{R}$ 上的连续凸（凸增）函数。若 $f(X_n)$ 可积 $(\forall n \geq 0)$，则 $\{f(X_n), n \geq 0\}$ 为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-下鞅。

\end{theorem}
\begin{proof}
	只证下鞅的情形：
\begin{itemize}
    \item 由 $\{X_n\}$ 为下鞅，$f(X_n)$ 关于 $\mathcal{F}_n$ 可测，故 $\{f(X_n)\}$ 关于 $\{\mathcal{F}_n\}$ 适应.
    \item $E[|f(X_n)|] < \infty$.
    \item 由于 $f$ 凸增函数，$f(X_n) \leq f(E[X_{n+1}|\mathcal{F}_n]) \leq E[f(X_{n+1})|\mathcal{F}_n]$ a.e.
\end{itemize}
\end{proof}
\begin{corollary}
	设 $X = \{X_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-下鞅，$X \vee a := \{X_n \vee a, n \geq 0\}$ 为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-下鞅. 特别地 $a = 0$ 时，$X^+ := \{X_n^+, n \geq 0\}$ 为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-下鞅.

\end{corollary}
\begin{proof}
	任取 $0 \leq \lambda \leq 1$，$x, y$，则可知
\[
\lambda (x \vee a) + (1 - \lambda)(y \vee a) = (\lambda x \vee a) + [(1 - \lambda)y \vee (1 - \lambda)a]
\]
\[
\geq [ \lambda x + (1 - \lambda)y] \vee a
\]
综合可知 $x \vee a$ 为一个凸函数.
\end{proof}
\begin{definition}
	若 $X = \{X_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-鞅（上，下鞅），若 $X_n \in L^p(\Omega, \mathcal{F}, P) (p \geq 1)$，则称 $X = \{X_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-$L^p$ 鞅（上，下鞅）。若 $X = \{X_n, n \geq 0\}$ 满足 $\sup_n E[|X_n|^p] < \infty$，则称为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-$L^p$ 有界鞅（上，下鞅）。
\end{definition}
\begin{corollary}
	设 $X = \{X_n, n \geq 0\}$ 为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-$L^p$ 鞅，$|X|^p := \{|X_n|^p, n \geq 0\}$ 为下鞅。

\end{corollary}
\begin{proof}
	当 $p = 1$ 时，任取 $x, y$ 以及 $0 \leq \lambda \leq 1$ 可知，
\[
|\lambda x + (1 - \lambda)y| \leq \lambda |x| + (1 - \lambda)|y|, \text{ 故此时为凸函数.}
\]
当 $p > 1$ 时，求二阶导数，可知任意点二阶导数非负，故仍为凸函数.
\end{proof}
\begin{definition}
	随机序列 $X = \{X_n, n \geq 0\}$ 称为 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$-可料的，如果 $X_0$ 为 $\mathcal{F}_0$-可测，且对任意的 $n \geq 1$，$X_n$ 为 $\mathcal{F}_{n-1}$ 可测的. 
$A = \{A_n, n \geq 0\}$ 称为增序列，如果对任意的 $n \geq 0$，$0 \leq A_n \leq A_{n+1}$ a.s.. 定义 $A_\infty := \lim_{n \to \infty} A_n$，增序列 $\{A_n\}$ 称为可积的，若 $E[A_\infty] < \infty$.

\end{definition}
\begin{theorem}
	设 $X = \{X_n, n \geq 0\}$ 为一 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$ 下鞅，则 $X$ 可唯一的分解为 $X_n = M_n + A_n$，其中 $\{M_n, n \geq 0\}$ 为一 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$ 鞅，$\{A_n, n \geq 0\}$ 为一 $\{\mathcal{F}_n\}_{n \in \mathbb{N}}$ 可料增过程，且 $A_0 = 0$，称为 $X$ 的 \textit{Doob}-分解.
\end{theorem}

\section{停时和鞅的停时定理}
N := 非负整数全体, $\overline{\mathbb{N}} := \mathbb{N} \cup \{\infty\}$, 本节假定所有r.v. 均定义在同一个带流的概率空间$(\Omega, \mathcal{F}, (\mathcal{F}_n), P)$上.
\begin{definition}
	在$\mathbb{N}$中取值的随机变量$T$叫做$\mathcal{F}_n$-停时(或可选时), 若对任意的$n \geq 0$有$\{\omega | T(\omega) = n\} \in \mathcal{F}_n$或等价的$\{\omega | T(\omega) \leq n\} \in \mathcal{F}_n$.
\end{definition}
\begin{lemma}
	设$T$是取值于$\{0, 1, 2, \cdots, \infty\}$的随机变量，则下述三者等价
\begin{enumerate}
    \item 对任意的$n$, $\{T = n\} \in \mathcal{F}_n$;
    \item 对任意的$n$, $\{T \leq n\} \in \mathcal{F}_n$;
    \item 对任意的$n$, $\{T > n\} \in \mathcal{F}_n$.
\end{enumerate}
\end{lemma}
\begin{proof}
	只要注意到如下等式，即可证明(1),(2),(3)的等价性。

\begin{align*}
\{T \leq n\} &= \bigcup_{k=0}^{n} \{T = k\} \\
\{T > n\} &= \Omega - \{T \leq n\} \\
\{T = n\} &= \{T \leq n\} - \{T \leq n-1\}
\end{align*}
\end{proof}


由定义我们知道事件$\{T = n\}$或$\{T \neq n\}$都应该由$n$时刻及其之前的信息完全确定，而不需要也无法借助将来的情况。仍然回到公平博弈的例子，赌博者决定何时停止赌博只能以他已经赌过的结果为依据，而不能说，如果我下一次要输我现在就停止赌博，这是对停止时刻$T$的第一个要求：它必须是一个停时。

显然$T = n$是停时。

对任意的$k$
\[
\{T = k\} = 
\begin{cases} 
\Omega & \text{若 } n = k \\
\emptyset & \text{若 } n \neq k 
\end{cases}
\]
则$T$为停时。

\begin{example}[首达时]
	$\{X_n, n \geq 0\}$是一个随机变量序列，$A$是一个事件集，令
\[
T(A) = \inf\{n, X_n \in A\}, \text{并约定 } T(\emptyset) = \inf\{n, X_n \in \emptyset\} = \infty,
\]
可见$T(A)$是$\{X_n, n \geq 0\}$首次进入$A$(即发生了$A$中所含事件)的时刻，称$T(A)$是$\{X_n, n \geq 0\}$到集合$A$的首达时，可以证明$T(A)$是关于$\{X_n, n \geq 0\}$的停时。事实上
\[
\{T(A) = n\} = \{X_0 \notin A, X_1 \notin A, \cdots, X_{n-1} \notin A, X_n \in A\}
\]
显然$\{T(A) = n\}$完全由$X_0, X_1, \cdots, X_n$决定，从而$T(A)$是关于$\{\mathcal{F}_n\}$的停时，其中$\mathcal{F}_n := \sigma(X_0, X_1, \ldots, X_n)$。
\end{example}
\begin{example}
	设$\{X_n, n \geq 0\}$为关于$\{\mathcal{F}_n\}$适应的随机变量序列，$B \in \mathbb{B}(\mathbb{R})$，$S$为停时，令$A := \{m: m \geq S(\omega), X_m(\omega) \in B\}$

\[
T(\omega) = 
\begin{cases} 
\inf\{m: m \geq S(\omega), X_m(\omega) \in B\} & \text{若} A \neq \emptyset \\
\infty & \text{若} A = \emptyset 
\end{cases}
\]

则$T$为$\{\mathcal{F}_n\}$停时。
\end{example}
\begin{proof}
	当$S = k < n = T$时，即$\bigcap\limits_{k \leq m < n} \{X_m \in B^c\} \cap \{X_n \in B\} \in \mathcal{F}_n$。故把$S$的所有可能性都考虑，

\[
\{T = n\} = \bigcup_{k=0}^{n} \left[ \{S = k\} \bigcap_{k \leq m < n} \{X_m \in B^c\} \cap \{X_n \in B\} \right] \subseteq \mathcal{F}_n
\]
\end{proof}
设$T$为$\{\mathcal{F}_n\}$-停时，令$\mathcal{F}_T := \{A \in \mathcal{F}_\infty | \forall n \geq 0, A \cap \{T \leq n\} \in \mathcal{F}_n\}$称为$T$前事件$\sigma$-域。

显然$\mathcal{F}_T := \{A \in \mathcal{F}_\infty | \forall n \geq 0, A \cap \{T = n\} \in \mathcal{F}_n\}$。

$\mathcal{F}_T$为$\sigma$-代数。且当$T = t$时，$\mathcal{F}_T = \mathcal{F}_t$。
\begin{theorem}
	设$S, T$为$\{\mathcal{F}_n\}$停时，$(S_k)$为$\{\mathcal{F}_n\}$停时列。
\begin{enumerate}
    \item $\bigwedge_k S_k, \bigvee_k S_k$为$\{\mathcal{F}_n\}$停时。
    \item $S \leq T$，则有$\mathcal{F}_S \subset \mathcal{F}_T$。
\end{enumerate}
其中$\bigwedge_k S_k := \min_k \{S_k\}, \bigvee_k S_k := \max_k \{S_k\}$。
\end{theorem}
\begin{theorem}
	设$S, T$为$\{\mathcal{F}_n\}$停时，$(S_k)$为$\{\mathcal{F}_n\}$停时列。
\begin{enumerate}
    \item $\bigwedge_k S_k, \bigvee_k S_k$为$\{\mathcal{F}_n\}$停时。
    \item $S \leq T$，则有$\mathcal{F}_S \subset \mathcal{F}_T$。
\end{enumerate}

\end{theorem}
\begin{proof}
	\begin{enumerate}
		\item 对任意的$n$，$\{\bigwedge_k S_k > n\} = \bigcap_k \{S_k > n\} \in \mathcal{F}_n$，$\{\bigvee_k S_k \leq n\} = \bigcap_k \{S_k \leq n\} \in \mathcal{F}_n$。
		\item 对任意的$A \in \mathcal{F}_S$，则$A \in \mathcal{F}_\infty$，
		\[
		A \cap \{T \leq n\} = A \cap \{S \leq n\} \cap \{T \leq n\} \in \mathcal{F}_n
		\]
		故$A \in \mathcal{F}_T$。
	\end{enumerate}
\end{proof}
\begin{theorem}
	设$\{X_n, n \geq 0\}$为一$\{\mathcal{F}_n\}_{n \in \mathbb{N}}$鞅（上鞅，下鞅），$S, T$为两个$\{\mathcal{F}_n\}_{n \in \mathbb{N}}$有界停时，且$S \leq T$，则$E[X_T \mid \mathcal{F}_S] = X_S (\leq X_S, \geq X_S)$ a.e.
\end{theorem}
\begin{theorem}
	设$\{X_n, n \geq 0\}$为一$\{\mathcal{F}_n\}_{n \in \mathbb{N}}$鞅，$T$为$\{\mathcal{F}_n\}_{n \in \mathbb{N}}$停时，且满足
\begin{enumerate}
    \item $P(T < \infty) = 1$；
    \item $E[|X_T|] < \infty$；
    \item $\lim_{n \to \infty} E[|X_n I_{\{T > n\}}|] = 0$。
\end{enumerate}
则$E[X_T] = EX_0$。
\end{theorem}
\begin{example}
	质点在$\{0, 1, 2, \ldots, N\}$上作带吸收壁的随机游动：当质点移动到状态$0, N$时就永远停留在该位置，即$p_{00} = 1, p_{NN} = 1$。质点到达某个状态后，下次向右移动一步的概率是$\frac{1}{2}$，向左移动一步的概率是$\frac{1}{2}$。$X_0 = a$表示初始状态，$X_n$表示质点在时间$n$的状态。假设初始状态与每次移动相互独立。则$\{X_n\}$是马氏链，且是一个$\{\mathcal{F}_n\}$鞅。令$T = \min\{j: X_j = 0 \text{ 或 } X_j = N\}$，则$T$是一个$\{\mathcal{F}_n\}$停时，其中$\mathcal{F}_n := \sigma(X_0, X_1, \ldots, X_n)$。求$P(X_T = N | X_0 = a)$。
\end{example}
\begin{proof}
	\begin{itemize}
		\item 对任意的$n$，显然$X_n$关于$\mathcal{F}_n$可测。
		\item $E[|X_n|] \leq N < \infty$。
	\end{itemize}
	\[
	E[X_{n+1} | \mathcal{F}_n] = E[X_{n+1} | X_n] = 
	\begin{cases} 
	\frac{1}{2}(X_n + 1) + \frac{1}{2}(X_n - 1) = X_n & \text{if } X_n \neq 0, N \\
	X_n & \text{if } X_n = 0, N 
	\end{cases}
	\]
	
	由于$A := \{1, 2, \ldots, N-1\}$为非常返等价类，$C := \{0, N\}$为常返状态全体。由马氏链结论可知$A$中的状态一定走出$A$进入$C$中，故$P(T < \infty) = 1$。$E[|X_T|] \leq N$。由于$T < \infty$ a.e. 故$I_{\{T > n\}} \rightarrow 0$ (as $n \rightarrow \infty$)。且$|X_n I_{\{T > n\}}| \leq N$，由控制收敛定理可知$\lim_{n \to \infty} E[|X_n I_{\{T > n\}}|] = 0$。
	
	由停止定理可知$E(X_T) = E(X_0) = a$。此时$X_T$只取$N, 0$两个值，有$E(X_T) = N \cdot P(X_T = N | X_0 = a) + 0 \cdot P(X_T = 0 | X_0 = a)$，故$P(X_T = N | X_0 = a) = \frac{E(X_T)}{N} = \frac{a}{N}$。
\end{proof}
\begin{theorem}
	设$\{X_n, n \geq 0\}$为一$\{\mathcal{F}_n\}_{n \in \mathbb{N}}$鞅（下鞅），$m \geq 0$。则对任意的$\lambda > 0$有
\begin{enumerate}
    \item $\lambda P(\sup_{0 \leq n \leq m} X_n \geq \lambda) \leq E[X_m I_{\{\max_{0 \leq n \leq m} X_n \geq \lambda\}}] \leq E[X_m^+]$
    \item $\lambda P(\inf_{0 \leq n \leq m} X_n \leq -\lambda) \leq E[|X_m|] + E[|X_0|]$
    \item 若$p \geq 1$且$X$为$L^p$鞅，则有
    \[
    P(\max_{0 \leq n \leq m} |X_n| \geq \lambda) \leq \lambda^{-p} E[|X_m|^p].
    \]
    \item 若$p > 1$，$q$为其共轭指数$(\frac{1}{p} + \frac{1}{q} = 1)$，则有
    \[
    E(\max_{0 \leq n \leq m} |X_n|^p) \leq q^p E[|X_m|^p]
    \]
\end{enumerate}
\end{theorem}
\section{鞅收敛定理}
T = $\mathbb{R}_+ := [0, \infty)$. 本节假定所有r.v. 均定义在同一个带流的概率空间 $(\Omega, \mathcal{F}, P)$ 上.
\begin{definition}
	称 $\mathcal{F}$ 的子 $\sigma$-域序列 $\{\mathcal{F}_t, t \in \mathbb{R}_+\}$ 为一个流，若 $\forall 0 \leq s < t$ 有 $\mathcal{F}_s \subseteq \mathcal{F}_t$. 记 $\mathcal{F}_\infty = \bigvee_{t \geq 0} \mathcal{F}_t$,
\[
\mathcal{F}_{t^+} = \bigcap_{s > t} \mathcal{F}_s, t \geq 0, \mathcal{F}_{t^-} = \bigvee_{s < t} \mathcal{F}_s = \sigma(\bigcup_{s < t} \mathcal{F}_s), t \geq 0.
\]
一个流 $\{\mathcal{F}_t, t \in \mathbb{R}_+\}$ 称为右连续的，若 $\forall t \geq 0$ 有 $\mathcal{F}_t = \mathcal{F}_{t^+}$.
\end{definition}
\begin{definition}
	设 $X = (X(t, \cdot), t \in \mathbb{R}_+)$ 为随机过程，对每个固定的 $t$，$X(t, \cdot)$ 为一个随机变量；而对每个固定的 $\omega \in \Omega$，$X(\cdot, \omega)$ 是关于 $t \in T$ 的映射，称 $X(\cdot, \omega)$ 为样本轨道（或样本函数，一个实现）。若 $X$ 的全部轨道是连续的（右连续的，左连续的），则称 $X$ 为连续（右连续，左连续）过程。如果 $X$ 的全部轨道是右连续并有左极限的。（简称右连左极）。
\end{definition}
\begin{theorem}
	设 $(X_t, t \geq 0)$ 为一 $(\mathcal{F}_t)_{t \in \mathbb{R}_+}$ 右连续下鞅。则对任意的 $\lambda > 0$，$s_0 \leq t_0 \in T$ 有
\begin{enumerate}
    \item $\lambda P(\sup_{s_0 \leq t \leq t_0} X_t \geq \lambda) \leq E[X_{t_0} I_{\{\sup_{s_0 \leq t \leq t_0} X_t \geq \lambda\}}] \leq E[X_{t_0}^+]$
    \item $\lambda P(\sup_{s_0 \leq t \leq t_0} X_t > \lambda) \leq E[X_{t_0} I_{\{\sup_{s_0 \leq t \leq t_0} X_t > \lambda\}}] \leq E[X_{t_0}^+]$
    \item $\lambda P(\inf_{s_0 \leq t \leq t_0} X_t \leq -\lambda) \leq E[|X_{t_0}|] + E[|X_{s_0}|]$
    \item $\lambda P(\inf_{s_0 \leq t \leq t_0} X_t < -\lambda) \leq E[|X_{t_0}|] + E[|X_{s_0}|]$
    \item 若 $p \geq 1$ 且 $X$ 为 $L^p$ 鞅，则有
    \[
    P(\sup_{0 \leq t \leq u} |X_t| \geq \lambda) \leq \lambda^{-p} E[|X_u|^p].
    \]
    \item 若 $p > 1$，$q$ 为其共轭指数，则有
    \[
    E(\sup_{0 \leq t \leq u} |X_t|^p) \leq q^p E[|X_u|^p].
    \]
\end{enumerate}
\end{theorem}
\begin{definition}
	两个定义在同一个概率空间上具有同一个状态空间的随机过程$X, X'$称为互为修正，如果对任意的$t \in T$，$X_t = X'_t$ a.s. 即对任意的$t \in T$，$P(X_t = X'_t) = 1$。
\end{definition}
\begin{definition}
	设$X := (X(t, \omega), t \geq 0), Y := (Y(t, \omega), t \geq 0)$为两个随机过程，称$X, Y$无区别，若对几乎所有的$\omega$，轨道$X(\cdot, \omega), Y(\cdot, \omega)$一致。即$P(X(t, \omega) = Y(t, \omega), \forall t \in T) = 1$。
\end{definition}
\begin{theorem}
	设$(X_t, t \geq 0)$为一$(\mathcal{F}_t)_{t \in \mathbb{R}_+}$下鞅，则$X$存在右连左极修正的充分必要条件是：$E[X_t]$作为$t$的函数在$\mathbb{R}_+$上右连续。特别的，一切鞅存在右连左极的修正。
\end{theorem}
\chapter{布朗运动}
\section{布朗运动定义}
我们从讨论简单的随机游动开始。设有一个粒子在直线上随机游动，在每个单位时间内等可能地向左或向右移动一个单位的长度。现在加速这个过程，在越来越小的时间间隔中走越来越小的步子。若能以正确的方式趋于极限，我们就得到Brown运动。详细地说就是令此过程每隔$\Delta t$时间等概率地向左或向右移动$\Delta x$的距离，如果以$X(t)$记时刻$t$粒子的位置，则
\begin{equation}\label{eq:1.1}
X(t) = \Delta x (X_1 + \cdots + X_{[t/\Delta t]})
\end{equation}
其中$[t/\Delta t]$表示$t/\Delta t$的整数部分，其中
\[
X_i = \begin{cases} 
+1, & \text{如果第$i$步向右} \\
-1, & \text{如果第$i$步向左}
\end{cases}
\]
且假设诸$X_i$相互独立
\[
P\{X_i = 1\} = P\{X_i = -1\} = \frac{1}{2}
\]
由于$E[X_i] = 0$，$Var[X_i] = E[X_i^2] = 1$及\ref{eq:1.1}，我们有$E[X(t)] = 0$，$Var[X(t)] = (\Delta x)^2[t/\Delta t]$。现在要令$\Delta x$和$\Delta t$趋于零，并使得极限有意义。如果取$\Delta x = \Delta t$，令$\Delta t \to 0$，则$Var[X(t)] \to 0$，从而$X(t) = 0$，a.s.如果取$\Delta t = (\Delta x)^3$，则$Var[X(t)] \to \infty$，这是不合理的。因为粒子的运动是连续的，不可能在很短时间内远离出发点。因此，我们作下面的假设：$\Delta x = \sigma \sqrt{\Delta t}$，$\sigma$为某个正常数，从上面的讨论可见，当$\Delta t \to 0$时，$E[X(t)] = 0$，$Var[X(t)] \to \sigma^2 t$。

下面来看这一极限过程的一些直观性质。由式(1.1)及中心极限定理可得：
\begin{enumerate}
    \item $X(t)$服从均值为0，方差为$\sigma^2 t$的正态分布。此外，由于随机游动的值在不相重叠的时间区间中的变化是独立的，所以有
    \item $\{X(t), t \geq 0\}$有独立增量。又因为随机游动在任一时间区间中的位置变化的分布只依赖于区间的长度，可见
    \item $\{X(t), t \geq 0\}$有平稳增量。
\end{enumerate}

本节假设 $\mathcal{T} := [0, \infty)$,
\begin{definition}
	如果对任何 $t_1, t_2, \cdots t_n \in \mathcal{T}, t_1 < t_2 < \cdots < t_n$ 随机变量 $X(t_2) - X(t_1), \cdots, X(t_n) - X(t_{n-1})$ 是相互独立的，则称 $X(t)$ 为\textbf{独立增量过程}。如果对任何 $t_1, t_2$，有 $X(t_1 + h) - X(t_1) \overset{d}{=} X(t_2 + h) - X(t_2)$，则称 $\{X(t), t \in \mathcal{T}\}$ 为是\textbf{平稳增量过程}。兼有独立增量和平稳增量的过程称为\textbf{平稳独立增量的过程}。
\end{definition}

本节假定所有r.v. 均定义在同一个概率空间 $(\Omega, \mathcal{F}, P)$ 上。
\begin{definition}
	若一个随机过程 $\{X(t), t \geq 0\}$ 满足
\begin{enumerate}
    \item $X(t)$ 是独立增量过程；
    \item $\forall s, t > 0$, $X(t+s) - X(s) \sim N(0, \sigma^2 t)$；其中 $\sigma$ 为给定的常数.
    \item $X(t)$ 关于 $t$ 是连续函数. 则称其为布朗运动.
\end{enumerate}
\end{definition}
\begin{remark}
	若 $\sigma = 1$，$\{X(t), t \geq 0\}$ 为标准布朗运动。即 $X(0) = 0$，$X(t+s) - X(s) \sim N(0, t)$.
\end{remark}
本章讨论标准布朗运动，即 $\{B(t), t \geq 0\}$。则在t时刻$B(t) = B(t) - B(0)$的概率密度函数为
\[
f(x,t) = \frac{1}{\sqrt{2\pi t}} \mathbf{e}^{-\frac{x^2}{2t}}.
\]

\begin{example}
	设 $\{B(t), t \geq 0\}$ 为标准布朗运动，$B(0) = 0$。求
\begin{enumerate}
    \item $P(B(2) \leq 0)$
    \item $P(B(t) \leq 0; t = 0, 1, 2)$
\end{enumerate}

\end{example}

\begin{proof}
	(1) $P(B(2) \leq 0) = \frac{1}{2}$.

(2).
\begin{align*}
P(B(t) \leq 0; t = 0, 1, 2) &= P\{B(1) \leq 0, B(2) \leq 0\} \\
&= P\{B(1) \leq 0, B(1) + (B(2) - B(1)) \leq 0\} \\
&= P\{B(1) \leq 0, B(2) - B(1) \leq -B(1)\} \\
&= E\left[\mathbf{1}_{(-\infty,0]}(B(1)) \mathbf{1}_{(-\infty,-B(1))}(B(2) - B(1))\right] \\
&= E\left[E\left[\mathbf{1}_{(-\infty,0]}(B(1)) \mathbf{1}_{(-\infty,-B(1))}(B(2) - B(1)) \mid B(1)\right]\right] \\
&= E\left[\mathbf{1}_{(-\infty,0]}(B(1)) E\left[\mathbf{1}_{(-\infty,-B(1))}(B(2) - B(1)) \mid B(1)\right]\right] \\
&= E\left[\mathbf{1}_{(-\infty,0]}(B(1)) P(B(2) - B(1) \leq -x) \bigg|_{x = B(1)}\right] \\
&= \int_{-\infty}^{+\infty} \mathbf{1}_{(-\infty,0)}(x) P\{B(2) - B(1) \leq -x\} f(x) dx
\end{align*}
其中 $f(x)$ 为标准正态的密度函数，$\Phi(x)$ 为标准正态的分布函数。

\begin{align*}
P\{B(1) \leq 0, B(2) \leq 0\} &= P\{B(1) \leq 0, B(1) + (B(2) - B(1)) \leq 0\} \\
&= P\{B(1) \leq 0, B(2) - B(1) \leq -B(1)\} \\
&= \int_{-\infty}^{0} P\{B(2) - B(1) \leq -x\} f(x) dx \\
&= \int_{-\infty}^{0} \Phi(-x) f(x) dx \\
&= \int_{0}^{\infty} \Phi(x) f(-x) dx = \int_{0}^{\infty} \Phi(x) f(x) dx \\
&= \int_{0}^{\infty} \Phi(x) d\Phi(x) = \int_{\frac{1}{2}}^{1} y dy = \frac{3}{8}.
\end{align*}
其中 $f(x)$ 为标准正态的密度函数。
\end{proof}
\begin{theorem}
	设 $(\Omega, \mathcal{F}, P)$ 为概率空间，$\mathcal{G}$ 为 $\mathcal{F}$ 的一个子 $\sigma$ 代数；$(S, \mathcal{S})$ 和 $(E, \mathcal{E})$ 为可测空间，$X$ 为一 $\mathcal{G}$ 可测 $S$ 值随机元，$Y$ 为一 $E$ 值随机元。假定 $Y$ 和 $\mathcal{G}$ 独立。令 $g(x, y)$ 为 $S \times E$ 上的 $S \times \mathcal{E}$ 可测函数，使得 $E[|g(X, Y)|] < \infty$，则 $E[g(X, Y) \mid \mathcal{G}] = E[g(x, Y) \mid_{x = X}]$。
\end{theorem}
设 $X = (X_1, X_2, \cdots, X_n)$ 有联合密度 $f_X(x_1, x_2, \cdots, x_n)$，$n$ 元可测函数 $y = (y_1, \cdots, y_n)$，其中 $y_i(x_1, \cdots, x_n), i = 1, \cdots, n$ 满足：
\begin{itemize}
    \item 除 $\mathbb{R}^n$ 中的 $L$-零测集 $N$ 外，存在至多可数个两两不交的可求积区域 $\{D_{x^k}\}_{k \geq 1}$，使 $\mathbb{R}^n - N = \sum_{k=1}^{\infty} D_{x^k}$，
    \item 对一切 $k$，函数 $y$ 把 $D_{x^k}$ 中的点一对一地映射到可求积区域 $D_{y^k}$ 上，
    \item 在每一个 $D_{x^k}$ 上，$y$ 的逆映射为 $x^{(k)} = (x_1^{(k)}, \cdots, x_n^{(k)})$，其中 $x_i^{(k)} = x_i^{(k)}(y_1, \cdots, y_n), i = 1, \cdots, n$ 是 $D_{y^k}$ 上的连续函数，且有连续的偏导数，函数行列式 $J_k(y_1, \cdots, y_n) = \frac{D(x_1, \cdots, x_n)}{D(y_1, \cdots, y_n)} \neq 0$。
\end{itemize}
若 $\eta = (\eta_1, \cdots, \eta_n)$，其中 $\eta_i = y_i(X_1, \cdots, X_n), i = 1, \cdots, n$，则 $\eta$ 是连续型随机变量，其密度函数为
\[
f_{\eta}(y_1, \cdots, y_n) = \sum_{k=1}^{\infty} |_{D_{y^k}}(y_1, \cdots, y_n) f_X(x_1^{(k)}(y_1, \cdots, y_n), \cdots, x_n^{(k)}(y_1, \cdots, y_n)) |J_k|
\]
\begin{theorem}
	设 $B(0) = 0$，$\{B(t), t \geq 0\}$ 为标准布朗运动。令 $x_0 = 0, t_0 = 0$，则当 $B(0) = 0$ 时，$\forall 0 < t_1 < t_2 < \cdots < t_n$，$(B(t_1), B(t_2), \ldots, B(t_n))$ 的联合密度函数为
\begin{align*}
f_{B(t_1), \ldots, B(t_n)}(x_1, x_2, \ldots, x_n; t_1, t_2, \ldots, t_n) &= \prod_{i=1}^{n} \frac{1}{\sqrt{2\pi(t_i - t_{i-1})}} \exp\left\{-\frac{(x_i - x_{i-1})^2}{2(t_i - t_{i-1})}\right\} \\
&= \prod_{i=1}^{n} p(x_i - x_{i-1}, t_i - t_{i-1})
\end{align*}

即对任意的 $F_k \in \mathcal{B}(\mathbb{R}), k = 1, 2, \ldots, n$，
\[
P^X(B(t_1) \in F_1, B(t_2) \in F_2, \ldots, B(t_n) \in F_n) = \int_{F_1} p(t_1, x_1) \int_{F_2} p(t_2 - t_1, x_2 - x_1) \cdots \int_{F_n} p(t_n - t_{n-1}, x_n - x_{n-1}) dx_1 dx_2 \ldots dx_n.
\]
\end{theorem}
\begin{proof}
	令 $Y_1 = B(t_1)$, $Y_i = B(t_i) - B(t_{i-1})$，则有 $B(t_i) = \sum_{k=1}^{i} Y_k$。
令 $y_1 = x_1, y_i = x_i - x_{i-1}$，则 $x_i = \sum_{k=1}^{i} y_k$。故 $Y_i$ 独立同分布，服从 $N(0, t_i - t_{i-1})$。

\[
f_{Y_1, Y_2, \ldots, Y_n}(y_1, y_2, \ldots, y_n) = \prod_{i=1}^{n} \frac{1}{\sqrt{2\pi(t_i - t_{i-1})}} \exp\left(-\frac{y_i^2}{2(t_i - t_{i-1})}\right)。
\]
故对应的雅克比行列式为
\[
J = \left| \frac{\partial y}{\partial x} \right| = \begin{vmatrix}
1 & 0 & 0 & \cdots & 0 & 0 \\
-1 & 1 & 0 & \cdots & 0 & 0 \\
0 & -1 & 1 & \cdots & 0 & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\
0 & 0 & 0 & \cdots & 1 & 0 \\
0 & 0 & 0 & \cdots & -1 & 1 \\
\end{vmatrix}
\]

\[
f_{Y_1, Y_2, \ldots, Y_n}(y_1, y_2, \ldots, y_n) = \prod_{i=1}^{n} \frac{1}{\sqrt{2\pi(t_i - t_{i-1})}} \exp\left(-\frac{y_i^2}{2(t_i - t_{i-1})}\right)。
\]
故对应的雅克比行列式为
\[
J = \begin{bmatrix}
1 & 0 & 0 & \cdots & 0 & 0 \\
-1 & 1 & 0 & \cdots & 0 & 0 \\
0 & -1 & 1 & \cdots & 0 & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\
0 & 0 & 0 & \cdots & 1 & 0 \\
0 & 0 & 0 & \cdots & -1 & 1 \\
\end{bmatrix}
\]

\[
f(x_1, x_2, \ldots, x_n) = \frac{1}{\sqrt{2\pi t_1}} \exp\left(-\frac{x_1^2}{2t_1}\right) \cdot \prod_{i=2}^{n} \frac{1}{\sqrt{2\pi(t_i - t_{i-1})}} \exp\left(-\frac{(x_i - x_{i-1})^2}{2(t_i - t_{i-1})}\right)
\]
\end{proof}

设 $B(0) = 0$，$\{B(t), t \geq 0\}$ 为标准布朗运动。则当 $B(0) = 0$ 时，$\forall 0 < t_1 < t_2$，$(B(t_1), B(t_2))$ 的联合密度函数为
\begin{align*}
f_{B(t_1), B(t_2)}(x_1, x_2) &= \frac{1}{\sqrt{2\pi t_1}} \exp\left(-\frac{x_1^2}{2t_1}\right) \cdot \frac{1}{\sqrt{2\pi(t_2 - t_1)}} \exp\left(-\frac{(x_2 - x_1)^2}{2(t_2 - t_1)}\right)
\end{align*}

\begin{remark}

	在 $B(t_1) = x_1$ 条件下，$B(t_2)$ 条件概率密度为
\[
f(x_2 \mid x_1, t_2 - t_1) = \frac{1}{\sqrt{2\pi(t_2 - t_1)}} \exp\left\{-\frac{(x_2 - x_1)^2}{2(t_2 - t_1)}\right\}
\]
故在 $B(t_1) = x_1$ 条件下 $B(t_1 + t)$ 条件概率密度为
\[
f(x \mid x_1, t) = \frac{1}{\sqrt{2\pi t}} \exp\left\{-\frac{(x - x_1)^2}{2t}\right\}
\]
\[
P(B(t + t_0) > x_0 \mid B(t_0) = x_0) = P(B(t + t_0) \leq x_0 \mid B(t_0) = x_0) = \frac{1}{2}.
\]
即在给定初始条件 $B(t_0) = x_0$ 下，$\forall t > 0$，$t_0 + t$ 时刻高或低于初始时刻概率相等均为 $1/2$。
\end{remark}

\begin{enumerate}
    \item 若 $X \sim N(\mu, \sigma^2)$，则 $Z = \frac{X - \mu}{\sigma} \sim N(0, 1)$，即 $X = \mu + \sigma Z$。
    \item 若 $X = (X_1, X_2, \ldots, X_n)' \sim N(\bar{\mu}, \Sigma)$，其中 $\bar{\mu} = (\mu_1, \ldots, \mu_n)'$，$\Sigma$ 为 $n \times n$ 正定阵。则存在 $n \times n$ 矩阵 $A$ 使得 $\Sigma = AA'$ 且 $|A| \neq 0$，$X = \bar{\mu} + AZ$，其中 $Z = (Z_1, Z_2, \ldots, Z_n)'$ 为 $n$ 维独立标准正态分布。记 $\bar{x} = (x_1, x_2, \ldots, x_n)'$，则 $X$ 的概率密度函数为
    \[
    f_X(\bar{x}) = \frac{1}{(2\pi)^{\frac{n}{2}} |\Sigma|^{\frac{1}{2}}} \exp\left\{-\frac{1}{2}(\bar{x} - \bar{\mu})' \Sigma^{-1} (\bar{x} - \bar{\mu})\right\}
    \]
\end{enumerate}

\begin{example}
	取 $\mu = \begin{pmatrix} 0, 0 \end{pmatrix}'$，
\[
\Sigma = \begin{pmatrix} 1 & \rho \\ \rho & 1 \end{pmatrix}
\]
$X = (X_1, X_2) \sim N(\mu, \Sigma)$，给出其密度函数。
\end{example}
\begin{proof}
	令 $\mathbf{X} = A\mathbf{Z}$，其中 $\mathbf{Z} = (Z_1, Z_2)$，$Z_1, Z_2$ 相互独立服从标准正态分布
\[
A = \begin{pmatrix} 1 & 0 \\ \rho & \sqrt{1-\rho^2} \end{pmatrix}
\]
满足 $\Sigma = AA^T$。

\begin{align*}
\begin{cases}
x_1 = z_1 \\
x_2 = \rho z_1 + \sqrt{1-\rho^2} z_2
\end{cases}
\end{align*}
则可得逆变换
\begin{align*}
\begin{cases}
z_1 = x_1 \\
z_2 = \frac{x_2 - \rho x_1}{\sqrt{1-\rho^2}}
\end{cases}
\end{align*}

\[
\left| \frac{\partial z_1}{\partial x} \frac{\partial z_1}{\partial y} \right| = \begin{vmatrix} 1 & 0 \\ 0 & \frac{1}{\sqrt{1-\rho^2}} \end{vmatrix}
\]

$\mathbf{Z}$ 的概率密度函数为 $f_{\mathbf{Z}}(z_1, z_2) = \frac{1}{2\pi} \mathbf{e}^{-\frac{1}{2}(z_1^2 + z_2^2)}$，

则 $\mathbf{X}$ 的密度函数为 $f_{\mathbf{Z}}(z_1, z_2) = \frac{1}{2\pi\sqrt{1-\rho^2}} \mathbf{e}^{-\frac{1}{2(1-\rho^2)}(x_1^2 - 2\rho x_1 x_2 + x_2^2)}$。
\end{proof}

若随机向量 $(X_1, \cdots, X_n)$ 的分布函数为 $F(x_1, \cdots, x_n)$，与随机变量相仿，类似地定义它的特性函数
\[
\psi(t_1, \cdots, t_n) = E\left[e^{i \sum_{k=1}^{n} t_k X_k}\right] = \int_{-\infty}^{\infty} \cdots \int_{-\infty}^{\infty} e^{i(t_1 x_1 + \cdots + t_n x_n)} dF(x_1, \cdots, x_n)
\]
若 $\mathbf{X}$ 服从多元正态分布 $\mathcal{N}(\boldsymbol{\mu}, \boldsymbol{\Sigma})$，则特征函数为
\[
\psi_{\mathbf{X}}(\mathbf{t}) = \exp\left\{i \mathbf{t}' \boldsymbol{\mu} - \frac{1}{2} \mathbf{t}' \boldsymbol{\Sigma} \mathbf{t}\right\}
\]

\begin{theorem}
	若 $\{X(t_i), i = 1, \ldots, n\}$ 为多元正态分布当且仅当对任意的实数 $\alpha_k (k = 1, 2, \ldots, n)$，随机变量 $Y := \sum_{k=1}^{n} \alpha_k X(t_k)$ 为一维的正态分布。
\end{theorem}
\begin{proof}
	充分性：设 $\{X(t_i), i = 1, \ldots, n\}$ 的任意线性组合为一维正态分布。则 $\{X(t_i), i = 1, \ldots, n\}$ 的联合特征函数为 $\psi(\alpha_1, \cdots, \alpha_n)$
\begin{align*}
\psi(\alpha_1, \cdots, \alpha_n) &= E\left[e^{i \sum_{k=1}^{n} \alpha_k X(t_k)}\right] = E\left[e^{iY}\right] \\
&= \mathbf{e}^{iE\left[\sum_{k=1}^{n} \alpha_k X(t_k)\right] - \frac{1}{2} E\left[\sum_{k=1}^{n} \alpha_k (X(t_k) - E(X(t_k)))(X(t_j) - E(X(t_j)))\right]} \\
&= \mathbf{e}^{i \sum_{k=1}^{n} \alpha_k E[X(t_k)] - \frac{1}{2} \sum_{k,j} \alpha_k \alpha_j E[(X(t_k) - E(X(t_k)))(X(t_j) - E(X(t_j)))]}
\end{align*}

故 $\psi(\alpha_1, \cdots, \alpha_n)$ 为多元正态分布的特征函数，故 $\{X(t_i), i = 1, \ldots, n\}$ 为多元正态分布。

必要性：设 $\{X(t_i), i = 1, \ldots, n\}$ 为多元正态分布则其联合特征函数为
\begin{align*}
\psi(\lambda_1, \cdots, \lambda_n) &= E\left[\mathbf{e}^{i \sum_{k=1}^{n} \lambda_k X(t_k)}\right] \\
&= \mathbf{e}^{i \sum_{k=1}^{n} \lambda_k \mu_k - \frac{1}{2} \sum_{k,j} \lambda_k \lambda_j \sigma_{kj}}
\end{align*}
其中 $\mu_k = E[X(t_k)]$，$\sigma_{kj} = E[(X(t_k) - E(X(t_k)))(X(t_j) - E(X(t_j)))]$。取 $\lambda_k = \lambda \alpha_k$，则 $Y := \sum_{k} \alpha_k X(t_k)$ 有特征函数
\begin{align*}
\psi(\lambda) &= E\left[\mathbf{e}^{i \lambda Y}\right] \\
&= E\left[\mathbf{e}^{i \sum_{k=1}^{n} \lambda \alpha_k X(t_k)}\right] \\
&= \mathbf{e}^{i \sum_{k=1}^{n} \lambda \alpha_k \mu_k - \frac{1}{2} \lambda^2 \sum_{k,j} \alpha_k \alpha_j \sigma_{kj}} \\
&= \mathbf{e}^{i \lambda EY - \frac{1}{2} \lambda^2 E[Y - EY]^2}
\end{align*}
故其特征函数为一元正态分布的分布函数，故 $Y$ 为一元正态分布。
\end{proof}
\begin{definition}
	若 $\{X(t), t \in \mathcal{T}\}$，$\forall t \in \mathcal{T} (i = 1, 2, \ldots, n)$ $(X(t_1), X(t_2), \ldots X(t_n))$ 联合分布为 $n$ 维正态分布，则称 $\{X(t), t \in \mathcal{T}\}$ 为正态过程。
\end{definition}
\begin{theorem}\label{th:5.9}
	若 $\{X(t), t \in \mathcal{T}\}$ 为正态过程当且仅当任意有限个随机变量的线性组合都是一维的正态分布，即对任意的 $t_1, t_2 \ldots t_n \in \mathcal{T} (n \geq 1)$，实数 $\alpha_k$，随机变量 $\sum_{k=1}^{n} \alpha_k X(t_k)$ 为一维的正态分布。

\end{theorem}
\begin{theorem}
	若 $\{X(t), t \in \mathcal{T}\}$ 为正态过程，则
\begin{enumerate}
    \item $\{X(t), t \in \mathcal{T}\}$ 中的随机变量相互独立（即任意有限个相互独立），当且仅当 $\forall s \neq t (s, t \in \mathcal{T})$，
    \[
    \sigma(s, t) := E[(X(t) - E[X(t)])(X(s) - E[X(s)])] = 0
    \]
    \item $\{X(t), t \in \mathcal{T}\}$ 中的任意一个 $X(t_0)$ 与 $\{X(t), t \neq t_0\}$ 相互独立，当且仅当 $\forall t \neq t_0 (t \in \mathcal{T})$，
    \[
    \sigma(t_0, t) = 0
    \]
\end{enumerate}
\end{theorem}
\begin{theorem}\label{th:5.11}
	设 $B(0) = 0$，$\{B(t), t \geq 0\}$ 为标准布朗运动。$(B(t_1), B(t_2), \ldots, B(t_n))$ 其中 $t_1 < t_2 < \ldots < t_n$ 是均值向量为0，协方差矩阵满足 $Cov(B(s), B(t)) = \min\{t, s\}$ 的正态分布。
\end{theorem}
\begin{proof}
	任取实数 $\alpha_k$，
\begin{align*}
\sum_{k} \alpha_k B(t_k) &= \alpha_n B(t_n) + \alpha_{n-1} B(t_{n-1}) + \ldots + \alpha_1 B(t_1) \\
&= \alpha_n (B(t_n) - B(t_{n-1})) + (\alpha_n + \alpha_{n-1})(B(t_{n-1}) - B(t_{n-2})) \\
&\quad + \ldots + (\alpha_n + \alpha_{n-1} + \ldots + \alpha_2)(B(t_2) - B(t_1)) \\
&\quad + (\alpha_n + \alpha_{n-1} + \ldots + \alpha_1)B(t_1),
\end{align*}
由于 $B(t_i) - B(t_{i-1})$ 与 $B(t_j) - B(t_{j-1}) (i \neq j)$ 相互独立，可知 $\sum_{k} \alpha_k B(t_k)$ 为一维正态分布。

当 $s < t$ 时
\begin{align*}
Cov(B(s), B(t)) &= E[B(s)B(t)] - E[B(s)]E[B(t)] \\
&= E[B(s)(B(t) - B(s) + B(s))] \\
&= E[B^2(s)] + E[(B(t) - B(s))B(s)] \\
&= s
\end{align*}
\end{proof}
\begin{example}
	设 $B(0) = 0$，$\{B(t), t \geq 0\}$ 为标准布朗运动。求 $B(1) + B(2) + B(3) + B(4)$ 的分布。
\end{example}
\begin{proof}
	\[
X = (B(1), B(2), B(3), B(4))'
\]
$X$ 是多元正态分布，均值向量为 $(0, 0, 0, 0)$ 和协方差矩阵，
\[
E(XX') = \sum = \begin{pmatrix}
1 & 1 & 1 & 1 \\
1 & 2 & 2 & 2 \\
1 & 2 & 3 & 3 \\
1 & 2 & 3 & 4
\end{pmatrix}
\]
$A = (1, 1, 1, 1)$，则 $AX = B(1) + B(2) + B(3) + B(4)$，均值向量为0，方差为 $E(AXX'A') = AE(XX')A' = 30$。

故 $B(1) + B(2) + B(3) + B(4)$ 均值为0，方差为30。故 $B(1) + B(2) + B(3) + B(4) \sim N(0, 30)$。
\end{proof}

\begin{theorem}
	设 $\{B(t), t \geq 0\}$ 为正态过程，轨道连续，$B(0) = 0$，$\forall s, t > 0$ 有 $E[B(t)] = 0$，$E[B(t)B(s)] = t \wedge s$ 则当且仅当 $\{B(t), t \geq 0\}$ 为标准布朗运动。
\end{theorem}
\begin{proof}
	充分性：由定理 \ref{th:5.9}, \ref{th:5.11} 知，$\{B(t), t \geq 0\}$ 为正态过程，故 $E[B(t)] = 0$，
\begin{align*}
E[B(s)B(t)] &= E[B(s)(B(t) - B(s) + B(s))] \\
&= E[B^2(s)] + E[(B(t) - B(s))B(s)] \\
&= s
\end{align*}

必要性：设 $\{B(t), t \geq 0\}$ 为正态过程，设 $s < t$，$E[B(t) - B(s)] = 0$。
\begin{align*}
E[B(t) - B(s)]^2 &= E[B^2(t)] + E[B^2(s)] - 2E[B(t)B(s)] \\
&= t + s - 2(t \wedge s) = t - s
\end{align*}
由于 $B(t) - B(s)$ 为正态分布，故 $B(t) - B(s) \sim N(0, t - s)$。对任意的 $s_1 < t_1 \leq s_2 < t_2$，
\begin{align*}
Cov(B(t_1) - B(s_1), B(t_2) - B(s_2)) &= E[(B(t_1) - B(s_1))(B(t_2) - B(s_2))] \\
&= E[B(t_1)B(t_2)] - E[B(t_1)B(s_2)] - E[B(s_1)B(t_2)] + E[B(s_1)B(s_2)] \\
&= t_1 - t_1 - s_1 + s_1 = 0
\end{align*}
故 $B(t_1) - B(s_1)$ 与 $B(t_2) - B(s_2)$ 相互独立。
\end{proof}
\begin{theorem}
	设 $\{B(t), t \geq 0\}$ 为标准布朗运动。
\begin{enumerate}
    \item 对任意的 $\tau > 0$，$\{B(t + \tau) - B(\tau), t \geq 0\}$
    \item 对任意的 $\lambda > 0$，$\left\{\frac{1}{\sqrt{\lambda}} B(\lambda t), t \geq 0\right\}$
    \item $\left\{tB\left(\frac{1}{t}\right), t \geq 0\right\}$ 其中 $tB\left(\frac{1}{t}\right)|_{t=0} := 0$
    \item 对任意的 $t_0 > 0$，$\{B(t_0 - s) - B(t_0), 0 \leq s \leq t_0\}$；
\end{enumerate}
仍为标准布朗运动。
\end{theorem}
\begin{theorem}
	对任意的 $a \geq 0$，过程 $X = \{X(t) = B(t + a) - B(a), t \geq 0\}$ 是标准布朗运动与 $\sigma$-代数 $\mathcal{F}_a^B = \sigma(B(t), 0 \leq t \leq a)$ 独立。
\end{theorem}
\begin{theorem}
	\[
\mathcal{F}_t := \sigma(B(u), u \leq t). \text{ 则}
\]
\begin{enumerate}
    \item $\{B(t), t \geq 0\}$ 为 $\{\mathcal{F}_t\}$ 鞅；
    \item $\{B^2(t) - t, t \geq 0\}$ 为 $\{\mathcal{F}_t\}$ 鞅；
    \item $\left\{e^{\lambda B(t) - \frac{1}{2} \lambda^2 t}, t \geq 0\right\}$ 为 $\{\mathcal{F}_t\}$ 鞅；
    \item $\left\{e^{i \lambda B(t) + \frac{1}{2} \lambda^2 t}, t \geq 0\right\}$ 为 $\{\mathcal{F}_t\}$ 鞅；
\end{enumerate}
\end{theorem}
\begin{definition}
	设有概率空间 $(\Omega, \mathcal{F}, P)$ 上的以 $(E, \mathcal{E})$ 为状态空间的随机过程 $\xi = \{\xi_t, t \in T\}$ 及其 $\sigma$-代数流 $\{\mathcal{F}_t, t \in T\}$ 满足 $\mathcal{F}_s \subset \mathcal{F}_t$。设 $\xi$ 对 $\{\mathcal{F}_t, t \in T\}$ 是适应的。此时称 $(\Omega, \mathcal{F}, P, \xi, \mathcal{F}_t)$ 是一个 $\{\mathcal{F}_t, t \in T\}$-Markov过程，若对任意的 $s < t \in T, B \in \mathcal{E}$ 有 $P(\xi_t \in B | \mathcal{F}_s) = P(\xi_t \in B | \xi_s)$。特别的当 $\mathcal{F}_t = \sigma(\xi_s, s \leq t)$，则称 $\xi$ 为 $(\Omega, \mathcal{F}, P)$ 上的马氏过程。
\end{definition}
\begin{definition}
	设有概率空间 $(\Omega, \mathcal{F}, P)$ 上的以 $(E, \mathcal{E})$ 为状态空间的随机过程 $\xi = \{\xi_t, t \in T\}$ 及其 $\sigma$-代数流 $\{\mathcal{F}_t, t \in T\}$ 满足 $\mathcal{F}_s \subset \mathcal{F}_t$。设 $\xi$ 对 $\{\mathcal{F}_t, t \in T\}$ 是适应的。此时称 $(\Omega, \mathcal{F}, P, \xi, \mathcal{F}_t)$ 是一个 $\{\mathcal{F}_t, t \in T\}$-Markov过程，若对任意的 $s < t \in T, B \in \mathcal{E}$ 有 $P(\xi_t \in B | \mathcal{F}_s) = P(\xi_t \in B | \xi_s)$。特别的当 $\mathcal{F}_t = \sigma(\xi_s, s \leq t)$，则称 $\xi$ 为 $(\Omega, \mathcal{F}, P)$ 上的马氏过程。
\end{definition}
\begin{theorem}
	$\{B(t), t \geq 0\}$ 为 $(\Omega, \mathcal{F}, P)$ 上的马氏过程。
\end{theorem}
\begin{theorem}
	设 $(\Omega, \mathcal{F}, P)$ 为概率空间，$\mathcal{G}$ 为 $\mathcal{F}$ 的一个子 $\sigma$ 代数；$(S, \mathcal{S})$ 和 $(E, \mathcal{E})$ 为可测空间，$X$ 为一 $\mathcal{G}$ 可测 $S$ 值随机元，$Y$ 为一 $E$ 值随机元。假定 $Y$ 和 $\mathcal{G}$ 独立。令 $g(x, y)$ 为 $S \times E$ 上的 $S \mathcal{S} \times \mathcal{E}$ 可测函数，使得 $E[|g(X, Y)|] < \infty$，则 $E[g(X, Y) | \mathcal{G}] = E[g(x, Y)|_{x=x}$。
\end{theorem}
\begin{theorem}
	($\Omega, \mathcal{F}, \{\mathcal{F}_t\}, P$) 上 $R^d$ 适应过程若具有独立增量性，则 $X = (X_t, t \geq 0)$ 为马氏过程.
\end{theorem}
\begin{proof}
	对任意的 $B \in \mathcal{B}(R^d)$, $s < t$, 令 $A := \{(x, y) | x, y \in R^d, x + y \in B\}$.

\begin{align*}
P(X_t \in B | \mathcal{F}_s) &= P((X_t - X_s, X_s) \in A | \mathcal{F}_s) \\
&= P((X_t - X_s, y) \in A)_{y = X_s}
\end{align*}

\begin{align*}
P(X_t \in B | X_s) &= P((X_t - X_s, X_s) \in A | X_s) \\
&= P((X_t - X_s, y) \in A)_{y = X_s}
\end{align*}

故可知

\[ P(X_t \in B | \mathcal{F}_s) = P(X_t \in B | X_s). \]

\end{proof}
\begin{definition}
	马氏过程 $\{X_t, t \geq 0\}$ 称为具有强马氏性，若对任意的 $t \in T$ 以及 $A \in \mathcal{B}(\mathbb{R})$ 以及 $\{\mathcal{F}_t\}$ 停时 $\tau$ 有
\[ P(\{X_{t+\tau} \in A\} \cap \{\tau < \infty\} | \mathcal{F}_\tau) = P(\{X_{t+\tau} \in A\} \cap \{\tau < \infty\} | X_\tau). \]

\end{definition}

令 $\mathcal{F}_{t+} := \bigcap_{u > t} \mathcal{F}_u$.\\
$\mathcal{F}_{\tau+} := \{B \in \sigma(\bigcup_n \mathcal{F}_n) | \forall t > 0, B \cap \{\tau \leq t\} \in \mathcal{F}_{t+}\}$.

\begin{theorem}
	令 $\mathcal{F}_{t+} := \bigcap_{u > t} \mathcal{F}_u$. 标准布朗运动 $\{B(t), t \geq 0\}$ 为 $\{\mathcal{F}_{t+}\}$ 的强马氏过程，即对任意的 $\{\mathcal{F}_{t+}\}$ 停时 $\tau$ 以及有界可测函数 $f$ 以及非负 $t$
\[ E_x[f(B(\tau + t)) | \mathcal{F}_{\tau+}] = E_{B(\tau)}[f(B(t)) | \{\tau < \infty\}]. \]

\end{theorem}
\begin{remark}
	去任意的 $A \in \mathcal{B}(\mathbb{R})$，把上述定理中的 $f(x) := I_A(x)$，则有
\[ P(\{X_{t+\tau} \in A\} \cap \{\tau < \infty\} | \mathcal{F}_\tau) = P(\{X_{t+\tau} \in A\} \cap \{\tau < \infty\} | X_\tau). \]

\end{remark}

\begin{theorem}
	标准布朗运动 $(B(t))$ 为 $\{\mathcal{F}_t\}$ 的强马氏过程。即对任意的 $\{\mathcal{F}_t\}$ 停时 $\tau$ 以及有界可测函数 $f$ 以及非负 $t$
\[ E_x[f(B(\tau + t)) I_{\{\tau < \infty\}} | \mathcal{F}_\tau] = E_{B(\tau)}[f(B(t)) I_{\{\tau < \infty\}}] \]
\end{theorem}
\begin{theorem}
	设 $B = \{B(t), t \geq 0\}$ 是一个标准布朗运动，若 $\tau < \infty \text{ a.s.}$ 为 $\{\mathcal{F}_{t+}\}$ 停时，$\{B'(t) := B(t + \tau) - B(\tau) | t \geq 0\}$ 仍为一个布朗运动且与 $\mathcal{F}_\tau$ 独立。

\end{theorem}
\begin{theorem}
	标准布朗运动 $\{B(t), t \geq 0\}$ 及 $\{\mathcal{F}_t\}$ 停时 $\tau$，其中 $\mathcal{F}_t := \sigma(B(u), u \leq t)$. 则 $\bar{B}(t) := B(t \wedge \tau) - (B(t) - B(t \wedge \tau)), t \geq 0$ 与 $B(t)$ 有相同的分布.
\end{theorem}
\begin{proof}
	假设 $\tau < \infty$，令 $B^\tau(t) := B(\tau \wedge t)$ 以及 $B'(t) = B(\tau + t) - B(\tau)$。则由定理1.30可知，$\{B'(t), t \geq 0\}$ 为标准布朗运动，且与 $\mathcal{F}_\tau$ 相互独立。由于 $B^r := \{B^r(t), t \geq 0\}$ 关于 $\mathcal{F}_\tau$ 可测，故 $\{B'(t), t \geq 0\}$ 与 $(\tau, B^\tau)$ 相互独立。由于 $-B'$ 与 $B'$ 同分布，故 $(\tau, B^\tau, B')$ 与 $(\tau, B^\tau, -B')$ 同分布。由于
\begin{align*}
B(t) &= B(t \wedge \tau) + (B(t) - B(t \wedge \tau)) \\
\tilde{B}(t) &= B(t \wedge \tau) - (B(t) - B(t \wedge \tau))
\end{align*}
故 $B(t)$ 与 $\tilde{B}(t)$ 同分布。
\end{proof}
\section{首中时和最大时}
令 $M_t := \max_{0 \leq u \leq t} B(u)$, $T_a := \inf\{t, t > 0, B(t) = a\}$. $\tilde{B}(t) := B(t \wedge T_a) - (B(t) - B(t \wedge T_a))$
\begin{theorem}
	设 $B = \{B(t), t \geq 0\}$ 是一个标准布朗运动，对任意的 $a > 0$ 以及 $x \leq a$
\begin{enumerate}
    \item $P(M_t \geq a, B(t) < x) = P(B(t) \geq 2a - x)$;
    \item $M_t$ 与 $|B(t)|$ 同分布，且
    \[
    P(M_t \geq a) = 2P(B(t) \geq a) = 2 \int_{\frac{a}{\sqrt{t}}}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-\frac{x^2}{2}} dx = 2(1 - \Phi(\frac{a}{\sqrt{t}}))
    \]
    \item $P(T_a \leq t) = P(M_t \geq a) = 2(1 - \Phi(\frac{a}{\sqrt{t}}))$
\end{enumerate}
\end{theorem}
\begin{proof}
	（1）\begin{align*}
		P(M_t \geq a, B(t) \leq x) &= P(T_a \leq t, B(t) \leq x) \\
		&= P(T_a \leq t, \tilde{B}(t) \leq x) \\
		&= P(T_a \leq t, 2a - B(t) \leq x) \\
		&= P(T_a \leq t, B(t) \geq 2a - x) \\
		&= P(B(t) \geq 2a - x)
		\end{align*}
	
	（2）\begin{align*}
		P(M_t \geq a) &= P(M_t \geq a, B(t) \geq a) + P(M_t \geq a, B(t) < a) \\
		&= P(B(t) \geq a) + P(B(t) \geq 2a - a) \\
		&= 2P(B(t) \geq a) \\
		&= P(|B(t)| \geq a)
		\end{align*}
		
		\text{标准化} $\frac{B(t)}{\sqrt{t}} \sim N(0, 1)$，故
		\begin{align*}
		2P(B(t) \geq a) &= 2P\left(\frac{B(t)}{\sqrt{t}} \geq \frac{a}{\sqrt{t}}\right) = 2 \int_{\frac{a}{\sqrt{t}}}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-\frac{x^2}{2}} dx
		\end{align*}

	（3）\begin{align*}
		P(T_a \leq t) &= P(M_t \geq a) \\
		&= 2P(B(t) \geq a)
		\end{align*}
\end{proof}
\begin{theorem}
	设 $B = \{B(t), t \geq 0\}$ 是一个标准布朗运动，$\forall a < 0$，则有
\[ P\left(\min_{0 \leq s \leq t} B(s) \leq a\right) = 2P(B(t) \geq -a) = 2P(B(t) \leq a). \]

\end{theorem}
\begin{proof}
	令 $m(t) = \min_{0 \leq s \leq t} B(s)$，$-\min_{0 \leq s \leq t} B(s) = \max_{0 \leq s \leq t} (-B(s))$.

\begin{align*}
P(m(t) \leq a) &= P(-\max_{0 \leq s \leq t} (-B(s)) \leq a) \\
&= P(\max_{0 \leq s \leq t} (-B(s)) \geq -a) \\
&= P(\max_{0 \leq s \leq t} B(s) \geq -a) \\
&= 2P(B(t) \geq -a)
\end{align*}
\end{proof}

\begin{theorem}
	$B = \{B(t), t \geq 0\}$ 是一个标准布朗运动，$\forall a$，
\[ P(T_a \leq t) = 2 \int_{\frac{|a|}{\sqrt{t}}}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-\frac{x^2}{2}} dx = 2(1 - \Phi(\frac{|a|}{\sqrt{t}})) \]

\end{theorem}
\begin{proof}
	当 $a < 0$ 时，
\begin{align*}
P(T_a \leq t) &= P\left(\min_{0 \leq s \leq t} B(s) \leq a\right) = 2P(B(t) \geq -a) \\
&= 2P\left(\frac{B(t)}{\sqrt{t}} \geq -\frac{a}{\sqrt{t}}\right) \\
&= 2(1 - \Phi(\frac{|a|}{\sqrt{t}}))
\end{align*}

当 $a \geq 0$ 时，$P(T_a \leq t) = 2(1 - \Phi(\frac{a}{\sqrt{t}}))$。

\end{proof}

\begin{remark}
	\begin{enumerate}
		\item $P(T_a < \infty) = 1$;
		\item $E[T_a] = \infty$.
	\end{enumerate}
\end{remark}

\begin{example}
	若 $\varphi(x)$ 为非负可测函数，$X$ 为非负随机变量，又 $\Phi(x) = \int_0^x \varphi(t) dt$，则
\[ E[\Phi(X)] = \int_0^\infty \varphi(t) P(X > t) dt. \]
\end{example}
\begin{proof}
	若用 $F(x)$ 记 $X$ 的分布函数，则有
\begin{align*}
E[\Phi(X)] &= \int_0^\infty \Phi(x) dF(x) \\
&= \int_0^\infty \int_0^x \varphi(t) dt dF(x) \\
&= \int_0^\infty \varphi(t) \left( \int_t^\infty dF(x) \right) dt \\
&= \int_0^\infty \varphi(t) P(X > t) dt.
\end{align*}
\end{proof}
\end{document}

